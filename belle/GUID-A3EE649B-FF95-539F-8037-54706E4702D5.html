
<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<!-- Mirrored from devlib.symbian.slions.net/belle/GUID-A3EE649B-FF95-539F-8037-54706E4702D5.html by HTTrack Website Copier/3.x [XR&CO'2014], Fri, 27 Mar 2020 04:01:04 GMT -->
<head><meta http-equiv="Content-Type" content="text/html; charset=utf-8" /><meta name="copyright" content="(C) Copyright 2012" /><meta name="DC.rights.owner" content="(C) Copyright 2012" /><meta name="DC.Type" content="concept" /><meta name="DC.Title" content="How to Choose Thread Priority" /><meta name="abstract" content="Explains the factors to consider when choosing a thread priority." /><meta name="description" content="Explains the factors to consider when choosing a thread priority." /><meta name="DC.Relation" scheme="URI" content="GUID-32E29020-1956-461A-B79A-1492E06049E7" /><meta name="DC.Relation" scheme="URI" content="GUID-E3D2A6ED-8192-563D-8966-DD96B3AF1783" /><meta name="DC.Relation" scheme="URI" content="GUID-0DF9E318-BE97-531E-AB39-A7B5E8787C87" /><meta name="DC.Relation" scheme="URI" content="GUID-A63025D1-7FD4-5120-8A1F-537D6B70103D" /><meta name="DC.Relation" scheme="URI" content="GUID-BBBFC0AF-2E35-5F5C-A3A5-57C4196A6CDA" /><meta name="DC.Relation" scheme="URI" content="GUID-91EBB6E0-932D-506D-B041-7FB8A531EFDD" /><meta name="DC.Format" content="XHTML" /><meta name="DC.Identifier" content="GUID-A3EE649B-FF95-539F-8037-54706E4702D5" /><meta name="DC.Language" content="en" /><title>How
to Choose Thread Priority </title><link href="css/s60/style.css" rel="stylesheet" type="text/css" /><link href="PLUGINS_ROOT/com.nokia.forum.library/css/category_cpp5.html" rel="stylesheet" type="text/css" /></head><body><div class="body"><div class="contentLeft prTxt"><h1 class="pageHeading" id="GUID-A3EE649B-FF95-539F-8037-54706E4702D5">How
to Choose Thread Priority</h1><div><p>Explains the factors to consider when choosing a thread priority.</p>
<p>The two main considerations when choosing the priority of a thread are:
the timing requirements of the task that the thread must accomplish, and the
other tasks that are likely to be running at the same time. </p>
<ul>
<li id="GUID-53666CA1-A159-595C-A077-418C161670CB"><a name="GUID-53666CA1-A159-595C-A077-418C161670CB"><!-- --></a><p> <a href="#GUID-1E013283-E81C-5144-8055-5667215A3D00">Choosing a process priority</a> </p> </li>
<li id="GUID-D592C147-7A98-5722-B345-7DECC98F0B94"><a name="GUID-D592C147-7A98-5722-B345-7DECC98F0B94"><!-- --></a><p> <a href="#GUID-4248FC3D-8901-5B16-9ACB-9F96830875A6">Choosing the priority of a thread relative to a process</a> </p> </li>
<li id="GUID-B11798AA-E313-5E1F-94A9-F15729744DFC"><a name="GUID-B11798AA-E313-5E1F-94A9-F15729744DFC"><!-- --></a><p> <a href="#GUID-255A62AC-AE94-5296-9B23-87414F68BC0D">Choosing a process-independent thread priority</a> </p> </li>
<li id="GUID-133625B3-1DBB-5937-908B-1FEDDD99C79A"><a name="GUID-133625B3-1DBB-5937-908B-1FEDDD99C79A"><!-- --></a><p> <a href="#GUID-D11BCB87-CC0F-50EF-AB81-F3E46C6C4081">Guideline summary</a> </p> </li>
<li id="GUID-389CD1F8-D39D-599E-9582-AA052DA99AC3"><a name="GUID-389CD1F8-D39D-599E-9582-AA052DA99AC3"><!-- --></a><p> <a href="#GUID-357FC034-EEB4-5D9F-B51A-E6A1400247AD">Long running background tasks</a> </p> </li>
<li id="GUID-21950134-8365-576C-AC8F-FD1BE93EB8DF"><a name="GUID-21950134-8365-576C-AC8F-FD1BE93EB8DF"><!-- --></a><p> <a href="#GUID-86CD6AE8-33E2-549D-8B51-DE705CE017E7">Special timing requirements</a> </p> </li>
</ul>
<div id="GUID-1E013283-E81C-5144-8055-5667215A3D00"><h3 class="section-title">Choosing a
process priority</h3> <p>Choose one of the four standard process priorities
listed below as the <em>basis</em> for a <em>range of relative priorities</em>: </p> <ol id="GUID-D1020288-02AD-5BDD-A3EA-F7716EB7A941">
<li id="GUID-D87CB980-CBAC-5302-AB28-92ACBED89A8C"><a name="GUID-D87CB980-CBAC-5302-AB28-92ACBED89A8C"><!-- --></a><p> <code class="codeph">EPriorityForeground</code> </p> <p>This
is the default process priority. Use this priority for: </p> <ul>
<li id="GUID-4354C28F-9929-5CEA-B515-E235CD90C961"><a name="GUID-4354C28F-9929-5CEA-B515-E235CD90C961"><!-- --></a><p>The currently selected
user interface application which appears in the foreground on the device screen.
This application is said to have the <em>focus</em>. </p> </li>
<li id="GUID-8EE56372-79AB-5841-A2FC-B87282F61CD3"><a name="GUID-8EE56372-79AB-5841-A2FC-B87282F61CD3"><!-- --></a><p>Servers that do not
have specific timing or response requirements. </p> </li>
</ul> <p>The UIKON framework calls <a href="GUID-C6E5F800-0637-419E-8FE5-1EBB40E725AA/GUID-C197C9A7-EA05-3F24-9854-542E984C612D.html#GUID-B5FBAB15-4946-3F3F-B03B-C66D6DF573CE"><code class="apiname">User::SetPriorityControl</code></a> <code class="codeph">(ETrue)</code> so
that the window server can switch applications to background when not in focus.
This is known as <em>priority control</em>. The application can further specify
how the window server makes the priority change using <a href="GUID-C6E5F800-0637-419E-8FE5-1EBB40E725AA/GUID-643DDA78-C7A7-386D-AB3F-8710141DDDA9.html#GUID-E940B930-A882-3624-B8FF-D11626B6EA95"><code class="apiname">RWsSession::ComputeMode()</code></a>.
However, applications should not disable <em>priority control</em> to run permanently
at <code class="codeph">EPriorityForeground</code> process priority without strong justification. <em>Priority
control</em> is irrelevant to processes without a user interface, for which
it should remain disabled. </p> </li>
<li id="GUID-CF0DAC60-5149-56BE-A5DF-F9A86C5037B8"><a name="GUID-CF0DAC60-5149-56BE-A5DF-F9A86C5037B8"><!-- --></a><p> <code class="codeph">EPriorityBackground</code> </p> <p>Use
this process priority for: </p> <ul>
<li id="GUID-8B43DFDD-9B1A-52A3-A2B0-C4D4C3067D46"><a name="GUID-8B43DFDD-9B1A-52A3-A2B0-C4D4C3067D46"><!-- --></a><p>all running user interface
applications except the currently selected application. These applications
appear in the background on the device screen. </p> </li>
<li id="GUID-AA41948D-6929-5C67-A501-3612AF76F750"><a name="GUID-AA41948D-6929-5C67-A501-3612AF76F750"><!-- --></a><p>applications which do
not need to respond rapidly to user actions. For example applications that
do not have a graphical user interface. </p> </li>
</ul> </li>
<li id="GUID-6AF283AE-E3B9-558A-A526-4CFCA79E77C7"><a name="GUID-6AF283AE-E3B9-558A-A526-4CFCA79E77C7"><!-- --></a><p> <code class="codeph">EPriorityHigh</code> </p> <p>Use
this process priority for system servers which should respond quickly to client
requests. These servers must do minimal work at this priority level before
quitting to allow other threads to run. </p> </li>
<li id="GUID-5C69DA26-9106-50A7-B4C4-55940BFB071B"><a name="GUID-5C69DA26-9106-50A7-B4C4-55940BFB071B"><!-- --></a><p> <code class="codeph">EPriorityLow</code> </p> <p>Use
this priority for processes which can run in the background. </p> </li>
<li id="GUID-4B16E703-2EA0-526D-89A1-D0F59C06BAC1"><a name="GUID-4B16E703-2EA0-526D-89A1-D0F59C06BAC1"><!-- --></a><p>The remaining priority
values:<code class="codeph">EPriorityWindowServer</code>,<code class="codeph">EPriorityFileServer</code>, <code class="codeph">EPrioritySupervisor</code> and <code class="codeph">EPriorityRealTimeServer</code> can only be used by processes with <code class="codeph">ProtServ</code> (Protected
Server) Security Capability. </p> </li>
</ol> <p>See <a href="GUID-7B173E02-9697-51F4-A7E8-795AEF547109.html#GUID-B9022468-F4E7-536B-B1D4-58DAA9EA5914">Process-relative
scheme</a> in <a href="GUID-7B173E02-9697-51F4-A7E8-795AEF547109.html#GUID-0194B574-806B-5BA3-B65C-6DC5A80CAB86">Priority
scheme for general user-side threads</a> in <a href="GUID-7B173E02-9697-51F4-A7E8-795AEF547109.html">Thread
priority scheme</a>. </p> </div>
<div id="GUID-4248FC3D-8901-5B16-9ACB-9F96830875A6"><h3 class="section-title">Choosing the
priority of a thread relative to a process</h3> <p> <code class="codeph">EPriorityNormal</code> is
the default <em>relative</em> thread priority. Choose <code class="codeph">EPriorityLess</code> and <code class="codeph">EPriorityMuchLess</code> to
set a lower priority than the owning process. Choose <code class="codeph">EPriorityMore</code> and <code class="codeph">EPriorityMuchMore</code> to
set a higher priority than the owning process. </p> <p>Application programs
and system servers with no <a href="#GUID-86CD6AE8-33E2-549D-8B51-DE705CE017E7">special
timing requirements</a> running with a <em>process</em> priority of <code class="codeph">EPriorityForeground</code> or <code class="codeph">EPriorityBackground</code> should
use the default <em>relative</em> priority <code class="codeph">EPriorityNormal</code> for
their main thread. </p> </div>
<div id="GUID-255A62AC-AE94-5296-9B23-87414F68BC0D"><h3 class="section-title">Choosing a
process-independent thread priority</h3> <p>Use process-independent thread
priorities only when <em>strictly</em> required. Typically, this is when the
thread's behaviour means that its priority must lie outside the range of relative
priorities available with a chosen process priority. Such threads are used
for tasks with <a href="#GUID-86CD6AE8-33E2-549D-8B51-DE705CE017E7">special
timing requirements</a>, such as long running background tasks or time
critical tasks. </p> <p>Avoid "absolute" priorities in the middle of the range
of relative priorities available with the chosen process priority. For example,
consider what happens if you use EPriorityAbsoluteForegroundNormal.
This is in the middle of the range of priorities relative to the <code class="codeph">EPriorityForeground</code> process
priority. If the process priority is changed to <code class="codeph">EPriorityBackground</code>,
then the thread will now pre-empt all threads that have been assigned process-relative
priorities. </p> <p>Time critical tasks can be divided into those that must
complete as quickly as possible and those that need to complete within a fixed
time interval. The former are simply high priority tasks, the latter are known
as real-time tasks. See <a href="GUID-25F853BF-BA95-5348-809E-670C04734AB7.html">How
to choose a real-time thread priority</a>. </p> </div>
<div id="GUID-D11BCB87-CC0F-50EF-AB81-F3E46C6C4081"><h3 class="section-title">Guideline summary</h3> <ul>
<li id="GUID-988EA6D9-3534-565B-80CB-C63B7F808E88"><a name="GUID-988EA6D9-3534-565B-80CB-C63B7F808E88"><!-- --></a><p>Use process-relative
thread priorities instead of process-independent thread priorities whenever
possible. </p> </li>
<li id="GUID-F5CCDDE0-BB38-5043-87FC-ED7D41826E11"><a name="GUID-F5CCDDE0-BB38-5043-87FC-ED7D41826E11"><!-- --></a><p>Only use process-independent
thread priorities for threads that need to run at particularly high or low
priorities compared to other threads running on the system. Examples of these
two extremes are short term, time critical tasks or <a href="#GUID-357FC034-EEB4-5D9F-B51A-E6A1400247AD">long running background tasks</a>. </p> </li>
<li id="GUID-BC583446-B98E-5D47-910C-5D4E0037D39B"><a name="GUID-BC583446-B98E-5D47-910C-5D4E0037D39B"><!-- --></a><p>Ensure that threads
with priorities above EPriorityAbsoluteForegroundNormal such
as the GUI foreground application and system servers do not perform long-running
tasks. </p> </li>
<li id="GUID-8166180C-05CA-5514-B6D1-7D21DF9B9C57"><a name="GUID-8166180C-05CA-5514-B6D1-7D21DF9B9C57"><!-- --></a><p>Ensure that threads
with priorities in the range above EPriorityAbsoluteBackgroundNormal,
and below or equal to EPriorityAbsoluteForegroundNormal do
not perform long-running tasks. </p> </li>
<li id="GUID-697D648E-FE24-5F18-8622-1BAEEDEBB9F9"><a name="GUID-697D648E-FE24-5F18-8622-1BAEEDEBB9F9"><!-- --></a><p>Threads can have equal
priorities. Higher or lower priorities are only needed if one thread must
pre-empt another. </p> </li>
<li id="GUID-D4753029-3139-59B6-8C29-BFF9FEADB003"><a name="GUID-D4753029-3139-59B6-8C29-BFF9FEADB003"><!-- --></a><p>GUI applications must
not disable <em>priority control</em> to run permanently at <code class="codeph">EPriorityForeground</code> process
priority without very good reason. See also <a href="#GUID-1E013283-E81C-5144-8055-5667215A3D00">choosing
a process priority</a> for a description of <em>priority control</em>. </p> </li>
<li id="GUID-56084ABD-AF39-5EB9-8AFE-145CCD2EF55B"><a name="GUID-56084ABD-AF39-5EB9-8AFE-145CCD2EF55B"><!-- --></a><p>Unless there is a specific
requirement, disable priority control for processes without a user interface. </p> </li>
<li id="GUID-4B743232-CFD3-5CEC-9B9D-FDC99CB194A0"><a name="GUID-4B743232-CFD3-5CEC-9B9D-FDC99CB194A0"><!-- --></a><p>Avoid adding unnecessary
extra functionality to high priority threads. Instead, create a new lower
priority thread for this code. Always perform the minimum work at a given
priority to meet a task deadline. </p> </li>
<li id="GUID-3C3C4B91-28DC-5083-B80C-77F54C06B7E3"><a name="GUID-3C3C4B91-28DC-5083-B80C-77F54C06B7E3"><!-- --></a><p>Never assume a higher
priority thread will run before a lower priority thread. The scheduling algorithm
and the <a href="GUID-7B173E02-9697-51F4-A7E8-795AEF547109.html#GUID-F5B98A28-EEDA-58BD-A6CC-62C1621D44DF">thread
priority value mapping table</a> might change. Use a synchronization mechanism
such as a semaphore or mutex to guarantee that a thread is not interrupted. </p> </li>
<li id="GUID-5FFBE78D-511C-5DAF-A410-BDCC4F8AC57B"><a name="GUID-5FFBE78D-511C-5DAF-A410-BDCC4F8AC57B"><!-- --></a><p>Always avoid unnecessary <a href="#GUID-357FC034-EEB4-5D9F-B51A-E6A1400247AD">long
running background tasks</a> as this reduces battery performance. </p> </li>
<li id="GUID-60AA26FC-A170-50B1-8F7E-27FC4718220A"><a name="GUID-60AA26FC-A170-50B1-8F7E-27FC4718220A"><!-- --></a><p>Devices only have a
finite amount of processing power. The full impact of choosing a particular
thread priority is often only observed when the system is under stress, causing
some tasks to succeed at the expense of others. This can only be discovered
through appropriate stress testing. </p> </li>
<li id="GUID-324C10ED-218D-51C9-88E5-C23913C54D0A"><a name="GUID-324C10ED-218D-51C9-88E5-C23913C54D0A"><!-- --></a><p>When testing new software
use realistic scenarios. Run applications which are likely to be used at the
same time as the new code, for example making and receiving calls at the same
time as sending a text message. Adjust thread priorities as necessary to ensure
a good end-user experience. Choosing too high a priority for your software
can adversely effect the end-user's experience just as severely as using a
priority which is too low. </p> </li>
</ul> </div>
<div id="GUID-357FC034-EEB4-5D9F-B51A-E6A1400247AD"><h3 class="section-title">Long running
background tasks</h3> <p>Long running tasks usually run in the background.
They use a low priority thread and do not directly respond to user interaction.
They generally use all the CPU time available to them and run for a period
of a fraction of a second to a few seconds. Occasionally long running tasks,
critical to the currently selected UI application, run at a higher priority
for a few seconds. </p> </div>
<div id="GUID-86CD6AE8-33E2-549D-8B51-DE705CE017E7"><h3 class="section-title">Special timing
requirements</h3> <p>Tasks with special timing requirements fall into two
distinct categories: </p> <ul>
<li id="GUID-DD200274-40B1-5009-8BC9-86C35565B423"><a name="GUID-DD200274-40B1-5009-8BC9-86C35565B423"><!-- --></a><p>Short term, time critical
tasks. </p> <p>These use high priority or real-time threads. </p> </li>
<li id="GUID-26F57B7B-F75E-5E8E-A40F-8A97BF08E1B2"><a name="GUID-26F57B7B-F75E-5E8E-A40F-8A97BF08E1B2"><!-- --></a><p>Long running background
tasks such as garbage collection and other cleanup tasks. </p> <p>These use
low priority threads. </p> </li>
</ul> </div>
</div></div></div><div class="footer"><p class="metadata">Last updated January 20th, 2010</p><hr /><div class="copy">© Nokia 2012.</div></div></body>
<!-- Mirrored from devlib.symbian.slions.net/belle/GUID-A3EE649B-FF95-539F-8037-54706E4702D5.html by HTTrack Website Copier/3.x [XR&CO'2014], Fri, 27 Mar 2020 04:01:04 GMT -->
</html>