
<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<!-- Mirrored from devlib.symbian.slions.net/belle/GUID-2610E11C-26FA-538E-A3E1-34AADA35F20B.html by HTTrack Website Copier/3.x [XR&CO'2014], Fri, 27 Mar 2020 04:08:15 GMT -->
<head><meta http-equiv="Content-Type" content="text/html; charset=utf-8" /><meta name="copyright" content="(C) Copyright 2012" /><meta name="DC.rights.owner" content="(C) Copyright 2012" /><meta name="DC.Type" content="concept" /><meta name="DC.Title" content="Querying Databases: Basic" /><meta name="abstract" content="This tutorial shows you how to create a simple SQL database query." /><meta name="description" content="This tutorial shows you how to create a simple SQL database query." /><meta name="DC.Relation" scheme="URI" content="GUID-22844C28-AB5B-5A6F-8863-7269464684B4" /><meta name="DC.Relation" scheme="URI" content="GUID-C2FCE726-FD87-52BF-8AF8-7F54FB6D6CB1" /><meta name="DC.Relation" scheme="URI" content="GUID-32E29020-1956-461A-B79A-1492E06049E7" /><meta name="DC.Relation" scheme="URI" content="GUID-F8824165-4B33-50D1-9706-BD2438B5A2EE" /><meta name="DC.Relation" scheme="URI" content="GUID-868D5B32-1CC4-506E-9C49-C86428B9A50F" /><meta name="DC.Relation" scheme="URI" content="GUID-582CAA4A-1240-5138-983D-D9C6EEAF5566" /><meta name="DC.Format" content="XHTML" /><meta name="DC.Identifier" content="GUID-2610E11C-26FA-538E-A3E1-34AADA35F20B" /><meta name="DC.Language" content="en" /><title>Querying Databases: Basic </title><link href="css/s60/style.css" rel="stylesheet" type="text/css" /><link href="PLUGINS_ROOT/com.nokia.forum.library/css/category_cpp5.html" rel="stylesheet" type="text/css" /></head><body><div class="body"><div class="contentLeft prTxt"><h1 class="pageHeading" id="GUID-2610E11C-26FA-538E-A3E1-34AADA35F20B">Querying Databases: Basic</h1><div><p>This tutorial shows you how to create a simple SQL database query. </p><div id="GUID-BEB231F7-8A23-5650-9933-EC3D030ABA32"><h3 class="section-title">Introduction</h3> <p>This tutorial shows you how to wrap a SQL query statement into an RSqlStatement object to query a database. </p> <p>This tutorial uses code from the <a href="GUID-C2FCE726-FD87-52BF-8AF8-7F54FB6D6CB1.html">Basic SQL example application</a>. </p> <p><strong>Assumptions </strong> </p> <p>You have a database. The database has no tables and therefore no data. </p> <p><strong>SQL statements </strong> </p> <p>The following SQL statements are used for this example: </p> <p><kbd class="userinput"><code>SELECT</code> <code class="parname">person</code> <code>FROM</code> <code class="parname">Pets</code> <code>WHERE</code> <code class="parname">cat
          &gt;= 1</code> </kbd> </p> <p>The (<code class="codeph">SELECT</code>) results of the query will be the value in the '<code class="codeph">name</code>' column <code class="codeph">FROM</code> the '<code class="codeph">countries</code>' table <code class="codeph">WHERE</code> the value of the '<code class="codeph">population</code>' column of the same record is <code class="codeph">&gt;</code> the value specified. </p> </div> <div><h3 class="section-title">Procedure</h3> <ol id="GUID-457AA35E-0A23-5FAE-B69E-10D31F40F153"><li id="GUID-6C096309-F5A5-53AB-81E1-2E319D784FEF"><a name="GUID-6C096309-F5A5-53AB-81E1-2E319D784FEF"><!-- --></a><p>Prepare the statement: </p> <p>The steps to prepare a SQL statement are shown here. </p> <ol type="a" id="GUID-6E19F9B5-92DC-50C4-9A93-1DC9E10EFECB"><li id="GUID-F28F700F-1D43-5A44-8C01-A117048A6372"><a name="GUID-F28F700F-1D43-5A44-8C01-A117048A6372"><!-- --></a><p>Set up some constants used by the SQL statement object to define the SQL query: </p> <div class="p"><pre class="codeblock">_LIT(KSelect1,"SELECT person FROM Pets WHERE cat &gt;= 1;");</pre> </div> <p>This defines the query parameters. </p> </li> <li id="GUID-5B15A001-4355-5422-88D5-DF457B3F069C"><a name="GUID-5B15A001-4355-5422-88D5-DF457B3F069C"><!-- --></a><p>Instantiate the RSqlStatement SQL statement: </p> <div class="p"><pre class="codeblock">RSqlStatement stmt;</pre> </div> </li> <li id="GUID-A8E185AC-0402-5B62-ABDE-7667E7396621"><a name="GUID-A8E185AC-0402-5B62-ABDE-7667E7396621"><!-- --></a><p>Prepare the statement: </p> <div class="p"><pre class="codeblock">User::LeaveIfError(stmt.Prepare(iPetDb, aStatement));</pre> </div> <p>Creates a parameterised SQL statement executable. </p> </li> <li id="GUID-28D8E6CC-5A85-5422-9F6E-F4EAA5D80491"><a name="GUID-28D8E6CC-5A85-5422-9F6E-F4EAA5D80491"><!-- --></a><p>Define the indices to be used in the search: </p> <div class="p"><pre class="codeblock">    TInt personIndex = stmt.ColumnIndex(KPerson);</pre> </div> </li> </ol> </li> <li id="GUID-7D9C68FB-A9A3-5FBF-A1F4-B2C900680E62"><a name="GUID-7D9C68FB-A9A3-5FBF-A1F4-B2C900680E62"><!-- --></a><p>Execute the SQL query: </p> <p>The Symbian SQL statement is executed by RSqlStatement::Next(). </p> <ol type="a" id="GUID-FD6241DB-56D3-5F28-8CA7-ECC8A527F3F8"><li id="GUID-71EC4F86-F462-5C20-82FA-331FF215A25C"><a name="GUID-71EC4F86-F462-5C20-82FA-331FF215A25C"><!-- --></a><p>Search the records until a match is found: </p> <div class="p"><pre class="codeblock">TInt rc = KErrNone;
while ((rc = stmt.Next()) == KSqlAtRow)</pre> </div> <p> <code class="codeph">Next()</code> fires the executable SQL statement and stops at and returns the matched record. </p> </li> </ol> </li> <li id="GUID-D142E6BD-1FF7-514E-A33E-DA87112AABC6"><a name="GUID-D142E6BD-1FF7-514E-A33E-DA87112AABC6"><!-- --></a><p>Do something with the results: </p> <p>The query is done and you have the results. In this section we look at a simple way to do something with the results and we close the SQL statement object. </p> <ol type="a" id="GUID-19CF868B-5957-5D68-8E7F-352F924C0426"><li id="GUID-21B13AF8-6052-55B1-9CD0-E0BD8783473A"><a name="GUID-21B13AF8-6052-55B1-9CD0-E0BD8783473A"><!-- --></a><p>Get and use the results of the search: </p> <div class="p"><pre class="codeblock">...
{
TPtrC myData = stmt.ColumnTextL(personIndex);
iConsole-&gt;Printf(_L("Person=%S\n"), &amp;myData);
}</pre> </div> </li> <li id="GUID-9EECD8B4-F9D2-5D27-A1C3-32C7337AF8E0"><a name="GUID-9EECD8B4-F9D2-5D27-A1C3-32C7337AF8E0"><!-- --></a><p>Close the SQL search statement: </p> <div class="p"><pre class="codeblock">err = myStatement.Close(); </pre> </div> <p>When the database search is finished the object should be closed to free up resources. </p> </li> </ol> </li> </ol> </div> <div id="GUID-CDF77F9C-9ACB-529B-B902-0548E91A026E"><h3 class="section-title">Results</h3> <p>The tutorial has demonstrated how to query a Symbian SQL database. Looking through the example application you can work out how easily the query can be changed to meet specific requirements and how the results can be used in different ways. </p> </div> <div id="GUID-8DB8048D-082A-51C2-882E-6250D5B3B2D0"><h3 class="section-title">Querying example</h3> <p>The following code snippet is from the basic example application. </p> <pre class="codeblock">...
...
RSqlStatement stmt;
iConsole-&gt;Printf(_L("Running Query:\n%S\n"), &amp;aStatement);
user::LeaveIfError(stmt.Prepare(iPetDb, aStatement));
CleanupClosePushL(stmt);
TInt personIndex = stmt.ColumnIndex(KPerson);
TInt rc = KErrNone;
while ((rc = stmt.Next()) == KSqlAtRow)
  {
  // Do something with the results 
  TPtrC myData = stmt.ColumnTextL(personIndex); // read return data
  iConsole-&gt;Printf(_L("Person=%S\n"), &amp;myData);
  }
if (rc != KSqlAtEnd)
  {
  _LIT(KErrSQLError, "Error %d returned from RSqlStatement::Next().");
  iConsole-&gt;Printf(KErrSQLError, rc);
  }
  ...
  CleanupStack::PopAndDestroy(1);
}</pre> </div> <div id="GUID-8F3A39B6-6514-5A48-BE2E-7893D7625A9C-GENID-GUID-41737FC8-92AD-4B59-B4D5-6FE84D264610"><h3 class="section-title"><!--no section title--></h3><p>Now that you have performed a basic database query you can start thinking about more advanced querying options. The following will show you how: </p> <ul><li id="GUID-D2CD5BB5-C085-56F0-B834-7515447CD661"><a name="GUID-D2CD5BB5-C085-56F0-B834-7515447CD661"><!-- --></a><p> <a href="GUID-72511204-FC90-54AA-9E2E-833318020318.html">Reading to a buffer</a> </p> </li> <li id="GUID-B147074E-B791-592E-99C3-474AA5D217F6"><a name="GUID-B147074E-B791-592E-99C3-474AA5D217F6"><!-- --></a><p> <a href="GUID-3CCA6503-54DA-5558-85DC-93A22A81F565.html">Reading to memory</a> </p> </li> <li id="GUID-029878E1-AAD9-5E1A-B696-67BD3C0D905F"><a name="GUID-029878E1-AAD9-5E1A-B696-67BD3C0D905F"><!-- --></a><p> <a href="GUID-183280EE-0C57-54FE-8ABB-E1CC3BDE525B.html">Reading to a data stream</a> </p> </li> </ul> </div> </div><h3>Related concepts</h3><ul><li><a href="GUID-22844C28-AB5B-5A6F-8863-7269464684B4.html">SQL Overview</a></li><li><a href="GUID-C2FCE726-FD87-52BF-8AF8-7F54FB6D6CB1.html">Basic SQL Example
                Application</a></li></ul></div></div><div class="footer"><p class="metadata">Last updated January 20th, 2010</p><hr /><div class="copy">Â© Nokia 2012.</div></div></body>
<!-- Mirrored from devlib.symbian.slions.net/belle/GUID-2610E11C-26FA-538E-A3E1-34AADA35F20B.html by HTTrack Website Copier/3.x [XR&CO'2014], Fri, 27 Mar 2020 04:08:15 GMT -->
</html>