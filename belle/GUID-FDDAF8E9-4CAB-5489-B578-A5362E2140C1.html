
<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<!-- Mirrored from devlib.symbian.slions.net/belle/GUID-FDDAF8E9-4CAB-5489-B578-A5362E2140C1.html by HTTrack Website Copier/3.x [XR&CO'2014], Fri, 27 Mar 2020 03:56:01 GMT -->
<head><meta http-equiv="Content-Type" content="text/html; charset=utf-8" /><meta name="copyright" content="(C) Copyright 2012" /><meta name="DC.rights.owner" content="(C) Copyright 2012" /><meta name="DC.Type" content="task" /><meta name="DC.Title" content="Decompressing File Archives" /><meta name="DC.Relation" scheme="URI" content="GUID-32E29020-1956-461A-B79A-1492E06049E7" /><meta name="DC.Relation" scheme="URI" content="GUID-5072BE46-B1B4-5C3A-BF55-BEA7443E7657" /><meta name="DC.Relation" scheme="URI" content="GUID-9208E03A-CC7A-57A9-84BD-778B99040842" /><meta name="DC.Relation" scheme="URI" content="GUID-5D14ADEC-ED83-5FA4-B551-C57CAE4F79BE" /><meta name="DC.Relation" scheme="URI" content="GUID-7AAAC6EA-784D-51E6-AD6B-521C9F5C4DBD" /><meta name="DC.Format" content="XHTML" /><meta name="DC.Identifier" content="GUID-FDDAF8E9-4CAB-5489-B578-A5362E2140C1" /><meta name="DC.Language" content="en" /><title>Decompressing
File Archives </title><link href="css/s60/style.css" rel="stylesheet" type="text/css" /><link href="PLUGINS_ROOT/com.nokia.forum.library/css/category_cpp5.html" rel="stylesheet" type="text/css" /></head><body><div class="body"><div class="contentLeft prTxt"><h1 class="pageHeading" id="GUID-FDDAF8E9-4CAB-5489-B578-A5362E2140C1">Decompressing
File Archives</h1><div><div><div>The Zip Compression Library, EZLib provides file archive
decompression functionality for the Symbian platforms. </div> <p>EZLib
allows clients to decompress data from file archives. The decompression task
is performed by calling the decompression functions iteratively, until the
required task completion. </p> </div>
<div><h3 class="section-title">Context</h3><p>The input archive file is opened and the properties of all the
files in the archive are retrieved. </p> </div>
<h3>Steps</h3><ol id="GUID-0D781F2C-8D11-5792-98D5-76091DA8EBBB"><a name="GUID-0D781F2C-8D11-5792-98D5-76091DA8EBBB"><!-- --></a>
<li id="GUID-E92A26A2-F56D-5FA0-A583-43B227AE670C"><a name="GUID-E92A26A2-F56D-5FA0-A583-43B227AE670C"><!-- --></a><p></p>
Pass the input file archive and create an instance of the <a href="GUID-C6E5F800-0637-419E-8FE5-1EBB40E725AA/GUID-79C613E8-35F8-319B-BE8B-1411CBE5AF00.html#GUID-C6E5F800-0637-419E-8FE5-1EBB40E725AA/GUID-79C613E8-35F8-319B-BE8B-1411CBE5AF00.html"><code class="apiname">CZipFile</code></a> class.
 The <a href="GUID-C6E5F800-0637-419E-8FE5-1EBB40E725AA/GUID-79C613E8-35F8-319B-BE8B-1411CBE5AF00.html#GUID-C6E5F800-0637-419E-8FE5-1EBB40E725AA/GUID-79C613E8-35F8-319B-BE8B-1411CBE5AF00.html"><code class="apiname">CZipFile</code></a> is a read only interface. It does not
support file compression to a single or multiple zip file archives. 
</li>
<li id="GUID-8E916762-869C-5E9C-B38C-43B55805EB73"><a name="GUID-8E916762-869C-5E9C-B38C-43B55805EB73"><!-- --></a><p></p>
Invoke <a href="GUID-C6E5F800-0637-419E-8FE5-1EBB40E725AA/GUID-79C613E8-35F8-319B-BE8B-1411CBE5AF00.html#GUID-7F528528-1814-39A6-BE14-CA1F7AABFD06"><code class="apiname">CZipFile::GetMembersL()</code></a> that returns a pointer
of <a href="GUID-C6E5F800-0637-419E-8FE5-1EBB40E725AA/GUID-D458AE6A-EC64-3882-BCEA-A44A43DAA99A.html#GUID-C6E5F800-0637-419E-8FE5-1EBB40E725AA/GUID-D458AE6A-EC64-3882-BCEA-A44A43DAA99A.html"><code class="apiname">CZipFileMemberIterator</code></a>  
The <a href="GUID-C6E5F800-0637-419E-8FE5-1EBB40E725AA/GUID-D458AE6A-EC64-3882-BCEA-A44A43DAA99A.html#GUID-C6E5F800-0637-419E-8FE5-1EBB40E725AA/GUID-D458AE6A-EC64-3882-BCEA-A44A43DAA99A.html"><code class="apiname">CZipFileMemberIterator</code></a> iterator
class provides functions that point to the first file in the archive and to
navigate through all the entries in the archive. 
The <a href="GUID-C6E5F800-0637-419E-8FE5-1EBB40E725AA/GUID-D458AE6A-EC64-3882-BCEA-A44A43DAA99A.html#GUID-C6E5F800-0637-419E-8FE5-1EBB40E725AA/GUID-D458AE6A-EC64-3882-BCEA-A44A43DAA99A.html"><code class="apiname">CZipFileMemberIterator</code></a> iterator class can access
each member of the zip archive using <a href="GUID-C6E5F800-0637-419E-8FE5-1EBB40E725AA/GUID-D458AE6A-EC64-3882-BCEA-A44A43DAA99A.html#GUID-610F12F0-C1B7-39BB-A446-7616BBF84B2C"><code class="apiname">CZipFileMemberIterator::NextL()</code></a>
</li>
<li id="GUID-BB056063-4391-5EC7-A223-ED752E2F1B32"><a name="GUID-BB056063-4391-5EC7-A223-ED752E2F1B32"><!-- --></a><p></p>
The properties of the member file are retrieved using the functions
of <a href="GUID-C6E5F800-0637-419E-8FE5-1EBB40E725AA/GUID-02A8BC62-D653-39A3-BE0C-92A5F3F43E85.html#GUID-C6E5F800-0637-419E-8FE5-1EBB40E725AA/GUID-02A8BC62-D653-39A3-BE0C-92A5F3F43E85.html"><code class="apiname">CZipFileMember</code></a>. 
The <a href="GUID-C6E5F800-0637-419E-8FE5-1EBB40E725AA/GUID-02A8BC62-D653-39A3-BE0C-92A5F3F43E85.html#GUID-C6E5F800-0637-419E-8FE5-1EBB40E725AA/GUID-02A8BC62-D653-39A3-BE0C-92A5F3F43E85.html"><code class="apiname">CZipFileMember</code></a> class retrieves the properties
of the member file once the member file is accessible. 
</li>
<li id="GUID-4EAC4BD5-551B-58A3-A6B4-D4433027F5C8"><a name="GUID-4EAC4BD5-551B-58A3-A6B4-D4433027F5C8"><!-- --></a><p></p>
The files extracted from the archive are stored in the output folder. 
If the output folder is unavailable a new folder is created prior to
archive decompression. 
</li>
</ol>
<div><h3 class="section-title">Example</h3><p>The following example code illustrates the decompression of file
archive. </p><pre class="codeblock">/*
    * Decompresses all the files in "inputarchive.zip" using the EZlib.
    *  If an input filename is not specified it is assumed that the
    * input file name is contained in a provided .ini file.
    */
    void CEZlibEZipTests::DoEZlibZipArchiveDecompressL()
    {
    RFs iFs;
    iFS.connect();
    CleanupClosePushL(iFS);
    TInt err = KErrNone;
    HBufC8 *outputBuffer = HBufC8::NewLC(outputBufferSize);

    _LIT(KInputFileLocation, "c:\\private\\E80000B7\\zip\\input\\inputarchive.zip");
    TFileName inputFile(KInputFileLocation);

    RFile input;
    err = input.Open(iFs, inputFile, EFileStream | EFileRead | EFileShareExclusive);
    if(err != KErrNone)
        {
        INFO_PRINTF1(KOpenFileError);
        User::Leave(err);
        }
    CleanupClosePushL(input);

    CZipFile *zipFile = CZipFile::NewL(iFs,input);
    CleanupStack::PushL(zipFile);
    CZipFileMemberIterator *fileMemberIter = zipFile-&gt;GetMembersL();

    //  iZipArchiveEzlibFolder = GenerateZipArchiveFolderNameL(aInputFileName);
    //  iZipArchiveEzlibFolder.Append(KZipArchiveEzlib);

    for(TOLDEZIP::CZipFileMember *fileMember = fileMemberIter-&gt;NextL(); fileMember != NULL; fileMember = fileMemberIter-&gt;NextL())
        {
        TFileName tmpfilename(*(fileMember-&gt;Name()));

        // Check if we have a folder or file
        TPtrC lastChar = tmpfilename.Right(1);
        if(lastChar.Compare(_L("\\")) != 0 &amp;&amp; lastChar.Compare(_L("/")) != 0)
            {
            RFile output;
            err = output.Replace(iFs, tmpfilename, EFileStream | EFileWrite | EFileShareExclusive);
            if(err != KErrNone)
                {
                INFO_PRINTF1(KCreateFileError);
                User::Leave(err);
                }
            CleanupClosePushL(output);

            TOLDEZIP::RZipFileMemberReaderStream *readerStream;
            zipFile-&gt;GetInputStreamL(fileMember, readerStream);
            CleanupStack::PushL(readerStream);

            TPtr8 pOutputBuffer = outputBuffer-&gt;Des();
            do
                {
                err = readerStream-&gt;Read(pOutputBuffer, outputBufferSize);
                output.Write(pOutputBuffer);
                } while(err == KErrNone);
            if(err != KErrEof)
                {
                User::Leave(err);
                }
            CleanupStack::PopAndDestroy(2);
            }
        else
            {
            TFileName fullPath("c:\\private\\E80000B7\\zip\\input\\");
            fullPath.Append(tmpfilename);
            iRfs.MkDir(fullPath);
            }
        }
    CleanupStack::PopAndDestroy(3);
    }
</pre></div>
</div></div></div><div class="footer"><p class="metadata">Last updated October 26th, 2009</p><hr /><div class="copy">Â© Nokia 2012.</div></div></body>
<!-- Mirrored from devlib.symbian.slions.net/belle/GUID-FDDAF8E9-4CAB-5489-B578-A5362E2140C1.html by HTTrack Website Copier/3.x [XR&CO'2014], Fri, 27 Mar 2020 03:56:01 GMT -->
</html>