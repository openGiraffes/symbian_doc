
<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<!-- Mirrored from devlib.symbian.slions.net/belle/GUID-9EE78D5A-32BC-5E0F-9139-AF00CDB95CC1.html by HTTrack Website Copier/3.x [XR&CO'2014], Fri, 27 Mar 2020 04:04:58 GMT -->
<head><meta http-equiv="Content-Type" content="text/html; charset=utf-8" /><meta name="copyright" content="(C) Copyright 2012" /><meta name="DC.rights.owner" content="(C) Copyright 2012" /><meta name="DC.Type" content="concept" /><meta name="DC.Title" content="How to use the audio tone player utility" /><meta name="DC.Relation" scheme="URI" content="GUID-32E29020-1956-461A-B79A-1492E06049E7" /><meta name="DC.Relation" scheme="URI" content="GUID-1DE5CDAD-8D71-5384-9E98-5665D5A4C792" /><meta name="DC.Relation" scheme="URI" content="GUID-3E341F9F-2635-589B-A59A-B999FE7DF9BE" /><meta name="DC.Relation" scheme="URI" content="GUID-DDE1A8A9-1D67-53BF-8A65-340F139AD4AB" /><meta name="DC.Relation" scheme="URI" content="GUID-EB15EC74-BCCE-591D-8308-210C22CDDDDA" /><meta name="DC.Relation" scheme="URI" content="GUID-03D132BE-5B90-50E1-88D3-D66289C02444" /><meta name="DC.Format" content="XHTML" /><meta name="DC.Identifier" content="GUID-9EE78D5A-32BC-5E0F-9139-AF00CDB95CC1" /><meta name="DC.Language" content="en" /><title>How to use the audio tone player utility </title><link href="css/s60/style.css" rel="stylesheet" type="text/css" /><link href="PLUGINS_ROOT/com.nokia.forum.library/css/category_cpp5.html" rel="stylesheet" type="text/css" /></head><body><div class="body"><div class="contentLeft prTxt"><h1 class="pageHeading" id="GUID-9EE78D5A-32BC-5E0F-9139-AF00CDB95CC1">How to use the audio tone player utility</h1><div>
<p>The Audio Tone Player, provided by the class <a href="GUID-C6E5F800-0637-419E-8FE5-1EBB40E725AA/GUID-D728A286-A202-3915-9643-8FD70646F78A.html#GUID-C6E5F800-0637-419E-8FE5-1EBB40E725AA/GUID-D728A286-A202-3915-9643-8FD70646F78A.html"><code class="apiname">CMdaAudioToneUtility</code></a>, has an interface for generating the following tones on all audio
capable devices. Using this class you can play the following tones: </p>
<ul>
<li id="GUID-6F7555FF-A11D-5D34-9602-75E9B9F4E70E"><a name="GUID-6F7555FF-A11D-5D34-9602-75E9B9F4E70E"><!-- --></a><p>Single tone
of a specified duration and frequency </p> </li>
<li id="GUID-B99BA7D8-E58F-5206-AAEE-55D47DC0629B"><a name="GUID-B99BA7D8-E58F-5206-AAEE-55D47DC0629B"><!-- --></a><p>Dual Tone Multi
Frequency (DTMF) strings </p> </li>
<li id="GUID-97874FB6-0884-53D7-9667-EC96604DEF30"><a name="GUID-97874FB6-0884-53D7-9667-EC96604DEF30"><!-- --></a><p>Sequences of
tones held in files or descriptors </p> </li>
<li id="GUID-B4704DBA-54C9-5B74-B518-2F5EBA1396C9"><a name="GUID-B4704DBA-54C9-5B74-B518-2F5EBA1396C9"><!-- --></a><p>Predefined (fixed)
sequences of tones held in any mobile equipment </p> </li>
</ul>
<p>Client applications such as ringtone applications, use <a href="GUID-C6E5F800-0637-419E-8FE5-1EBB40E725AA/GUID-D728A286-A202-3915-9643-8FD70646F78A.html#GUID-C6E5F800-0637-419E-8FE5-1EBB40E725AA/GUID-D728A286-A202-3915-9643-8FD70646F78A.html"><code class="apiname">CMdaAudioToneUtility</code></a> to generate the tones they produce.
The tone player in turn uses MMF for playing sounds and is also credited
for interfacing with the audio hardware. An active scheduler is needed
for all the clients applications for the use of active objects and
callbacks. </p>
<div id="GUID-B86646DF-E472-556C-B9AF-F82CBAEE468A"><h3 class="section-title">Using
the tone player</h3> <p>The tone player provides a simple interface
to generate single and multiple tones. Once the tone player object
has been constructed, multiple tones and tone sequences can be played
without having to create new instances of the object. </p> <p>Using
the tone player typically involves the following steps: </p> <div class="figure" id="GUID-BF7D8243-53BE-5AF8-B9EF-4E7DC202AA1F"><img src="GUID-8ECEF376-CB27-52FC-A9DD-933ACC24FDDC_d0e401571_href.png" /><p class="figure-title"><strong>Figure: </strong>              Tone Player Utility            </p></div> <ol id="GUID-11853890-B5E8-5797-918B-A1105C35F5BC">
<li id="GUID-C1ED28E3-AF25-562B-B2BC-E70F2790961C"><a name="GUID-C1ED28E3-AF25-562B-B2BC-E70F2790961C"><!-- --></a><p><a href="#GUID-B5EAD538-CB1F-556C-B38D-26A4327B6454">Constructing a tone player </a> </p> </li>
<li id="GUID-ED14F3E0-7FCF-5B7C-B9B3-FCC048480302"><a name="GUID-ED14F3E0-7FCF-5B7C-B9B3-FCC048480302"><!-- --></a><p><a href="#GUID-60775FAF-EB16-5462-9EDD-B18E9831CB70">Preparing a tone player </a> </p> </li>
<li id="GUID-657C713C-82D4-5579-ACBD-1DA372972012"><a name="GUID-657C713C-82D4-5579-ACBD-1DA372972012"><!-- --></a><p><a href="#GUID-BA2A90F5-C36C-547E-B415-C877C22F321A">Playing a tone </a> </p> </li>
<li id="GUID-18F9686A-740F-582C-B4C7-547338231F28"><a name="GUID-18F9686A-740F-582C-B4C7-547338231F28"><!-- --></a><p><a href="#GUID-0E2324A3-9290-56B4-BF68-A00FEF8B26ED">Cancelling a tone </a> </p> </li>
<li id="GUID-BB3FE6DE-FE3B-5E1E-A482-2359D638EE69"><a name="GUID-BB3FE6DE-FE3B-5E1E-A482-2359D638EE69"><!-- --></a><p><a href="#GUID-9D861D80-F6E4-577F-80AB-BD321D413764">Retrieving a custom interface </a> </p> </li>
</ol> <p id="GUID-B5EAD538-CB1F-556C-B38D-26A4327B6454"><a name="GUID-B5EAD538-CB1F-556C-B38D-26A4327B6454"><!-- --></a><strong>Constructing a tone
player</strong> </p> <p>The <a href="GUID-C6E5F800-0637-419E-8FE5-1EBB40E725AA/GUID-D728A286-A202-3915-9643-8FD70646F78A.html#GUID-C6E5F800-0637-419E-8FE5-1EBB40E725AA/GUID-D728A286-A202-3915-9643-8FD70646F78A.html"><code class="apiname">CMdaAudioToneUtility</code></a> object
can be constructed using the <code class="codeph">NewL()</code> member function.
There are two versions of this constructor function: </p> <ul>
<li id="GUID-A395EF84-C992-57B2-9A7A-2F9EE94E4E1E"><a name="GUID-A395EF84-C992-57B2-9A7A-2F9EE94E4E1E"><!-- --></a><p>create a tone
player with default priority settings: </p> <pre class="codeblock">static CMdaAudioToneUtility* NewL(MMdaAudioToneObserver&amp; aObserver, CMdaServer* aServer=NULL);</pre> </li>
<li id="GUID-9152BA40-7543-5915-A508-1E98EAD288FD"><a name="GUID-9152BA40-7543-5915-A508-1E98EAD288FD"><!-- --></a><p>create a tone
player with your own settings: </p> <pre class="codeblock">static CMdaAudioToneUtility* NewL(MMdaAudioToneObserver&amp; aObserver, CMdaServer* aServer, TInt aPriority,
TMdaPriorityPreference aPref=EMdaPriorityPreferenceTimeAndQuality); </pre> </li>
</ul> <p>Both functions pass a reference of the <a href="GUID-C6E5F800-0637-419E-8FE5-1EBB40E725AA/GUID-A6D27F43-AC44-38EA-B16F-31A14390582E.html#GUID-C6E5F800-0637-419E-8FE5-1EBB40E725AA/GUID-A6D27F43-AC44-38EA-B16F-31A14390582E.html"><code class="apiname">MMdaAudioToneObserver</code></a> object to the tone player. The <a href="GUID-C6E5F800-0637-419E-8FE5-1EBB40E725AA/GUID-A6D27F43-AC44-38EA-B16F-31A14390582E.html#GUID-C6E5F800-0637-419E-8FE5-1EBB40E725AA/GUID-A6D27F43-AC44-38EA-B16F-31A14390582E.html"><code class="apiname">MMdaAudioToneObserver</code></a> is an observer interface to notifications from the member functions <a href="#GUID-60775FAF-EB16-5462-9EDD-B18E9831CB70">Prepare</a>, <a href="#GUID-BA2A90F5-C36C-547E-B415-C877C22F321A">Play</a>, and, <a href="#GUID-0E2324A3-9290-56B4-BF68-A00FEF8B26ED">CancelPlay</a> callback functions. </p> <p id="GUID-60775FAF-EB16-5462-9EDD-B18E9831CB70"><a name="GUID-60775FAF-EB16-5462-9EDD-B18E9831CB70"><!-- --></a><strong>Preparing a tone
player</strong> </p> <p>Once the tone player object is created, it has
to be prepared to play a tone or a DTMF string. use one of the following
prepare member functions to get it ready for playing the corresponding
tone. </p> <ul>
<li id="GUID-6B9AFA66-9748-5E38-A712-188A8CA6BA77"><a name="GUID-6B9AFA66-9748-5E38-A712-188A8CA6BA77"><!-- --></a><p> <code class="codeph"> PrepareToPlayTone()</code> - to play a single tone of a fixed frequency (Hz) and duration (microseconds).
For example: </p> <pre class="codeblock">virtual void PrepareToPlayTone(TInt    aFrequency, const TTimeIntervalMicroSeconds&amp; aDuration);</pre> </li>
<li id="GUID-28A30DA0-F52D-59E4-B05D-9A1D8CFBCE2A"><a name="GUID-28A30DA0-F52D-59E4-B05D-9A1D8CFBCE2A"><!-- --></a><p> <code class="codeph">PrepareToPlayDTMFString()</code> - to play a DTMF string held in a descriptor. For example: </p> <pre class="codeblock">virtual void PrepareToPlayDTMFString(const TDesC&amp; aDTMF);</pre> </li>
<li id="GUID-0F67C0F8-E60F-5B42-9536-231FE9086AB7"><a name="GUID-0F67C0F8-E60F-5B42-9536-231FE9086AB7"><!-- --></a><p> <code class="codeph">PrepareToPlayFileSequence()</code> - to play a sequence of non-DTMF tones held in a file. For example: </p> <pre class="codeblock">virtual void PrepareToPlayFileSequence(const TDesC&amp; aFilename);</pre> </li>
<li id="GUID-09048A04-0869-5208-B3BE-51217690527D"><a name="GUID-09048A04-0869-5208-B3BE-51217690527D"><!-- --></a><p> <code class="codeph">PrepareToPlayDesSequence()</code> - to play a sequence of non-DTMF tones held in a descriptor. For
example: </p> <pre class="codeblock">virtual void PrepareToPlayDesSequence(const TDesC8&amp; aSequence);</pre> </li>
<li id="GUID-6328FB13-16F3-51BC-9B13-F00E8B8532DB"><a name="GUID-6328FB13-16F3-51BC-9B13-F00E8B8532DB"><!-- --></a><p> <code class="codeph"> PrepareToPlayFixedSequence()</code> - to play a sequence of non-DTMF tones stored on the mobile equipment.
For example: </p> <pre class="codeblock">virtual void PrepareToPlayFixedSequence(TInt aSequenceNumber); </pre> </li>
<li id="GUID-EB7F1FA3-849F-5169-B88F-49512CD1E14C"><a name="GUID-EB7F1FA3-849F-5169-B88F-49512CD1E14C"><!-- --></a><p> <code class="codeph">PrepareToPlayDualTone()</code> - to play a dual tone. For example: </p> <pre class="codeblock">void PrepareToPlayDualTone(TInt aFrequencyOne, TInt aFrequencyTwo, const TTimeIntervalMicroSeconds&amp; aDuration); </pre> <p>The two tones, aFrequencyOne and aFrequencyTwo, are measured
in Hz, and the duration of the tone, aDuration, is measured in microseconds. </p> </li>
</ul> <p>All the prepare member functions are asynchronous. In response
to each, <a href="GUID-C6E5F800-0637-419E-8FE5-1EBB40E725AA/GUID-D728A286-A202-3915-9643-8FD70646F78A.html#GUID-C6E5F800-0637-419E-8FE5-1EBB40E725AA/GUID-D728A286-A202-3915-9643-8FD70646F78A.html"><code class="apiname">CMdaAudioToneUtility</code></a> creates a <code class="codeph">CMMFToneConfig</code> derived object that stores the data for the
type of tone to play. </p> <p>On completion of a prepare, the observer
function <a href="GUID-C6E5F800-0637-419E-8FE5-1EBB40E725AA/GUID-A6D27F43-AC44-38EA-B16F-31A14390582E.html#GUID-6B3BF4AC-3E50-3927-A09F-E4E5DDD1AECA"><code class="apiname">MMdaAudioToneObserver::MatoPrepareComplete()</code></a> is called, indicating the success or failure of the prepare operation.
If successful you can play the tone. </p> <p>You can cancel any prepare
function using CancelPrepare() (the observer callback
function is <em>not</em> called on completion of the cancel). </p> <p id="GUID-BA2A90F5-C36C-547E-B415-C877C22F321A"><a name="GUID-BA2A90F5-C36C-547E-B415-C877C22F321A"><!-- --></a><strong>Playing a tone</strong> </p> <p>Once the player is prepared successfully, certain configurations
can be done before playing the tone as listed below: </p> <ul>
<li id="GUID-6FAFAB95-55B7-5C74-BF0B-31962859DF32"><a name="GUID-6FAFAB95-55B7-5C74-BF0B-31962859DF32"><!-- --></a><p> Volume() and SetVolume() - This retrieves the current
volume settings and sets to a new value specified by the user respectively. </p> </li>
<li id="GUID-F5BC6F5F-57C0-5BEC-9783-AF06358A59E2"><a name="GUID-F5BC6F5F-57C0-5BEC-9783-AF06358A59E2"><!-- --></a><p> GetBalanceL() and SetBalanceL() - This retrieves the current
balance of the audio device and sets the audio balance specified by
the user respectively.. </p> </li>
<li id="GUID-06D4BAEF-52CF-5CD8-90A2-8163336B016F"><a name="GUID-06D4BAEF-52CF-5CD8-90A2-8163336B016F"><!-- --></a><p> SetPriority() - This sets the priority of the audio device. The priority is defined
to arbitrate between multiple objects trying to access the controller
at the same time. </p> </li>
<li id="GUID-0109EFE3-8CA8-5E5A-B4F5-693E87BEEE0E"><a name="GUID-0109EFE3-8CA8-5E5A-B4F5-693E87BEEE0E"><!-- --></a><p> SetVolumeRamp() - This defines the period over which the volume level is to rise
(in microseconds) smoothly from zero to the specified volume level.
A value of <code class="codeph">0</code> causes the tone to be played at the <code class="codeph">SetVolume()</code> level for the full duration of the playback.
A value that is longer than the duration of the tone sequence means
that the tone never reaches the specified volume. </p> <pre class="codeblock">virtual void SetVolumeRamp(const TTimeIntervalMicroSeconds &amp;aRampDuration);</pre> </li>
<li id="GUID-47A3F620-FA41-5A85-B9E4-3D8BA3D9251B"><a name="GUID-47A3F620-FA41-5A85-B9E4-3D8BA3D9251B"><!-- --></a><p> SetDTMFLengths()  - This alters the duration of DTMF tone, the gaps between two DTMF
tones, and the pauses in microseconds. </p> </li>
<li id="GUID-5AC9A8EF-995D-5FD7-9AAD-309673819F33"><a name="GUID-5AC9A8EF-995D-5FD7-9AAD-309673819F33"><!-- --></a><p> FixedSequenceCount()  - This returns the number of available pre-defined tone sequences,
the number always being greater than zero. </p> </li>
<li id="GUID-A5118A3F-43BF-5A34-B552-C0B57937928B"><a name="GUID-A5118A3F-43BF-5A34-B552-C0B57937928B"><!-- --></a><p> FixedSequenceName() - This returns the name of the specified fixed tone sequence. </p> </li>
</ul> <p>Upon successful configuration, the Play() can be called as
shown below. </p> <p> <code class="codeph"> Play()</code> - plays the tone, DTMF
or tone sequence specified by the prepare statement. For example: </p> <pre class="codeblock">virtual void Play();</pre> <p>Here, the tone player uses the Play() from
the audio player utility to play the tone. </p> <p>This function is
asynchronous. It retrieves the details of the type of tone to play
from the previous <code class="codeph">Prepare</code> statement. When the tone
has been played to completion, the observer callback function <a href="GUID-C6E5F800-0637-419E-8FE5-1EBB40E725AA/GUID-A6D27F43-AC44-38EA-B16F-31A14390582E.html#GUID-65AAF2C6-FD4F-3365-99F7-FCD15287A1B9"><code class="apiname">MMdaAudioToneObserver::MatoPlayComplete()</code></a> is called, indicating
the success or failure of the play operation. The play operation can
be cancelled by calling the <a href="#GUID-0E2324A3-9290-56B4-BF68-A00FEF8B26ED">CancelPlay()</a> member function. </p> <p>Playing the tone or
DTMF string can be customised using the following member functions
as mentioned below: </p> <ul>
<li id="GUID-03F93CEA-1B61-5262-B720-2313E79662E6"><a name="GUID-03F93CEA-1B61-5262-B720-2313E79662E6"><!-- --></a><p> <code class="codeph">SetRepeats()</code> - sets the number of times the tone sequence (plus an optional trailing
silent period, measured in microseconds) is repeated during the play
operation. For example: </p> <pre class="codeblock">virtual void SetRepeats(TInt aRepeatNumberOfTimes, const TTimeIntervalMicroSeconds &amp;aTrailingSilence);</pre> <p>You can repeat the tone sequence indefinitely by setting <code class="codeph">aRepeatNumberOfTimes</code> to <code class="codeph">KMdaRepeatForever</code>. </p> </li>
<li id="GUID-5E34283D-17EF-59FC-842E-AD54DF7659C4"><a name="GUID-5E34283D-17EF-59FC-842E-AD54DF7659C4"><!-- --></a><p> <code class="codeph">State()</code> - returns the current state of the tone player (an enum): </p> <ul>
<li id="GUID-A997198F-F638-5071-9333-6835E24EB23B"><a name="GUID-A997198F-F638-5071-9333-6835E24EB23B"><!-- --></a><p> <code class="codeph">EMdaAudioToneUtilityNotReady</code> - not prepared to play a tone </p> </li>
<li id="GUID-CAF8DAEB-E147-5F08-B86C-E3C3735690EB"><a name="GUID-CAF8DAEB-E147-5F08-B86C-E3C3735690EB"><!-- --></a><p> <code class="codeph">EMdaAudioToneUtilityPrepared</code> - prepared and ready to play a tone </p> </li>
<li id="GUID-F10E01C6-F237-58E9-8213-423FEAAE3DDC"><a name="GUID-F10E01C6-F237-58E9-8213-423FEAAE3DDC"><!-- --></a><p> <code class="codeph">EMdaAudioToneUtilityPlaying</code> - currently playing a tone </p> </li>
</ul> <p>For example: </p> <pre class="codeblock">virtual TMdaAudioToneUtilityState State();</pre> </li>
</ul> <p>To play another tone or sequence, either wait for <a href="GUID-C6E5F800-0637-419E-8FE5-1EBB40E725AA/GUID-A6D27F43-AC44-38EA-B16F-31A14390582E.html#GUID-65AAF2C6-FD4F-3365-99F7-FCD15287A1B9"><code class="apiname">MMdaAudioToneObserver::MatoPlayComplete()</code></a> callback to be
issued when the current tone or DTMF string completes playing, or
use <a href="#GUID-0E2324A3-9290-56B4-BF68-A00FEF8B26ED">CancelPlay()</a> and then issue the relevant prepare statement.
The Play() function following the prepare statement
plays the tone or DTMF string based on the previously issued prepare
statement. </p> <p id="GUID-0E2324A3-9290-56B4-BF68-A00FEF8B26ED"><a name="GUID-0E2324A3-9290-56B4-BF68-A00FEF8B26ED"><!-- --></a><strong>Cancelling a tone</strong> </p> <p> CancelPlay() - cancels the tone, DTMF,
or tone sequence currently playing. For example: </p> <pre class="codeblock">virtual void CancelPlay();</pre> <p>The observer callback function is <em>not</em> called on completion
of the cancel. </p> <p id="GUID-9D861D80-F6E4-577F-80AB-BD321D413764"><a name="GUID-9D861D80-F6E4-577F-80AB-BD321D413764"><!-- --></a><strong>Retrieving a custom
interface</strong> </p> <p>To retrieve a custom interface to the underlying
device, use the <code class="codeph">CustomInterface()</code> member function.
For example: </p> <pre class="codeblock">IMPORT_C TAny *CustomInterface(TUid aInterfaceId);</pre> <p> <code class="codeph">aInterfaceId</code> is the UID of the interface function
required. </p> <p>The function returns a pointer to the interface
implementation, or NULL if the device does not implement the interface
requested. You must cast the return value to the correct type. </p> </div>
<div id="GUID-E2511DB8-AC9C-48ED-8877-37BFA7FB3647"><h3 class="section-title">See
Also</h3> <p><a href="GUID-F46E4F89-B9ED-5A4A-B812-B605B925D0C0.html">How to use the audio convert utility</a> </p> </div>
</div></div></div><div class="footer"><p class="metadata">Last updated July 8th, 2010</p><hr /><div class="copy">© Nokia 2012.</div></div></body>
<!-- Mirrored from devlib.symbian.slions.net/belle/GUID-9EE78D5A-32BC-5E0F-9139-AF00CDB95CC1.html by HTTrack Website Copier/3.x [XR&CO'2014], Fri, 27 Mar 2020 04:04:59 GMT -->
</html>