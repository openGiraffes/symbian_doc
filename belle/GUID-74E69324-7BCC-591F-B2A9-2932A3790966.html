
<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<!-- Mirrored from devlib.symbian.slions.net/belle/GUID-74E69324-7BCC-591F-B2A9-2932A3790966.html by HTTrack Website Copier/3.x [XR&CO'2014], Fri, 27 Mar 2020 04:09:22 GMT -->
<head><meta http-equiv="Content-Type" content="text/html; charset=utf-8" /><meta name="copyright" content="(C) Copyright 2012" /><meta name="DC.rights.owner" content="(C) Copyright 2012" /><meta name="DC.Type" content="concept" /><meta name="DC.Title" content="How to manipulate simple global text" /><meta name="DC.Relation" scheme="URI" content="GUID-32E29020-1956-461A-B79A-1492E06049E7" /><meta name="DC.Relation" scheme="URI" content="GUID-1DCA2F4D-ABE6-52A0-AC4E-5AAC1AB5909D" /><meta name="DC.Relation" scheme="URI" content="GUID-4F901F56-7F0E-4869-85CA-6109ED0AF5B7" /><meta name="DC.Relation" scheme="URI" content="GUID-533EC918-BF5B-5D0B-8860-1E8746A05EE3" /><meta name="DC.Relation" scheme="URI" content="GUID-2DDEF473-B804-51DF-874F-ADF46CB03ABA" /><meta name="DC.Format" content="XHTML" /><meta name="DC.Identifier" content="GUID-74E69324-7BCC-591F-B2A9-2932A3790966" /><meta name="DC.Language" content="en" /><title>How to manipulate simple global text </title><link href="css/s60/style.css" rel="stylesheet" type="text/css" /><link href="PLUGINS_ROOT/com.nokia.forum.library/css/category_cpp5.html" rel="stylesheet" type="text/css" /></head><body><div class="body"><div class="contentLeft prTxt"><h1 class="pageHeading" id="GUID-74E69324-7BCC-591F-B2A9-2932A3790966">How to manipulate simple global text</h1><div><div><h3 class="section-title">Creating a global text object</h3> <p>A <em>global text object</em> has global <em>paragraph</em> and <em>character</em> formatting. Its formatting is stored in a paragraph and a character <em>format layer</em>. To create a global text object, you need to create these layers, and pass them as parameters to the CGlobalText constructor:</p> <pre class="codeblock">CGlobalText* iglobalText; // global text document
CParaFormatLayer* iparaFormatLayer;
CCharFormatLayer* icharFormatLayer; 
iparaFormatLayer=CParaFormatLayer::NewL(); // required para format
icharFormatLayer=CCharFormatLayer::NewL(); // required char format
iglobalText=CGlobalText::NewL(iparaFormatLayer, icharFormatLayer);</pre> <p><strong>Notes</strong> </p> <ul><li id="GUID-EC58C950-BAAA-5F3E-92A4-0331872048C9"><a name="GUID-EC58C950-BAAA-5F3E-92A4-0331872048C9"><!-- --></a><p>The code above constructs a global text object which uses default paragraph and character formatting.</p> </li> <li id="GUID-4239E00E-221A-5B14-8630-02629AA17B60"><a name="GUID-4239E00E-221A-5B14-8630-02629AA17B60"><!-- --></a><p>Rich text is formatted in exactly the same way as global text, except that the length and position arguments now are relevant and must specify a valid range of characters. Only characters in the range specified are affected.</p> </li> <li id="GUID-E35FC190-0D69-5E43-9041-3243FE20DD8A"><a name="GUID-E35FC190-0D69-5E43-9041-3243FE20DD8A"><!-- --></a><p>The global text object does <em>not</em> take on ownership of these <em>format layers</em>. This allows several global text objects to share the same format layers. Therefore, if you have only a single global text object, you must destroy not only it, but the format layers also:</p> </li> </ul> <pre class="codeblock">delete iglobalText; // delete contained document
delete icharFormatLayer; // delete char format layer
delete iparaFormatLayer; // and para format layer</pre> <p>If you had several global text objects sharing the same format layers, you would destroy the format layers only after all the text objects had been destroyed.</p> </div> <div><h3 class="section-title">Inserting text and paragraphs</h3> <p>Text may be inserted using <code class="codeph">InsertL()</code>, specifying a <em>document position</em> and the text to insert.</p> <pre class="codeblock">iGlobalText-&gt;InsertL(0,_L("Hello!"));
iGlobalText-&gt;InsertL(5,_L(" World"));
iGlobalText-&gt;InsertL(12,CEditableText::EParagraphDelimiter);
    // insert paragraph marker
iGlobalText-&gt;InsertL(13,_L("And hello again!"));
    // insert text to follow this marker</pre> <p><strong>Note</strong> </p> <ul><li id="GUID-BE90B234-2B52-5ECC-9280-6898304CDB6C"><a name="GUID-BE90B234-2B52-5ECC-9280-6898304CDB6C"><!-- --></a><p>The code inserts two character strings into the text at document positions 0 and 5. Position 5 is the position between the fifth and sixth characters. A new <em>paragraph delimiter</em> and some more text is then inserted.</p> </li> </ul> </div> <div><h3 class="section-title">Extracting information and text</h3> <p>The following example code extracts information about a text object and about a word within the text object and reads the word at a document position. The status message <code class="codeph">iMessage</code> (a <code class="codeph">TBuf&lt;80&gt;</code>) is used to display the number of <em>characters</em>, <em>words</em> and <em>paragraphs</em> in the global text object.</p> <p><code class="codeph">ParagraphCount()</code> always returns a count of at least one due to the existence of the terminating <em>paragraph
  delimiter</em> at the end of every text object.</p> <pre class="codeblock">iMessage.Format(_L("chars=%d, words=%d, paras=%d"),
iGlobalText-&gt;DocumentLength(),
        // length up to and excluding final para mark
iGlobalText-&gt;WordCount(), // white-space delimited words
iGlobalText-&gt;ParagraphCount()); // paras including the final one</pre> <p>In the following example information about the word containing the character at a specified document position, and the word itself, are extracted and printed.</p> <p><code class="codeph">CGlobalText::GetWordInfo()</code> is used to extract information about a word and <code class="codeph">CGlobalText::Read()</code> to obtain a read-only pointer to the word. </p> <pre class="codeblock">TInt pos=65; // Choose an arbitrary document position
TInt startPos, length; // results of function
iGlobalText-&gt;GetWordInfo(pos,startPos,length,EFalse,ETrue);
// Read length (the length of the word at position pos) number of 
// characters beginning at startPos (start of word at pos). 
TPtrC pointer=iGlobalText-&gt;Read(startPos,length);
// Print word and word info
iMessage.Format(_L("Word at pos %d (\"%S\") has"
        " %d characters, starts at position %d"),
            pos, &amp;pointer, length, startPos);</pre> <pre class="codeblock">// insert huge amounts of text
...</pre> </div> <div><h3 class="section-title">Using fields</h3> <p>Before any field, apart from the page number field in a<em>header</em> or <em>footer</em>, can be inserted into a document, a field factory must be declared. A field factory is a class which derives from the <a href="GUID-C6E5F800-0637-419E-8FE5-1EBB40E725AA/GUID-6202B0B7-663C-3172-BE13-88D77081B42C.html#GUID-C6E5F800-0637-419E-8FE5-1EBB40E725AA/GUID-6202B0B7-663C-3172-BE13-88D77081B42C.html"><code class="apiname">MTextFieldFactory</code></a> class, and which defines a <a href="GUID-C6E5F800-0637-419E-8FE5-1EBB40E725AA/GUID-6202B0B7-663C-3172-BE13-88D77081B42C.html#GUID-0391FC8A-9206-3118-A057-5549E49D2309"><code class="apiname">MTextFieldFactory::NewFieldL()</code></a> function. The function constructs new fields according to a<em>UID</em> passed into the function.</p> <p> The steps involved before the field factory can be used to create and insert a field are as follwows</p> <ol id="GUID-FFE9F7BC-A4A1-5B27-BA07-FE2985F9BEF1"><li id="GUID-7232879E-58FF-50F7-8E40-5BEC68193FC1"><a name="GUID-7232879E-58FF-50F7-8E40-5BEC68193FC1"><!-- --></a><p>Instantiate a field factory. </p> </li> <li id="GUID-EF54FC5C-F23D-5E84-A2E9-72239B96FF08"><a name="GUID-EF54FC5C-F23D-5E84-A2E9-72239B96FF08"><!-- --></a><p>Set that factory to be the text object's field factory</p> </li> <li id="GUID-5B5CF95A-5280-5E80-AAD0-FCFD0343944C"><a name="GUID-5B5CF95A-5280-5E80-AAD0-FCFD0343944C"><!-- --></a><p>Construct a field using <code class="codeph">CPlainText::NewTextFieldL()</code> </p> </li> <li id="GUID-E9F3EFAD-5307-5E6D-BA91-5653ED4537DF"><a name="GUID-E9F3EFAD-5307-5E6D-BA91-5653ED4537DF"><!-- --></a><p>If, for example, a date/time field is to be inserted, format it as required. By default, the date/time is formatted as dd/mm/yyyy. </p> </li> <li id="GUID-65F09753-B14B-5F7E-97F8-8D873ED8C7CE"><a name="GUID-65F09753-B14B-5F7E-97F8-8D873ED8C7CE"><!-- --></a><p>Insert the field at the desired document position</p> </li> <li id="GUID-851024F4-E31D-5020-92D1-22DE1685EAA0"><a name="GUID-851024F4-E31D-5020-92D1-22DE1685EAA0"><!-- --></a><p>Update the field. Until this is done, no field text will be visible. Also, care must be taken that the field length is not greater than 20 characters (the maximum field length), otherwise <code class="codeph">UpdateFieldL()</code> will panic. The first time the field is updated, the position specified must be the position at which the field was inserted. Subsequent updates may specify any position within the field.</p> </li> <li id="GUID-C451C955-CDEB-5940-9D9D-182E1F33545C"><a name="GUID-C451C955-CDEB-5940-9D9D-182E1F33545C"><!-- --></a><p>CPlainText::FindFields() may be used to get information about a field, including its start position and length.</p> </li> </ol> </div> <div><h3 class="section-title">Paragraph formatting</h3> <p>The following code centre aligns the text. Alignment is a<em>paragraph format attribute</em> and is a member of the CParaFormat class. All paragraph format attributes which are not explicitly set are taken from the system-provided default settings. </p> <p>Use CGlobalText::ApplyParaFormatL() to globally change the paragraph formatting. In this example, the position and the length arguments are redundant because the formatting is applied globally. However, they must be specified, although their values are irrelevant. </p> <p>To set or clear paragraph format attributes, use aTParaFormatMask in conjunction with an object of class<code class="codeph">CParaFormat</code>. The attributes specified in the mask are set according to the corresponding value contained in <code class="codeph">CParaFormat</code>. Any attributes not specified in the mask are unaffected.</p> <pre class="codeblock">CParaFormat* paraFormat=CParaFormat::NewLC();
TParaFormatMask paraFormatMask; 
paraFormat-&gt;iHorizontalAlignment=CParaFormat::ECenterAlign; 
        // set centered
paraFormatMask.SetAttrib(EAttAlignment); // interested in alignment
iglobalText-&gt;ApplyParaFormatL(paraFormat,paraFormatMask,0,0);
        // apply format under mask - pos and length irrelevant
CleanupStack::PopAndDestroy();  // paraFormat </pre> <p><strong>Note</strong> </p> <ul><li id="GUID-327FE937-FB69-58EF-9032-71DDBCF913E6"><a name="GUID-327FE937-FB69-58EF-9032-71DDBCF913E6"><!-- --></a><p>An alternative method to using <code class="codeph">ApplyParaFormatL()</code> for global text is to directly set the formatting of the global <em>paragraph
format layer</em> upon which the object's paragraph formatting is based. This may be done by using either CParaFormatLayer::SetL(), to reset the formatting of the existing layer, orCGlobalText::SetGlobalParaFormat() which sets a new layer. Both methods cause all attributes to be reset; no mask is specified.</p> </li> </ul> </div> <div><h3 class="section-title">Character formatting</h3> <p>The following code globally sets the bold, italic and underline<em>character format attributes</em>. These attributes are accessed through the <code class="codeph">iFontPresentation</code> and<code class="codeph">iFontStyle</code> members of the TCharFormat class. Any attributes not explicitly set are taken from the system-provided default settings. </p> <p>Global character formatting is applied in a similar manner to paragraph formatting, using a TCharFormatMask in conjunction with a<code class="codeph">TCharFormat</code>, then calling<code class="codeph">CGlobalText::ApplyCharFormatL()</code>.</p> <pre class="codeblock">charFormatMask.SetAttrib(EAttFontUnderline); // set underline
charFormatMask.SetAttrib(EAttFontPosture); // and posture (for italic)
charFormatMask.SetAttrib(EAttFontStrokeWeight); // and weight (for 
    // bold)
charFormat.iFontPresentation.iUnderline=EUnderlineOn;
charFormat.iFontSpec.iFontStyle.SetPosture(EPostureItalic);
charFormat.iFontSpec.iFontStyle.SetStrokeWeight(EStrokeWeightBold);
// apply format under mask
iGlobalText-&gt;ApplyCharFormatL(charFormat,charFormatMask,0,0);</pre> <p><strong>Note</strong> </p> <ul><li id="GUID-DF042F94-88C1-5F1C-B21A-17DF58EEBCD4"><a name="GUID-DF042F94-88C1-5F1C-B21A-17DF58EEBCD4"><!-- --></a><p>No more than one attribute can be specified in the argument toTCharFormatMask::SetAttrib(). To set more than one attribute in a single call to <code class="codeph">ApplyCharFormatL()</code>, either use several calls to<code class="codeph">SetAttrib()</code>, as above, or useTCharFormatMask::SetAll() to set all attributes in the mask.</p> </li> </ul> </div> </div></div></div><div class="footer"><p class="metadata">Last updated October 9th, 2009</p><hr /><div class="copy">© Nokia 2012.</div></div></body>
<!-- Mirrored from devlib.symbian.slions.net/belle/GUID-74E69324-7BCC-591F-B2A9-2932A3790966.html by HTTrack Website Copier/3.x [XR&CO'2014], Fri, 27 Mar 2020 04:09:22 GMT -->
</html>