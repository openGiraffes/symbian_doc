
<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<!-- Mirrored from devlib.symbian.slions.net/belle/GUID-1C499E7D-8099-5BE4-AE46-6143388E6ACB.html by HTTrack Website Copier/3.x [XR&CO'2014], Fri, 27 Mar 2020 04:05:00 GMT -->
<head><meta http-equiv="Content-Type" content="text/html; charset=utf-8" /><meta name="copyright" content="(C) Copyright 2012" /><meta name="DC.rights.owner" content="(C) Copyright 2012" /><meta name="DC.Type" content="concept" /><meta name="DC.Title" content="Audio Input Streaming Tutorial" /><meta name="DC.Relation" scheme="URI" content="GUID-32E29020-1956-461A-B79A-1492E06049E7" /><meta name="DC.Relation" scheme="URI" content="GUID-1DE5CDAD-8D71-5384-9E98-5665D5A4C792" /><meta name="DC.Relation" scheme="URI" content="GUID-3E341F9F-2635-589B-A59A-B999FE7DF9BE" /><meta name="DC.Relation" scheme="URI" content="GUID-DDE1A8A9-1D67-53BF-8A65-340F139AD4AB" /><meta name="DC.Relation" scheme="URI" content="GUID-C6E3A784-EE17-5A3C-9D81-9662114FD923" /><meta name="DC.Relation" scheme="URI" content="GUID-C2BF3044-CC37-554D-9496-C7B18AE94561" /><meta name="DC.Format" content="XHTML" /><meta name="DC.Identifier" content="GUID-1C499E7D-8099-5BE4-AE46-6143388E6ACB" /><meta name="DC.Language" content="en" /><title>Audio Input Streaming Tutorial </title><link href="css/s60/style.css" rel="stylesheet" type="text/css" /><link href="PLUGINS_ROOT/com.nokia.forum.library/css/category_cpp5.html" rel="stylesheet" type="text/css" /></head><body><div class="body"><div class="contentLeft prTxt"><h1 class="pageHeading" id="GUID-1C499E7D-8099-5BE4-AE46-6143388E6ACB">Audio Input Streaming Tutorial</h1><div><p>This tutorial describes how to use Audio Input Streaming. </p> <div><h3 class="section-title">Purpose</h3> <p>The purpose of this tutorial is to show you how to open, read and then close an audio input stream. </p> <p><strong>Required Background</strong> </p> <p>The <a href="GUID-715E0EA4-8B3D-5DDF-B773-922E367B114F.html">Audio Input Streaming Overview</a> provides an introduction to Audio Input Streaming. </p> <p><strong>Introduction</strong> </p> <p>The audio input stream interface class, <a href="GUID-C6E5F800-0637-419E-8FE5-1EBB40E725AA/GUID-92BDB3AF-D9DB-35E2-AC6F-6435D3D1A4D8.html#GUID-C6E5F800-0637-419E-8FE5-1EBB40E725AA/GUID-92BDB3AF-D9DB-35E2-AC6F-6435D3D1A4D8.html"><code class="apiname">CMdaAudioInputStream</code></a>, enables MMF client applications to: </p> <ul><li id="GUID-577E976A-11CC-5054-ABDE-522A30B5FDCF"><a name="GUID-577E976A-11CC-5054-ABDE-522A30B5FDCF"><!-- --></a><p>stream audio data from the low level audio controller (which has collected it from a hardware device, such as a microphone) to specified buffers (record audio). </p> </li> <li id="GUID-71E21858-E184-5B07-AE02-EFBE8F823B6E"><a name="GUID-71E21858-E184-5B07-AE02-EFBE8F823B6E"><!-- --></a><p>specify the priority of the audio stream relative to other clients trying to use the same audio hardware </p> </li> <li id="GUID-BA394ADC-BC3F-5896-BAD0-EB24759DBD36"><a name="GUID-BA394ADC-BC3F-5896-BAD0-EB24759DBD36"><!-- --></a><p>set the sample rate and the number of channels to use for recording. </p> </li> <li id="GUID-1CEAC638-A49F-5A21-91FC-90B6B56522EA"><a name="GUID-1CEAC638-A49F-5A21-91FC-90B6B56522EA"><!-- --></a><p>change the gain and channel balance of the input stream. </p> </li> </ul> <p>The low level audio controller stores the audio data in buffers. <a href="GUID-C6E5F800-0637-419E-8FE5-1EBB40E725AA/GUID-92BDB3AF-D9DB-35E2-AC6F-6435D3D1A4D8.html#GUID-C6E5F800-0637-419E-8FE5-1EBB40E725AA/GUID-92BDB3AF-D9DB-35E2-AC6F-6435D3D1A4D8.html"><code class="apiname">CMdaAudioInputStream</code></a> reads these buffers incrementally and does not have to wait until capture is complete. </p> </div> <div><h3 class="section-title">Using Audio Input Streaming </h3> <p>Typically, using an audio input stream involves the following steps as shown in the sequence diagram below: </p> <div class="figure" id="GUID-FC960A5D-EDE5-5245-A736-6A6C00A0AC33"><img src="GUID-65885916-0242-5DDB-9D88-EB214096C4DF_d0e402412_href.png" /></div> <p>The following tasks will be covered in this tutorial: </p> <ul><li id="GUID-1E1A247E-3740-5CAB-AEB7-171F455EE429"><a name="GUID-1E1A247E-3740-5CAB-AEB7-171F455EE429"><!-- --></a><p><a href="#GUID-196AFBAE-8264-5DE2-994D-F2F06CF5CF3A"> Constructing an audio input stream</a> </p> </li> <li id="GUID-2744A8AE-A82C-5DAC-8C12-87D9B5ADCA6F"><a name="GUID-2744A8AE-A82C-5DAC-8C12-87D9B5ADCA6F"><!-- --></a><p><a href="#GUID-51B28404-61E7-54E8-9F4E-730315308EA2">Opening an audio input stream</a> </p> </li> <li id="GUID-98480431-5F02-57D0-9564-7F0FFF2782C8"><a name="GUID-98480431-5F02-57D0-9564-7F0FFF2782C8"><!-- --></a><p><a href="#GUID-4EAC65E0-E108-5BAA-B338-5B19B82D5057"> Getting and setting the stream properties</a> </p> </li> <li id="GUID-C03B920D-396F-5A44-9A76-77709CE45D2B"><a name="GUID-C03B920D-396F-5A44-9A76-77709CE45D2B"><!-- --></a><p><a href="#GUID-BD91C4E9-9BBA-5442-A72E-01B42160DBDA"> Reading an audio input stream</a> </p> </li> <li id="GUID-91F3BEEE-52D7-504C-B74D-5C2FB8D59004"><a name="GUID-91F3BEEE-52D7-504C-B74D-5C2FB8D59004"><!-- --></a><p><a href="#GUID-5811A2A0-5793-5FBB-B01A-AD94590955A8">Stopping an audio input stream</a> </p> </li> </ul> <p id="GUID-196AFBAE-8264-5DE2-994D-F2F06CF5CF3A"><a name="GUID-196AFBAE-8264-5DE2-994D-F2F06CF5CF3A"><!-- --></a><strong>Basic Procedure to Construct an Audio Input Stream</strong> </p> <p>The high level step to construct an audio input stream is shown here: </p> <ul><li id="GUID-DDD98263-FD3A-5057-8E35-72D237807343"><a name="GUID-DDD98263-FD3A-5057-8E35-72D237807343"><!-- --></a><p>The client application creates an audio input stream object using the static function <a href="GUID-C6E5F800-0637-419E-8FE5-1EBB40E725AA/GUID-92BDB3AF-D9DB-35E2-AC6F-6435D3D1A4D8.html#GUID-D534A585-D2B7-3906-AD82-E14A5FC1D501"><code class="apiname">CMdaAudioInputStream::NewL()</code></a>. The input stream class provides two versions of the constructor: one with the default priority and preferences, and another with specified priority and preferences. The client application must also implement the observer class <a href="GUID-C6E5F800-0637-419E-8FE5-1EBB40E725AA/GUID-6A1EAD31-95CA-3CAC-8897-791E9D522DF0.html#GUID-C6E5F800-0637-419E-8FE5-1EBB40E725AA/GUID-6A1EAD31-95CA-3CAC-8897-791E9D522DF0.html"><code class="apiname">MMdaAudioInputStreamCallback</code></a> to notify it about audio input streaming progress. </p> <p>The following code constructs an audio input stream: </p> <pre class="codeblock">CMdaAudioInputStream* aInputStream;
aInputStream = CMdaAudioInputStream::NewL(aCallback, EMdaPriorityNormal, EMdaPriorityPreferenceTimeAndQuality);</pre> <p>where, <code class="codeph">aCallback</code> is an <a href="GUID-C6E5F800-0637-419E-8FE5-1EBB40E725AA/GUID-6A1EAD31-95CA-3CAC-8897-791E9D522DF0.html#GUID-C6E5F800-0637-419E-8FE5-1EBB40E725AA/GUID-6A1EAD31-95CA-3CAC-8897-791E9D522DF0.html"><code class="apiname">MMdaAudioInputStreamCallback</code></a> object. </p> </li> </ul> <p id="GUID-51B28404-61E7-54E8-9F4E-730315308EA2"><a name="GUID-51B28404-61E7-54E8-9F4E-730315308EA2"><!-- --></a><strong>Basic Procedure to Open an Audio Input Stream</strong> </p> <p>The high level steps to open an audio input stream are shown here: </p> <ol id="GUID-67E0F7C7-E2E3-5882-A21F-254CB2EEBDA3"><li id="GUID-B3AE7481-9750-5352-B10B-D51D1A220F97"><a name="GUID-B3AE7481-9750-5352-B10B-D51D1A220F97"><!-- --></a><p>To open an input stream, use the Open() member function, which provides a pointer to the <a href="GUID-C6E5F800-0637-419E-8FE5-1EBB40E725AA/GUID-06892E22-2EAC-305A-9D3A-F24E7F903427.html#GUID-C6E5F800-0637-419E-8FE5-1EBB40E725AA/GUID-06892E22-2EAC-305A-9D3A-F24E7F903427.html"><code class="apiname">TMdaPackage</code></a> object with the required audio settings. You can also open the stream without the audio settings. For example: </p> <pre class="codeblock">aInputStream-&gt;Open(NULL);</pre> </li> <li id="GUID-8D443EF2-2FD1-5DBD-BEB3-21C5B7855978"><a name="GUID-8D443EF2-2FD1-5DBD-BEB3-21C5B7855978"><!-- --></a><p>Once the stream is open, a <a href="GUID-C6E5F800-0637-419E-8FE5-1EBB40E725AA/GUID-6A1EAD31-95CA-3CAC-8897-791E9D522DF0.html#GUID-1F9A4EAF-EE58-3FA4-8707-D8C5EDFC0664"><code class="apiname">MMdaAudioInputStreamCallback::MaiscOpenComplete()</code></a> is issued to indicate that the stream is ready for use. </p> <pre class="codeblock">void CIOStreamAudio::MaiscOpenComplete(TInt aError)
    {
    ASSERT(iState==EStateOpeningInput);
    if (aError!=KErrNone)
        {
        Complete(aError);
        }
    else
        {
        iMainBuffer.Zero();
        iState = EStateReading;
        ReadNextBlock(KNullDesC8); // kick off a new read - KNullDesC8 for first buffer
        }
    }</pre> </li> </ol> <p id="GUID-4EAC65E0-E108-5BAA-B338-5B19B82D5057"><a name="GUID-4EAC65E0-E108-5BAA-B338-5B19B82D5057"><!-- --></a><strong>Basic Procedure to Get and Set Stream Properties </strong> </p> <p>The high level steps to get and set stream properties are shown here: </p> <ol id="GUID-98A49133-59B7-5681-9EC0-C19B1D71E9DD"><li id="GUID-DD84E50F-B44A-5ADC-ADF5-5DDE561D9AFD"><a name="GUID-DD84E50F-B44A-5ADC-ADF5-5DDE561D9AFD"><!-- --></a><p>To set the sampling rate and number of audio channels, use the SetAudioPropertiesL() member function. You can do this only if the stream is open and if data is not being streamed. Values must be specified as enum values. For example, <a href="GUID-C6E5F800-0637-419E-8FE5-1EBB40E725AA/GUID-CF54F882-E290-3C68-9352-79C6B7303FDF.html#GUID-681C1220-0CDD-34BF-848F-9DC82CB001DB"><code class="apiname">TMdaAudioDataSettings::ESampleRate8000Hz</code></a> and not <code class="codeph">8000</code> (Hz). The following code sets the sampling rate to 8000Hz and audio channel to mono: </p> <pre class="codeblock">aInputStream-&gt;SetAudioPropertiesL(TMdaAudioDataSettings::ESampleRate8000Hz,TMdaAudioDataSettings::EChannelsMono));</pre> </li> <li id="GUID-EE508886-465A-581D-9FAF-76B5C522433F"><a name="GUID-EE508886-465A-581D-9FAF-76B5C522433F"><!-- --></a><p>The Gain() and GetBalanceL() member functions let you determine the current gain and balance settings. </p> </li> <li id="GUID-AEABCD16-7828-5DA1-B234-58BF44FB9C0E"><a name="GUID-AEABCD16-7828-5DA1-B234-58BF44FB9C0E"><!-- --></a><p>The SetGain() and SetBalanceL() member functions let you set the gain and balance respectively. You can use them while the stream is open, with the new settings taking immediate effect. </p> </li> </ol> <p id="GUID-BD91C4E9-9BBA-5442-A72E-01B42160DBDA"><a name="GUID-BD91C4E9-9BBA-5442-A72E-01B42160DBDA"><!-- --></a><strong>Basic Procedure to Read an Audio Input Stream</strong> </p> <p>The high level steps to read an audio input stream are shown here: </p> <ol id="GUID-D78033B0-4918-51B8-8DC0-8B55F0172AC3"><li id="GUID-47C7BE03-0EAA-5C19-8FBB-7723B2AA9DEC"><a name="GUID-47C7BE03-0EAA-5C19-8FBB-7723B2AA9DEC"><!-- --></a><p>To record the audio stream, use the ReadL() member function, specifying the buffer to use. The first ReadL() after a successful Open(), starts audio recording. Once the buffer is successfully recorded, a pointer to it is returned by <a href="GUID-C6E5F800-0637-419E-8FE5-1EBB40E725AA/GUID-6A1EAD31-95CA-3CAC-8897-791E9D522DF0.html#GUID-FB4EC66A-4B6D-331B-B5A1-4605084343B0"><code class="apiname">MMdaAudioInputStreamCallback::MaiscBufferCopied()</code></a> callback. </p> <pre class="codeblock">void CIOStreamAudio::MaiscBufferCopied(TInt aError, const TDesC8&amp; aBuffer)
    {
    ASSERT(iState==EStateReading);
    if (aError!=KErrNone)
        {
        if (aError!=KErrAbort) // aborts happen on Stop as buffers are recovered, need to ignore
            {
            Complete(aError);
            }
        }
    else
        {
        ReadNextBlock(aBuffer);
        }
    }</pre> </li> <li id="GUID-CD08610E-0AFE-5730-BC3A-8F112FF54EE5"><a name="GUID-CD08610E-0AFE-5730-BC3A-8F112FF54EE5"><!-- --></a><p>The following code reads the next audio block into the buffer in an array of descriptors: </p> <pre class="codeblock">void CIOStreamAudio::ReadNextBlock(const TDesC8&amp; aBuffer)
    {
    ASSERT(iState==EStateReading);
    // buffer will be tail of iMainBuffer. Shift latter's length and get the next bit
    TInt lengthRecorded = iMainBuffer.Length()+aBuffer.Length();
    iMainBuffer.SetLength(lengthRecorded);
    iBufferPtr.Set(const_cast&lt;TUint8*&gt;(iMainBuffer.Ptr())+lengthRecorded, 0, iMainBuffer.MaxLength()-lengthRecorded);
    TRAPD(error, iInputStream-&gt;ReadL(iBufferPtr));
    if (error!=KErrNone)
        {
        Complete(error);
        }
    }</pre> </li> </ol> <p id="GUID-5811A2A0-5793-5FBB-B01A-AD94590955A8"><a name="GUID-5811A2A0-5793-5FBB-B01A-AD94590955A8"><!-- --></a><strong>Basic Procedure to Stop an Audio Input Stream</strong> </p> <p>The high level steps to stop an audio input stream are shown here: </p> <ul><li id="GUID-43677A50-198B-59D5-8F58-39C96CFAC5A4"><a name="GUID-43677A50-198B-59D5-8F58-39C96CFAC5A4"><!-- --></a><p>To stop recording the audio stream, use the Stop() member function. Two callbacks are issued after a <code class="codeph">Stop()</code>. </p> <ol id="GUID-591B7B4E-899D-5D28-B33D-3EFC2DE1B4D6"><li id="GUID-EE9F9106-E0E8-5C20-8D8E-CB2A9FCCD0C4"><a name="GUID-EE9F9106-E0E8-5C20-8D8E-CB2A9FCCD0C4"><!-- --></a><p>An <a href="GUID-C6E5F800-0637-419E-8FE5-1EBB40E725AA/GUID-6A1EAD31-95CA-3CAC-8897-791E9D522DF0.html#GUID-FB4EC66A-4B6D-331B-B5A1-4605084343B0"><code class="apiname">MMdaAudioInputStreamCallback::MaiscBufferCopied()</code></a> pointing to a buffer that contains the last of the recorded audio data (and an <code class="codeph">aError</code> value of <code class="codeph">KErrAbort</code>). </p> </li> <li id="GUID-E3EBC7BE-C12C-527C-BF33-3EF787D8F9F4"><a name="GUID-E3EBC7BE-C12C-527C-BF33-3EF787D8F9F4"><!-- --></a><p>An <a href="GUID-C6E5F800-0637-419E-8FE5-1EBB40E725AA/GUID-6A1EAD31-95CA-3CAC-8897-791E9D522DF0.html#GUID-23F823E5-46A4-34D1-A7DD-DF6B18C37445"><code class="apiname">MMdaAudioInputStreamCallback::MaiscRecordComplete()</code></a>, indicating successful closure of the audio stream. </p> <pre class="codeblock">void CIOStreamAudio::MaiscRecordComplete(TInt aError)
    {
    ASSERT(iState==EStateReading &amp;&amp; aError!=KErrNone);
    Complete(aError);
    }</pre> </li> </ol> </li> </ul> </div> <div><h3 class="section-title">See Also</h3> <p><a href="GUID-ECBA6331-2187-52C9-A5DF-20CD1EEFE781.html">Audio Output Streaming Tutorial</a> </p> </div> </div></div></div><div class="footer"><p class="metadata">Last updated October 9th, 2009</p><hr /><div class="copy">© Nokia 2012.</div></div></body>
<!-- Mirrored from devlib.symbian.slions.net/belle/GUID-1C499E7D-8099-5BE4-AE46-6143388E6ACB.html by HTTrack Website Copier/3.x [XR&CO'2014], Fri, 27 Mar 2020 04:05:01 GMT -->
</html>