<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">

<!-- Mirrored from devlib.symbian.slions.net/belle/GUID-6013A680-57F9-415B-8851-C4FA63356636/src_2libvorbis_2doc_2vorbisenc_2overview_8html_source.html by HTTrack Website Copier/3.x [XR&CO'2014], Fri, 27 Mar 2020 08:19:02 GMT -->
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>Example Code: examples/SFExamples/oggvorbiscodec/src/libvorbis/doc/vorbisenc/overview.html Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.6.2 -->
<h1>examples/SFExamples/oggvorbiscodec/src/libvorbis/doc/vorbisenc/overview.html</h1><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 &lt;html&gt;
<a name="l00002"></a>00002 
<a name="l00003"></a>00003 &lt;head&gt;
<a name="l00004"></a>00004 &lt;title&gt;libvorbisenc - API Overview&lt;/title&gt;
<a name="l00005"></a>00005 &lt;link rel=stylesheet href=<span class="stringliteral">&quot;style.css&quot;</span> type=<span class="stringliteral">&quot;text/css&quot;</span>&gt;
<a name="l00006"></a>00006 &lt;/head&gt;
<a name="l00007"></a>00007 
<a name="l00008"></a>00008 &lt;body bgcolor=white text=black link=<span class="stringliteral">&quot;#5555ff&quot;</span> alink=<span class="stringliteral">&quot;#5555ff&quot;</span> vlink=<span class="stringliteral">&quot;#5555ff&quot;</span>&gt;
<a name="l00009"></a>00009 &lt;table border=0 width=100%&gt;
<a name="l00010"></a>00010 &lt;tr&gt;
<a name="l00011"></a>00011 &lt;td&gt;&lt;p <span class="keyword">class</span>=tiny&gt;libvorbisenc documentation&lt;/p&gt;&lt;/td&gt;
<a name="l00012"></a>00012 &lt;td align=right&gt;&lt;p <span class="keyword">class</span>=tiny&gt;libvorbisenc release 1.1 - 20040709&lt;/p&gt;&lt;/td&gt;
<a name="l00013"></a>00013 &lt;/tr&gt;
<a name="l00014"></a>00014 &lt;/table&gt;
<a name="l00015"></a>00015 
<a name="l00016"></a>00016 &lt;h1&gt;Libvorbisenc API Overview&lt;/h1&gt;
<a name="l00017"></a>00017 
<a name="l00018"></a>00018 &lt;p&gt;Libvorbisenc is an encoding convenience library intended to
<a name="l00019"></a>00019 encapsulate the elaborate setup that libvorbis requires <span class="keywordflow">for</span> encoding.
<a name="l00020"></a>00020 Libvorbisenc gives easy access to all high-level adjustments an
<a name="l00021"></a>00021 application may require when encoding and also exposes some low-level
<a name="l00022"></a>00022 tuning parameters to allow applications to make detailed adjustments
<a name="l00023"></a>00023 to the encoding process. &lt;p&gt;
<a name="l00024"></a>00024 
<a name="l00025"></a>00025 All the &lt;b&gt;libvorbisenc&lt;/b&gt; routines are declared in <span class="stringliteral">&quot;vorbis/vorbisenc.h&quot;</span>.
<a name="l00026"></a>00026 
<a name="l00027"></a>00027 &lt;em&gt;Note: libvorbis and libvorbisenc always
<a name="l00028"></a>00028 encode in a single pass. Thus, all possible encoding setups will work
<a name="l00029"></a>00029 properly with live input and produce streams that decode properly when
<a name="l00030"></a>00030 streamed.  See the subsection titled &lt;a href=<span class="stringliteral">&quot;#BBR&quot;</span>&gt;<span class="stringliteral">&quot;managed bitrate</span>
<a name="l00031"></a>00031 <span class="stringliteral">modes&quot;</span>&lt;/a&gt; <span class="keywordflow">for</span> details on setting limits on bitrate usage when Vorbis
<a name="l00032"></a>00032 streams are used in a limited-bandwidth environment.&lt;/em&gt;
<a name="l00033"></a>00033 
<a name="l00034"></a>00034 &lt;h2&gt;workflow&lt;/h2&gt;
<a name="l00035"></a>00035 
<a name="l00036"></a>00036 &lt;p&gt;Libvorbisenc is used only during encoder setup; its function
<a name="l00037"></a>00037 is to automate initialization of a multitude of settings in a
<a name="l00038"></a>00038 &lt;tt&gt;<a class="code" href="structvorbis__info.html">vorbis_info</a>&lt;/tt&gt; structure which libvorbis then uses as a reference
<a name="l00039"></a>00039 during the encoding process.  Libvorbisenc plays no part in the
<a name="l00040"></a>00040 encoding process after setup.
<a name="l00041"></a>00041 
<a name="l00042"></a>00042 &lt;p&gt;Encode setup <span class="keyword">using</span> libvorbisenc consists of three steps: 
<a name="l00043"></a>00043 
<a name="l00044"></a>00044 &lt;ol&gt;
<a name="l00045"></a>00045 &lt;li&gt;high-level initialization of a &lt;tt&gt;<a class="code" href="structvorbis__info.html">vorbis_info</a>&lt;/tt&gt; structure by
<a name="l00046"></a>00046 calling one of &lt;a
<a name="l00047"></a>00047 href=<span class="stringliteral">&quot;vorbis_encode_setup_vbr.html&quot;</span>&gt;vorbis_encode_setup_vbr()&lt;/a&gt; or &lt;a
<a name="l00048"></a>00048 href=<span class="stringliteral">&quot;vorbis_encode_setup_managed.html&quot;</span>&gt;vorbis_encode_setup_managed()&lt;/a&gt;
<a name="l00049"></a>00049 with the basic input audio parameters (rate and channels) and the
<a name="l00050"></a>00050 basic desired encoded audio output parameters (VBR quality or ABR/CBR
<a name="l00051"></a>00051 bitrate)&lt;p&gt;
<a name="l00052"></a>00052 
<a name="l00053"></a>00053 &lt;li&gt;optional adjustment of the basic setup defaults <span class="keyword">using</span> &lt;a
<a name="l00054"></a>00054 href=<span class="stringliteral">&quot;vorbis_encode_ctl.html&quot;</span>&gt;vorbis_encode_ctl()&lt;/a&gt;&lt;p&gt;
<a name="l00055"></a>00055 
<a name="l00056"></a>00056 &lt;li&gt;calling &lt;a
<a name="l00057"></a>00057 href=<span class="stringliteral">&quot;vorbis_encode_setup_init.html&quot;</span>&gt;vorbis_encode_setup_init()&lt;/a&gt; to
<a name="l00058"></a>00058 finalize the high-level setup into the detailed low-level reference
<a name="l00059"></a>00059 values needed by libvorbis to encode audio. The &lt;tt&gt;<a class="code" href="structvorbis__info.html">vorbis_info</a>&lt;/tt&gt;
<a name="l00060"></a>00060 structure is then ready to use <span class="keywordflow">for</span> encoding by libvorbis.&lt;p&gt;
<a name="l00061"></a>00061 
<a name="l00062"></a>00062 &lt;/ol&gt;
<a name="l00063"></a>00063 
<a name="l00064"></a>00064 These three steps can be collapsed into a single call by <span class="keyword">using</span> &lt;a
<a name="l00065"></a>00065 href=<span class="stringliteral">&quot;vorbis_encode_init_vbr.html&quot;</span>&gt;vorbis_encode_init_vbr&lt;/a&gt; to <span class="keyword">set</span> up a
<a name="l00066"></a>00066 quality-based VBR stream or &lt;a
<a name="l00067"></a>00067 href=<span class="stringliteral">&quot;vorbis_encode_init.html&quot;</span>&gt;vorbis_encode_init&lt;/a&gt; to <span class="keyword">set</span> up a managed
<a name="l00068"></a>00068 bitrate (ABR or CBR) stream.&lt;p&gt;
<a name="l00069"></a>00069 
<a name="l00070"></a>00070 &lt;h2&gt;adjustable encoding parameters&lt;/h2&gt;
<a name="l00071"></a>00071 
<a name="l00072"></a>00072 &lt;h3&gt;input audio parameters&lt;/h3&gt;
<a name="l00073"></a>00073 
<a name="l00074"></a>00074 &lt;p&gt;
<a name="l00075"></a>00075 &lt;table border=1 color=black width=50% cellspacing=0 cellpadding=7&gt;
<a name="l00076"></a>00076 &lt;tr bgcolor=#cccccc&gt;
<a name="l00077"></a>00077         &lt;td&gt;&lt;b&gt;parameter&lt;/b&gt;&lt;/td&gt;
<a name="l00078"></a>00078         &lt;td&gt;&lt;b&gt;description&lt;/b&gt;&lt;/td&gt;
<a name="l00079"></a>00079 &lt;/tr&gt;
<a name="l00080"></a>00080 &lt;tr valign=top&gt;
<a name="l00081"></a>00081 &lt;td&gt;sampling rate&lt;/td&gt;
<a name="l00082"></a>00082 &lt;td&gt;
<a name="l00083"></a>00083 The sampling rate (in samples per second) of the input audio.  Common examples are 8000 <span class="keywordflow">for</span> telephony, 44100 <span class="keywordflow">for</span> CD audio and 48000 <span class="keywordflow">for</span> DAT.  Note that a mono sample (one center value) and a stereo sample (one left value and one right value) both are a single sample.
<a name="l00084"></a>00084 
<a name="l00085"></a>00085 &lt;/td&gt;
<a name="l00086"></a>00086 &lt;/tr&gt;
<a name="l00087"></a>00087 &lt;tr valign=top&gt;
<a name="l00088"></a>00088 &lt;td&gt;channels&lt;/td&gt;
<a name="l00089"></a>00089 &lt;td&gt;
<a name="l00090"></a>00090 
<a name="l00091"></a>00091 The number of channels encoded in each input sample.  By <span class="keywordflow">default</span>,
<a name="l00092"></a>00092 stereo input modes (two channels) are <span class="stringliteral">&#39;coupled&#39;</span> by Vorbis 1.1 such
<a name="l00093"></a>00093 that the stereo relationship between the samples is taken into account
<a name="l00094"></a>00094 when encoding.  Stereo coupling my be disabled by <span class="keyword">using</span> &lt;a
<a name="l00095"></a>00095 href=<span class="stringliteral">&quot;vorbis_encode_ctl.html&quot;</span>&gt;vorbis_encode_ctl()&lt;/a&gt; with &lt;a
<a name="l00096"></a>00096 href=<span class="stringliteral">&quot;vorbis_encode_ctl.html#OV_ECTL_COUPLE_SET&quot;</span>&gt;OV_ECTL_COUPLE_SET&lt;/a&gt;.
<a name="l00097"></a>00097 
<a name="l00098"></a>00098 &lt;/td&gt;
<a name="l00099"></a>00099 &lt;/tr&gt;
<a name="l00100"></a>00100 &lt;/table&gt;
<a name="l00101"></a>00101 
<a name="l00102"></a>00102 &lt;h3&gt;quality and VBR modes&lt;/h3&gt;
<a name="l00103"></a>00103 
<a name="l00104"></a>00104 Vorbis is natively a VBR codec; a user requests a given constant
<a name="l00105"></a>00105 &lt;em&gt;quality&lt;/em&gt; and the encoder keeps the encoding quality constant
<a name="l00106"></a>00106 <span class="keywordflow">while</span> allowing the bitrate to vary.  <span class="stringliteral">&#39;Quality&#39;</span> modes (Variable BitRate)
<a name="l00107"></a>00107 will always produce the most consistent encoding results as well as
<a name="l00108"></a>00108 the highest quality <span class="keywordflow">for</span> the amount of bits used.
<a name="l00109"></a>00109 
<a name="l00110"></a>00110 &lt;p&gt;
<a name="l00111"></a>00111 &lt;table border=1 color=black width=50% cellspacing=0 cellpadding=7&gt;
<a name="l00112"></a>00112 &lt;tr bgcolor=#cccccc&gt;
<a name="l00113"></a>00113         &lt;td&gt;&lt;b&gt;parameter&lt;/b&gt;&lt;/td&gt;
<a name="l00114"></a>00114         &lt;td&gt;&lt;b&gt;description&lt;/b&gt;&lt;/td&gt;
<a name="l00115"></a>00115 &lt;/tr&gt;
<a name="l00116"></a>00116 &lt;tr valign=top&gt;
<a name="l00117"></a>00117 &lt;td&gt;quality&lt;/td&gt;
<a name="l00118"></a>00118 &lt;td&gt;
<a name="l00119"></a>00119 A decimal <span class="keywordtype">float</span> value requesting a desired quality.  Libvorbisenc 1.1 allows quality requests in the range of -0.1 (lowest quality, smallest files) through +1.0 (highest-quality, largest files). Quality -0.1 is intended as an ultra-low setting in which low bitrate is much more important than quality consistency.  Quality settings 0.0 and above are intended to produce consistent results at all times.  
<a name="l00120"></a>00120 
<a name="l00121"></a>00121 &lt;/td&gt;
<a name="l00122"></a>00122 &lt;/tr&gt;
<a name="l00123"></a>00123 &lt;/table&gt;
<a name="l00124"></a>00124 
<a name="l00125"></a>00125 &lt;a name=<span class="stringliteral">&quot;BBR&quot;</span>&gt;
<a name="l00126"></a>00126 &lt;h3&gt;managed bitrate modes&lt;/h3&gt;
<a name="l00127"></a>00127 
<a name="l00128"></a>00128 Although the Vorbis codec is natively VBR, libvorbis includes
<a name="l00129"></a>00129 infrastructure <span class="keywordflow">for</span> <span class="stringliteral">&#39;managing&#39;</span> the bitrate of streams by setting
<a name="l00130"></a>00130 minimum and maximum usage constraints, as well as functionality <span class="keywordflow">for</span>
<a name="l00131"></a>00131 nudging a stream toward a desired average value.  These features
<a name="l00132"></a>00132 should &lt;em&gt;only&lt;/em&gt; be used when there is a requirement to limit
<a name="l00133"></a>00133 bitrate in some way.  Although the difference is usually slight,
<a name="l00134"></a>00134 managed bitrate modes will always produce output inferior to VBR
<a name="l00135"></a>00135 (given equal bitrate usage). Setting overly or impossibly tight
<a name="l00136"></a>00136 bitrate management requirements can affect output quality dramatically
<a name="l00137"></a>00137 <span class="keywordflow">for</span> the worse.&lt;p&gt;
<a name="l00138"></a>00138 
<a name="l00139"></a>00139 Beginning in libvorbis 1.1, bitrate management is implemented <span class="keyword">using</span> a
<a name="l00140"></a>00140 &lt;em&gt;bit-reservoir&lt;/em&gt; algorithm. The encoder has a fixed-size
<a name="l00141"></a>00141 reservoir used as a <span class="stringliteral">&#39;savings account&#39;</span> in encoding.  When a frame is
<a name="l00142"></a>00142 smaller than the target rate, the unused bits go into the reservoir so
<a name="l00143"></a>00143 that they may be used by future frames.  When a frame is larger than
<a name="l00144"></a>00144 target bitrate, it draws <span class="stringliteral">&#39;banked&#39;</span> bits out of the reservoir.  Encoding
<a name="l00145"></a>00145 is managed so that the reservoir never goes negative (when a maximum
<a name="l00146"></a>00146 bitrate is specified) or fills beyond a fixed limit (when a minimum
<a name="l00147"></a>00147 bitrate is specified).  An <span class="stringliteral">&#39;average bitrate&#39;</span> request is used as the
<a name="l00148"></a>00148 <span class="keyword">set</span>-point in a <span class="keywordtype">long</span>-range bitrate tracker which adjusts the encoder<span class="stringliteral">&#39;s</span>
<a name="l00149"></a>00149 <span class="stringliteral">aggressiveness up or down depending on whether or not frames are coming</span>
<a name="l00150"></a>00150 <span class="stringliteral">in larger or smaller than the requested average point.</span>
<a name="l00151"></a>00151 <span class="stringliteral"></span>
<a name="l00152"></a>00152 <span class="stringliteral">&lt;p&gt;</span>
<a name="l00153"></a>00153 <span class="stringliteral">&lt;table border=1 color=black width=50% cellspacing=0 cellpadding=7&gt;</span>
<a name="l00154"></a>00154 <span class="stringliteral">&lt;tr bgcolor=#cccccc&gt;</span>
<a name="l00155"></a>00155 <span class="stringliteral">        &lt;td&gt;&lt;b&gt;parameter&lt;/b&gt;&lt;/td&gt;</span>
<a name="l00156"></a>00156 <span class="stringliteral">        &lt;td&gt;&lt;b&gt;description&lt;/b&gt;&lt;/td&gt;</span>
<a name="l00157"></a>00157 <span class="stringliteral">&lt;/tr&gt;</span>
<a name="l00158"></a>00158 <span class="stringliteral">&lt;tr valign=top&gt;</span>
<a name="l00159"></a>00159 <span class="stringliteral">&lt;td&gt;maximum bitrate&lt;/td&gt; &lt;td&gt; The maximum allowed bitrate, set in bits</span>
<a name="l00160"></a>00160 <span class="stringliteral">per second.  If the bitrate would otherwise rise such that oversized</span>
<a name="l00161"></a>00161 <span class="stringliteral">frames would underflow the bit-reservoir by consuming banked bits,</span>
<a name="l00162"></a>00162 <span class="stringliteral">bitrate management will force the encoder to use fewer bits per frame</span>
<a name="l00163"></a>00163 <span class="stringliteral">by encoding with a more aggressive psychoacoustic model.&lt;p&gt; This</span>
<a name="l00164"></a>00164 <span class="stringliteral">setting is a hard limit; the bitstream will never be allowed, under</span>
<a name="l00165"></a>00165 <span class="stringliteral">any circumstances, to increase above the specified bitrate over the</span>
<a name="l00166"></a>00166 <span class="stringliteral">average period set by the reservoir; it may momentarily rise over if</span>
<a name="l00167"></a>00167 <span class="stringliteral">inspected on a granularity much finer than the average period across</span>
<a name="l00168"></a>00168 <span class="stringliteral">the reservoir.  Normally, the encoder will conserve bits gracefully by</span>
<a name="l00169"></a>00169 <span class="stringliteral">using more aggressive psychoacoustics to shrink a frame when forced</span>
<a name="l00170"></a>00170 <span class="stringliteral">to.  However, if the encoder runs out of means of gracefully shrinking</span>
<a name="l00171"></a>00171 <span class="stringliteral">a frame, it will simply take the smallest frame it can otherwise</span>
<a name="l00172"></a>00172 <span class="stringliteral">generate and truncate it to the maximum allowed length.  Note that</span>
<a name="l00173"></a>00173 <span class="stringliteral">this is not an error and although it will obviously adversely affect</span>
<a name="l00174"></a>00174 <span class="stringliteral">audio quality, a Vorbis decoder will be able to decode a truncated</span>
<a name="l00175"></a>00175 <span class="stringliteral">frame into audio.</span>
<a name="l00176"></a>00176 <span class="stringliteral"></span>
<a name="l00177"></a>00177 <span class="stringliteral">&lt;/td&gt;</span>
<a name="l00178"></a>00178 <span class="stringliteral">&lt;/tr&gt;</span>
<a name="l00179"></a>00179 <span class="stringliteral"></span>
<a name="l00180"></a>00180 <span class="stringliteral">&lt;tr valign=top&gt;</span>
<a name="l00181"></a>00181 <span class="stringliteral">&lt;td&gt;average bitrate&lt;/td&gt; </span>
<a name="l00182"></a>00182 <span class="stringliteral"></span>
<a name="l00183"></a>00183 <span class="stringliteral">&lt;td&gt;</span>
<a name="l00184"></a>00184 <span class="stringliteral"></span>
<a name="l00185"></a>00185 <span class="stringliteral">The average desired bitrate of a stream, set</span>
<a name="l00186"></a>00186 <span class="stringliteral">in bits per second.  Average bitrate is tracked via a reservoir like</span>
<a name="l00187"></a>00187 <span class="stringliteral">minimum and maximum bitrate, however the averaging reservior does not</span>
<a name="l00188"></a>00188 <span class="stringliteral">impose a hard limit; it is used to nudge the bitrate toward the</span>
<a name="l00189"></a>00189 <span class="stringliteral">desired average by slowly adjusting the psychoacoustic aggressiveness.</span>
<a name="l00190"></a>00190 <span class="stringliteral">As such, the reservoir size does not affect the average bitrate</span>
<a name="l00191"></a>00191 <span class="stringliteral">behavior.  Because this setting alone is not used to impose hard</span>
<a name="l00192"></a>00192 <span class="stringliteral">bitrate limits, the bitrate of a stream produced using only the</span>
<a name="l00193"></a>00193 <span class="stringliteral">&lt;tt&gt;average bitrate&lt;/tt&gt; constraint will track the average over time</span>
<a name="l00194"></a>00194 <span class="stringliteral">but not necessarily adhere strictly to that average for any given</span>
<a name="l00195"></a>00195 <span class="stringliteral">period.  Should a strict localized average be required, &lt;tt&gt;average</span>
<a name="l00196"></a>00196 <span class="stringliteral">bitrate&lt;/tt&gt; should be used along with &lt;tt&gt;minimum bitrate&lt;/tt&gt; and</span>
<a name="l00197"></a>00197 <span class="stringliteral">&lt;tt&gt;maximum bitrate&lt;/tt&gt;.</span>
<a name="l00198"></a>00198 <span class="stringliteral">&lt;/td&gt;</span>
<a name="l00199"></a>00199 <span class="stringliteral"></span>
<a name="l00200"></a>00200 <span class="stringliteral">&lt;/tr&gt;</span>
<a name="l00201"></a>00201 <span class="stringliteral"></span>
<a name="l00202"></a>00202 <span class="stringliteral">&lt;tr valign=top&gt;</span>
<a name="l00203"></a>00203 <span class="stringliteral">&lt;td&gt;minimum bitrate&lt;/td&gt;</span>
<a name="l00204"></a>00204 <span class="stringliteral">&lt;td&gt; </span>
<a name="l00205"></a>00205 <span class="stringliteral"> The minimum allowed bitrate, set in bits per second.  If</span>
<a name="l00206"></a>00206 <span class="stringliteral">the bitrate would otherwise fall such that undersized frames would</span>
<a name="l00207"></a>00207 <span class="stringliteral">overflow the bit-reservoir with unused bits, bitrate management will</span>
<a name="l00208"></a>00208 <span class="stringliteral">force the encoder to use more bits per frame by encoding with a less</span>
<a name="l00209"></a>00209 <span class="stringliteral">aggressive psychoacoustic model.&lt;p&gt; This setting is a hard limit; the</span>
<a name="l00210"></a>00210 <span class="stringliteral">bitstream will never be allowed, under any circumstances, to drop</span>
<a name="l00211"></a>00211 <span class="stringliteral">below the specified bitrate over the average period set by the</span>
<a name="l00212"></a>00212 <span class="stringliteral">reservoir; it may momentarily fall under if inspected on a granularity</span>
<a name="l00213"></a>00213 <span class="stringliteral">much finer than the average period across the reservoir.  Normally,</span>
<a name="l00214"></a>00214 <span class="stringliteral">the encoder will fill out undersided frames with additional useful</span>
<a name="l00215"></a>00215 <span class="stringliteral">coding information by increasing the perceived quality of the stream.</span>
<a name="l00216"></a>00216 <span class="stringliteral">If the encoder runs out of useful ways to consume more bits, it will</span>
<a name="l00217"></a>00217 <span class="stringliteral">pad frames out with zeroes.</span>
<a name="l00218"></a>00218 <span class="stringliteral">&lt;/td&gt;</span>
<a name="l00219"></a>00219 <span class="stringliteral">&lt;/tr&gt;</span>
<a name="l00220"></a>00220 <span class="stringliteral"></span>
<a name="l00221"></a>00221 <span class="stringliteral">&lt;tr valign=top&gt;</span>
<a name="l00222"></a>00222 <span class="stringliteral">&lt;td&gt;reservoir size&lt;/td&gt; &lt;td&gt; The size of the minimum/maximum bitrate</span>
<a name="l00223"></a>00223 <span class="stringliteral">tracking reservoir, set in bits.  The reservoir is used as a &#39;</span>bit
<a name="l00224"></a>00224 bank<span class="stringliteral">&#39; to average out localized surges and dips in bitrate while</span>
<a name="l00225"></a>00225 <span class="stringliteral">providing predictable, guaranteed buffering behavior for streams to be</span>
<a name="l00226"></a>00226 <span class="stringliteral">used in situations with constrained transport bandwidth.  The default</span>
<a name="l00227"></a>00227 <span class="stringliteral">setting is two seconds of average bitrate.&lt;p&gt;</span>
<a name="l00228"></a>00228 <span class="stringliteral"></span>
<a name="l00229"></a>00229 <span class="stringliteral">When a single frame is larger than the maximum allowed overall</span>
<a name="l00230"></a>00230 <span class="stringliteral">bitrate, the bits are &#39;</span>borrowed<span class="stringliteral">&#39; from the bitrate reservoir; if the</span>
<a name="l00231"></a>00231 <span class="stringliteral">reservoir contains insufficient bits to cover the defecit, the encoder</span>
<a name="l00232"></a>00232 <span class="stringliteral">must find some way to reduce the frame size. &lt;p&gt;</span>
<a name="l00233"></a>00233 <span class="stringliteral"></span>
<a name="l00234"></a>00234 <span class="stringliteral">When a frame is under the minimum limit, the surplus bits are placed</span>
<a name="l00235"></a>00235 <span class="stringliteral">into the reservoir, banking them for future use.  If the reservoir is</span>
<a name="l00236"></a>00236 <span class="stringliteral">already full of banked bits, the encoder is forced to find some way to</span>
<a name="l00237"></a>00237 <span class="stringliteral">make the frame larger.&lt;p&gt;</span>
<a name="l00238"></a>00238 <span class="stringliteral"></span>
<a name="l00239"></a>00239 <span class="stringliteral">If the frame size is between the minimum and maximum rates (thus</span>
<a name="l00240"></a>00240 <span class="stringliteral">implying the minimum and maximum allowed rates are different), the</span>
<a name="l00241"></a>00241 <span class="stringliteral">reservoir gravitates toward a fill point configured by the</span>
<a name="l00242"></a>00242 <span class="stringliteral">&lt;tt&gt;reservoir bias&lt;/tt&gt; setting described next.  If the reservoir is</span>
<a name="l00243"></a>00243 <span class="stringliteral">fuller than the fill point (a &#39;</span>surplus of surplus<span class="stringliteral">&#39;), the encoder will</span>
<a name="l00244"></a>00244 <span class="stringliteral">consume a number bits from the reservoir equal to the number of the</span>
<a name="l00245"></a>00245 <span class="stringliteral">bits by which the frame exceeds minimum size.  If the reservoir is</span>
<a name="l00246"></a>00246 <span class="stringliteral">emptier than the fillpoint (a &#39;</span>surplus of defecit<span class="stringliteral">&#39;), bits are returned</span>
<a name="l00247"></a>00247 <span class="stringliteral">to the reservoir equaling the current frame&#39;</span>s number of bits under the
<a name="l00248"></a>00248 maximum frame size.  The idea of the fill point is to buffer against
<a name="l00249"></a>00249 both underruns and overruns, by trying to hold the reservoir to a
<a name="l00250"></a>00250 middle course.
<a name="l00251"></a>00251 &lt;/td&gt;
<a name="l00252"></a>00252 &lt;/tr&gt;
<a name="l00253"></a>00253 
<a name="l00254"></a>00254 &lt;tr valign=top&gt;
<a name="l00255"></a>00255 &lt;td&gt;reservoir bias&lt;/td&gt;
<a name="l00256"></a>00256 
<a name="l00257"></a>00257 &lt;td&gt;
<a name="l00258"></a>00258 
<a name="l00259"></a>00259 Reservoir bias is a setting between 0.0 and 1.0 that biases bitrate
<a name="l00260"></a>00260 management toward smoothing bitrate spikes (0.0) or bitrate peaks
<a name="l00261"></a>00261 (1.0); the default setting is 0.1.&lt;p&gt;
<a name="l00262"></a>00262 
<a name="l00263"></a>00263 Using settings toward 0.0 causes the bitrate manager to hoard bits in
<a name="l00264"></a>00264 the bit reservoir such that there is a large pool of banked surplus to
<a name="l00265"></a>00265 draw upon during <span class="keywordtype">short</span> spikes in bitrate.  As a result, the encoder
<a name="l00266"></a>00266 will react less aggressively and less drastically to curtail framesize
<a name="l00267"></a>00267 during brief surges in bitrate.&lt;p&gt;
<a name="l00268"></a>00268 
<a name="l00269"></a>00269 Using settings toward 1.0 causes the bitrate manager to empty the bit
<a name="l00270"></a>00270 reservoir such that there is a large buffer available to store surplus
<a name="l00271"></a>00271 bits during sudden drops in bitrate.  As a result, the encoder will
<a name="l00272"></a>00272 react less aggressively and less drastically to support minimum frame
<a name="l00273"></a>00273 sizes during drops in bitrate and will tend not to store any extra
<a name="l00274"></a>00274 bits in the reservoir <a class="code" href="interfacefor.html">for</a> future bitrate spikes.&lt;p&gt;
<a name="l00275"></a>00275 
<a name="l00276"></a>00276 &lt;/td&gt;
<a name="l00277"></a>00277 &lt;/tr&gt;
<a name="l00278"></a>00278 
<a name="l00279"></a>00279 &lt;tr valign=top&gt;
<a name="l00280"></a>00280 &lt;td&gt;average track damping&lt;/td&gt;
<a name="l00281"></a>00281 &lt;td&gt; 
<a name="l00282"></a>00282 
<a name="l00283"></a>00283 A decimal value, in seconds, that controls how quickly the average
<a name="l00284"></a>00284 bitrate tracker is allowed to slew from enforcing minimum frame sizes
<a name="l00285"></a>00285 to maximum framesizes and vice versa.  Default value is 1.5
<a name="l00286"></a>00286 seconds.&lt;p&gt;
<a name="l00287"></a>00287 
<a name="l00288"></a>00288 When the &#39;average bitrate&#39; setting is in use, the average bitrate
<a name="l00289"></a>00289 tracker uses an unbounded reservoir to track overall bitrate-to-date
<a name="l00290"></a>00290 in the stream.  When bitrates are too low, the tracker will try to
<a name="l00291"></a>00291 nudge bitrates up and when the bitrate is too high, nudge it down.
<a name="l00292"></a>00292 The damping value regulates the maximum strength of the nudge; it
<a name="l00293"></a>00293 describes, in seconds, how quickly the tracker may transition from an
<a name="l00294"></a>00294 extreme nudge in one direction to an extreme nudge in the other.&lt;p&gt;
<a name="l00295"></a>00295 
<a name="l00296"></a>00296 &lt;/td&gt;
<a name="l00297"></a>00297 &lt;/tr&gt;
<a name="l00298"></a>00298 
<a name="l00299"></a>00299 &lt;/table&gt;
<a name="l00300"></a>00300 
<a name="l00301"></a>00301 &lt;h3&gt;encoding model adjustments&lt;/h3&gt;
<a name="l00302"></a>00302 
<a name="l00303"></a>00303 The &lt;a href=&quot;vorbis_encode_ctl.html&quot;&gt;vorbis_encode_ctl()&lt;/a&gt; call provides
<a name="l00304"></a>00304 a generalized interface <a class="code" href="interfacefor.html">for</a> making encoding setup adjustments to the
<a name="l00305"></a>00305 basic high-level setup provided by &lt;a
<a name="l00306"></a>00306 href=&quot;vorbis_encode_setup_vbr.html&quot;&gt;vorbis_encode_setup_vbr()&lt;/a&gt; or &lt;a
<a name="l00307"></a>00307 href=&quot;vorbis_encode_setup_managed.html&quot;&gt;vorbis_encode_setup_managed()&lt;/a&gt;.
<a name="l00308"></a>00308 In reality, these two calls use &lt;a
<a name="l00309"></a>00309 href=&quot;vorbis_encode_ctl.html&quot;&gt;vorbis_encode_ctl()&lt;/a&gt; internally, and &lt;a
<a name="l00310"></a>00310 href=&quot;vorbis_encode_ctl.html&quot;&gt;vorbis_encode_ctl()&lt;/a&gt; can be used to adjust
<a name="l00311"></a>00311 most of the parameters set by other calls.&lt;p&gt;
<a name="l00312"></a>00312 
<a name="l00313"></a>00313 In Vorbis 1.1, &lt;a href=&quot;vorbis_encode_ctl.html&quot;&gt;vorbis_encode_ctl()&lt;/a&gt; can
<a name="l00314"></a>00314 adjust the following additional parameters not described elsewhere:
<a name="l00315"></a>00315 
<a name="l00316"></a>00316 &lt;p&gt;
<a name="l00317"></a>00317 &lt;table border=1 color=black width=50% cellspacing=0 cellpadding=7&gt;
<a name="l00318"></a>00318 &lt;tr bgcolor=<span class="preprocessor">#cccccc&gt;</span>
<a name="l00319"></a>00319 <span class="preprocessor"></span>        &lt;td&gt;&lt;b&gt;parameter&lt;/b&gt;&lt;/td&gt;
<a name="l00320"></a>00320         &lt;td&gt;&lt;b&gt;description&lt;/b&gt;&lt;/td&gt;
<a name="l00321"></a>00321 &lt;/tr&gt;
<a name="l00322"></a>00322 &lt;tr valign=top&gt;
<a name="l00323"></a>00323 &lt;td&gt;management mode&lt;/td&gt; &lt;td&gt; Configures whether or not bitrate
<a name="l00324"></a>00324 management is in use or not.  Normally, <span class="keyword">this</span> value is <span class="keyword">set</span> implicitly
<a name="l00325"></a>00325 during encoding setup; however, the supported means of selecting a
<a name="l00326"></a>00326 quality mode by bitrate (that is, requesting a <span class="keyword">true</span> VBR stream, but
<a name="l00327"></a>00327 doing so by asking <span class="keywordflow">for</span> an approximate bitrate) is to use &lt;a
<a name="l00328"></a>00328 href=<span class="stringliteral">&quot;vorbis_encode_setup_managed.html&quot;</span>&gt;vorbis_encode_setup_managed()&lt;/a&gt;
<a name="l00329"></a>00329 and then to explicitly turn off bitrate management by calling &lt;a
<a name="l00330"></a>00330 href=<span class="stringliteral">&quot;vorbis_encode_ctl.html&quot;</span>&gt;vorbis_encode_ctl()&lt;/a&gt; with &lt;a
<a name="l00331"></a>00331 href=<span class="stringliteral">&quot;vorbis_encode_ctl.html#OV_ECTL_RATEMANAGE2_SET&quot;</span>&gt;OV_ECTL_RATEMANAGE2_SET&lt;/a&gt;
<a name="l00332"></a>00332 &lt;/td&gt;
<a name="l00333"></a>00333 &lt;/tr&gt;
<a name="l00334"></a>00334 
<a name="l00335"></a>00335 &lt;tr valign=top&gt;
<a name="l00336"></a>00336 &lt;td&gt;coupling&lt;/td&gt; &lt;td&gt; Stereo encoding (and in the future, surround
<a name="l00337"></a>00337 encodings) are normally encoded assuming the channels form a stereo
<a name="l00338"></a>00338 image and that lossy-stereo modelling is appropriate; <span class="keyword">this</span> is called
<a name="l00339"></a>00339 <span class="stringliteral">&#39;coupling&#39;</span>.  Stereo coupling may be explicitly enabled or disabled.
<a name="l00340"></a>00340 &lt;/td&gt;
<a name="l00341"></a>00341 &lt;/tr&gt;
<a name="l00342"></a>00342 &lt;tr valign=top&gt;
<a name="l00343"></a>00343 &lt;td&gt;lowpass&lt;/td&gt; &lt;td&gt; Sets the hard lowpass of a given encoding mode;
<a name="l00344"></a>00344 <span class="keyword">this</span> may be used to conserve a few bits in high-rate audio that has
<a name="l00345"></a>00345 limited bandwidth, or in testing of the encoder<span class="stringliteral">&#39;s acoustic model.  The</span>
<a name="l00346"></a>00346 <span class="stringliteral">encoder is generally already configured with ideal lowpasses (if any</span>
<a name="l00347"></a>00347 <span class="stringliteral">at all) for given modes; use of this parameter is strongly discouraged</span>
<a name="l00348"></a>00348 <span class="stringliteral">if the point is to try to &#39;</span>improve<span class="stringliteral">&#39; a given encoding mode for general</span>
<a name="l00349"></a>00349 <span class="stringliteral">encoding.</span>
<a name="l00350"></a>00350 <span class="stringliteral">&lt;/td&gt;</span>
<a name="l00351"></a>00351 <span class="stringliteral">&lt;/tr&gt;</span>
<a name="l00352"></a>00352 <span class="stringliteral"></span>
<a name="l00353"></a>00353 <span class="stringliteral">&lt;tr valign=top&gt;</span>
<a name="l00354"></a>00354 <span class="stringliteral">&lt;td&gt;impulse coding aggressiveness&lt;/td&gt; &lt;td&gt;By default, libvorbis</span>
<a name="l00355"></a>00355 <span class="stringliteral">attempts to compromise between preventing wide bitrate swings and</span>
<a name="l00356"></a>00356 <span class="stringliteral">high-resolution impulse coding (which is required for the crispest</span>
<a name="l00357"></a>00357 <span class="stringliteral">possible attacks, but also requires a relatively large momentary</span>
<a name="l00358"></a>00358 <span class="stringliteral">bitrate increase).  This parameter allows an application to tune the</span>
<a name="l00359"></a>00359 <span class="stringliteral">compromise or eliminate it; A value of 0.0 indicates normal behavior</span>
<a name="l00360"></a>00360 <span class="stringliteral">while a value of -15.0 requests maximum possible impulse</span>
<a name="l00361"></a>00361 <span class="stringliteral">resolution.&lt;/td&gt;</span>
<a name="l00362"></a>00362 <span class="stringliteral">&lt;/tr&gt;</span>
<a name="l00363"></a>00363 <span class="stringliteral"></span>
<a name="l00364"></a>00364 <span class="stringliteral">&lt;/table&gt;</span>
<a name="l00365"></a>00365 <span class="stringliteral"></span>
<a name="l00366"></a>00366 <span class="stringliteral"></span>
<a name="l00367"></a>00367 <span class="stringliteral">&lt;br&gt;&lt;br&gt;</span>
<a name="l00368"></a>00368 <span class="stringliteral">&lt;hr noshade&gt;</span>
<a name="l00369"></a>00369 <span class="stringliteral">&lt;table border=0 width=100%&gt;</span>
<a name="l00370"></a>00370 <span class="stringliteral">&lt;tr valign=top&gt;</span>
<a name="l00371"></a>00371 <span class="stringliteral">&lt;td&gt;&lt;p class=tiny&gt;copyright &amp;copy; 2004 Vorbis team&lt;/p&gt;&lt;/td&gt;</span>
<a name="l00372"></a>00372 <span class="stringliteral">&lt;td align=right&gt;&lt;p class=tiny&gt;&lt;a href=&quot;http://www.xiph.org/ogg/vorbis/index.html&quot;&gt;Ogg Vorbis&lt;/a&gt;&lt;br&gt;&lt;a href=&quot;mailto:team@vorbis.org&quot;&gt;team@vorbis.org&lt;/a&gt;&lt;/p&gt;&lt;/td&gt;</span>
<a name="l00373"></a>00373 <span class="stringliteral">&lt;/tr&gt;&lt;tr&gt;</span>
<a name="l00374"></a>00374 <span class="stringliteral">&lt;td&gt;&lt;p class=tiny&gt;libvorbisenc documentation&lt;/p&gt;&lt;/td&gt;</span>
<a name="l00375"></a>00375 <span class="stringliteral">&lt;td align=right&gt;&lt;p class=tiny&gt;libvorbisenc release 1.1 - 20040709&lt;/p&gt;&lt;/td&gt;</span>
<a name="l00376"></a>00376 <span class="stringliteral">&lt;/tr&gt;</span>
<a name="l00377"></a>00377 <span class="stringliteral">&lt;/table&gt;</span>
<a name="l00378"></a>00378 <span class="stringliteral"></span>
<a name="l00379"></a>00379 <span class="stringliteral">&lt;/body&gt;</span>
<a name="l00380"></a>00380 <span class="stringliteral"></span>
<a name="l00381"></a>00381 <span class="stringliteral">&lt;/html&gt;</span>
<a name="l00382"></a>00382 <span class="stringliteral"></span>
</pre></div>
<hr size="1"/><address style="text-align: right;"><small>Generated by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.6.2 </small></address>
</body>

<!-- Mirrored from devlib.symbian.slions.net/belle/GUID-6013A680-57F9-415B-8851-C4FA63356636/src_2libvorbis_2doc_2vorbisenc_2overview_8html_source.html by HTTrack Website Copier/3.x [XR&CO'2014], Fri, 27 Mar 2020 08:19:02 GMT -->
</html>
