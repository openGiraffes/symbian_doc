
<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<!-- Mirrored from devlib.symbian.slions.net/belle/GUID-D8D698FF-08CD-56B4-A6BF-E185A25F6988.html by HTTrack Website Copier/3.x [XR&CO'2014], Fri, 27 Mar 2020 04:03:09 GMT -->
<head><meta http-equiv="Content-Type" content="text/html; charset=utf-8" /><meta name="copyright" content="(C) Copyright 2012" /><meta name="DC.rights.owner" content="(C) Copyright 2012" /><meta name="DC.Type" content="task" /><meta name="DC.Title" content="Retrieving and modifying attachments to messages" /><meta name="abstract" content="The messaging framework allows you to retrieve and modify attachments to messages." /><meta name="description" content="The messaging framework allows you to retrieve and modify attachments to messages." /><meta name="DC.Relation" scheme="URI" content="GUID-54AB166A-8B24-5065-92AD-5FC1BF3ED89C" /><meta name="DC.Relation" scheme="URI" content="GUID-32E29020-1956-461A-B79A-1492E06049E7" /><meta name="DC.Relation" scheme="URI" content="GUID-5DD1010C-1648-5086-BA80-BC25F3C7A2C4" /><meta name="DC.Relation" scheme="URI" content="GUID-C290FA5E-8E41-5D19-B8C1-F88491EE6388" /><meta name="DC.Relation" scheme="URI" content="GUID-B394A824-8745-505E-8429-8B9B6D418387" /><meta name="DC.Relation" scheme="URI" content="GUID-DD27A452-8B0F-5C6D-A2E6-FC21145468B6" /><meta name="DC.Relation" scheme="URI" content="GUID-3FD2EADD-DC46-516D-B88D-DA523F51C5E3" /><meta name="DC.Format" content="XHTML" /><meta name="DC.Identifier" content="GUID-D8D698FF-08CD-56B4-A6BF-E185A25F6988" /><meta name="DC.Language" content="en" /><title>Retrieving and modifying attachments to messages </title><link href="css/s60/style.css" rel="stylesheet" type="text/css" /><link href="PLUGINS_ROOT/com.nokia.forum.library/css/category_cpp5.html" rel="stylesheet" type="text/css" /></head><body><div class="body"><div class="contentLeft prTxt"><h1 class="pageHeading" id="GUID-D8D698FF-08CD-56B4-A6BF-E185A25F6988">Retrieving and modifying attachments to messages</h1><div><p>The messaging framework allows you to retrieve and modify
attachments to messages. </p>
<div id="GUID-15885C98-AB41-5250-BC54-8FD519FCC2DB"><h3 class="section-title">Context</h3><p>Attachments
may be retrieved and modified after they have been added to a message. </p> </div>
<h3>Steps</h3><ol id="GUID-8EC42591-32C1-5790-B644-E9DD82F4C767"><a name="GUID-8EC42591-32C1-5790-B644-E9DD82F4C767"><!-- --></a>
<li id="GUID-7FB4A7D1-965F-5E58-9606-0B2BBDFA9781"><a name="GUID-7FB4A7D1-965F-5E58-9606-0B2BBDFA9781"><!-- --></a><p>Get the
details of the message to which you want to add an attachment using <a href="GUID-C6E5F800-0637-419E-8FE5-1EBB40E725AA/GUID-85BBE389-81F7-3E2F-A789-446D9BE2CC49.html#GUID-1864B96D-CB22-3EE1-8E73-023F12C68CB0"><code class="apiname">CMsvEntry::EditStoreL()</code></a>. </p>
This function returns <a href="GUID-C6E5F800-0637-419E-8FE5-1EBB40E725AA/GUID-8CB90FA2-A6CF-3FA2-81FF-7D22EFD9C2CE.html#GUID-C6E5F800-0637-419E-8FE5-1EBB40E725AA/GUID-8CB90FA2-A6CF-3FA2-81FF-7D22EFD9C2CE.html"><code class="apiname">CMsvStore</code></a> in writable
mode. 
</li>
<li id="GUID-BF15138A-9F76-5BD0-A72F-8A125B011CCE"><a name="GUID-BF15138A-9F76-5BD0-A72F-8A125B011CCE"><!-- --></a><p>Get an <a href="GUID-C6E5F800-0637-419E-8FE5-1EBB40E725AA/GUID-4E2B0CEA-1EDA-3452-895D-3CE1B59FD8FD.html#GUID-C6E5F800-0637-419E-8FE5-1EBB40E725AA/GUID-4E2B0CEA-1EDA-3452-895D-3CE1B59FD8FD.html"><code class="apiname">MMsvAttachmentManager</code></a> attachment manager for the message
entry, using <a href="GUID-C6E5F800-0637-419E-8FE5-1EBB40E725AA/GUID-8CB90FA2-A6CF-3FA2-81FF-7D22EFD9C2CE.html#GUID-73CE27F3-855B-3F87-AE11-4B4F2B8F8825"><code class="apiname">CMsvStore::AttachmentManagerL()</code></a>. </p>
</li>
<li id="GUID-A7041D09-6EA5-54CE-A972-E0D4993C26FC"><a name="GUID-A7041D09-6EA5-54CE-A972-E0D4993C26FC"><!-- --></a><p></p>
Find how many attachments a message entry has using the <a href="GUID-C6E5F800-0637-419E-8FE5-1EBB40E725AA/GUID-4E2B0CEA-1EDA-3452-895D-3CE1B59FD8FD.html#GUID-BAA9F4CF-E7F8-3644-8C0D-4387BAB7C432"><code class="apiname">MMsvAttachmentManager::AttachmentCount()</code></a> function. 
</li>
<li id="GUID-A58AFC6B-ADBA-5D3F-824F-A9EBDEBB2A0A"><a name="GUID-A58AFC6B-ADBA-5D3F-824F-A9EBDEBB2A0A"><!-- --></a><p></p>
Get attachment attributes using the appropriate <a href="GUID-C6E5F800-0637-419E-8FE5-1EBB40E725AA/GUID-8C2B9B89-D6B7-3622-AF26-658F53BCB70F.html#GUID-C6E5F800-0637-419E-8FE5-1EBB40E725AA/GUID-8C2B9B89-D6B7-3622-AF26-658F53BCB70F.html"><code class="apiname">CMsvAttachment</code></a> functions. . 
</li>
<li id="GUID-5574C96C-2E2B-55CC-AE8A-BF44CFD76D4B"><a name="GUID-5574C96C-2E2B-55CC-AE8A-BF44CFD76D4B"><!-- --></a><p></p>
Get attachment information using the <a href="GUID-C6E5F800-0637-419E-8FE5-1EBB40E725AA/GUID-4E2B0CEA-1EDA-3452-895D-3CE1B59FD8FD.html#GUID-256088DF-2FD0-32D9-8EEE-EFAC65A8E9AC"><code class="apiname">MMsvAttachmentManager::GetattachmentL()</code></a> function. 
</li>
</ol>
<div id="GUID-94880E70-F23F-5F18-8E0F-A29B99C96E4B"><h3 class="section-title">Retrieval
and modification example</h3> <p>The following code uses the <a href="GUID-C6E5F800-0637-419E-8FE5-1EBB40E725AA/GUID-4E2B0CEA-1EDA-3452-895D-3CE1B59FD8FD.html#GUID-BAA9F4CF-E7F8-3644-8C0D-4387BAB7C432"><code class="apiname">MMsvAttachmentManager::AttachmentCount()</code></a> and GetattachmentL() functions to get attachment information. It then calls the various <a href="GUID-C6E5F800-0637-419E-8FE5-1EBB40E725AA/GUID-8C2B9B89-D6B7-3622-AF26-658F53BCB70F.html#GUID-C6E5F800-0637-419E-8FE5-1EBB40E725AA/GUID-8C2B9B89-D6B7-3622-AF26-658F53BCB70F.html"><code class="apiname">CMsvAttachment</code></a> accessor functions to get the attachment
attributes, and to access the attachment file itself: </p> <pre class="codeblock">void CFoo::GetAttachmentInfoL(MMsvAttachmentManager&amp; attManager)
    {
    // get number of attachments
    TInt numAttach = attManager.AttachmentCount();
    if ( numAttach == 0 ) 
       { // no attachments
       return;
       }

    // Get attachment attributes for the first attachment (index 0)
    CMsvAttachment* attachInfo = attManager.GetAttachmentInfoL(0);

    // Ownership of attachInfo is transferred to the caller - so push it onto the CleanupStack
    CleanupStack::PushL(attachInfo);
    
    // Get attachment's name 
    const TDesC&amp; attachName = attachInfo-&gt;AttachmentName();

    // Get attachment's size 
    TInt attachSize = attachInfo-&gt;Size();
    
    // Get attachment's type 
    CMsvAttachment::TMsvAttachmentType attachType = attachInfo-&gt;Type();
    
    // Get MIME type 
    const TDesC8&amp; attachMType = attachInfo-&gt;MimeType();
    
    // Get completeness flag   
    TBool complete = attachInfo-&gt;Complete(); 

    ...

    // Destroy attachInfo when finished.  
    CleanupStack::PopAndDestroy(attachInfo);
    }</pre> <p>You can modify attachment information for an
existing attachment using the ModifyattachmentL() function. The attachment information object passed in replaces the
existing attachment information object. </p> <pre class="codeblock">void CFoo::ModifyAttachmentInfoL(CMsvEntry&amp; aEntry)
    {
    // Get the store
    CMsvStore* store = aEntry.EditStoreL();
    CleanupStack::PushL(store);
    
    MMsvAttachmentManager&amp; attManager = store-&gt;AttachmentManagerL();
    
    // Get number of attachments
    TInt numAttach = attManager.AttachmentCount();
    if ( numAttach == 0 ) 
       { // no attachments
       CleanupStack::PopAndDestroy() ; // store
       return;
       }
       
    // Get attachment attributes for the first attachment (index 0)
    CMsvAttachment* attachment = attManager.GetAttachmentInfoL(0);
    CleanupStack::PushL( attachment ) ;
    
    // Rename the file
    TRequestStatus status;
    _LIT(KFileName, "hello.txt");
    
    attachment-&gt;SetAttachmentNameL(KFileName);
    attachment-&gt;SetComplete(EFalse);
    
    // Modify attachment info
    attManager.ModifyAttachmentInfoL(attachment, status);
    
    // Wait for request to complete
    User::WaitForRequest(status);
    attachment-&gt;SetComplete(ETrue);  
    
    store-&gt;CommitL();

    CleanupStack::PopAndDestroy(2, store); // attachment, store
    }</pre> </div>
</div><h3>Related concepts</h3><ul><li><a href="GUID-54AB166A-8B24-5065-92AD-5FC1BF3ED89C.html">Messaging
Framework Overview</a></li></ul></div></div><div class="footer"><p class="metadata">Last updated November 18th, 2010</p><hr /><div class="copy">Â© Nokia 2012.</div></div></body>
<!-- Mirrored from devlib.symbian.slions.net/belle/GUID-D8D698FF-08CD-56B4-A6BF-E185A25F6988.html by HTTrack Website Copier/3.x [XR&CO'2014], Fri, 27 Mar 2020 04:03:09 GMT -->
</html>