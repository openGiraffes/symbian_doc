
<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<!-- Mirrored from devlib.symbian.slions.net/belle/GUID-6F40A921-83A9-5268-A9A6-80750CD5823D.html by HTTrack Website Copier/3.x [XR&CO'2014], Fri, 27 Mar 2020 04:06:08 GMT -->
<head><meta http-equiv="Content-Type" content="text/html; charset=utf-8" /><meta name="copyright" content="(C) Copyright 2012" /><meta name="DC.rights.owner" content="(C) Copyright 2012" /><meta name="DC.Type" content="concept" /><meta name="DC.Title" content="Example Showing the use of the SDP Codec API" /><meta name="DC.Relation" scheme="URI" content="GUID-32E29020-1956-461A-B79A-1492E06049E7" /><meta name="DC.Relation" scheme="URI" content="GUID-6425B722-4095-56E3-9198-70BA3E06C617" /><meta name="DC.Relation" scheme="URI" content="GUID-057F1F82-56AF-5696-853E-79196A3D567E" /><meta name="DC.Relation" scheme="URI" content="GUID-28636BB0-2C25-5D6C-9777-41AA4F3D8F31" /><meta name="DC.Format" content="XHTML" /><meta name="DC.Identifier" content="GUID-6F40A921-83A9-5268-A9A6-80750CD5823D" /><meta name="DC.Language" content="en" /><title>Example
Showing the use of the SDP Codec API </title><link href="css/s60/style.css" rel="stylesheet" type="text/css" /><link href="PLUGINS_ROOT/com.nokia.forum.library/css/category_cpp5.html" rel="stylesheet" type="text/css" /></head><body><div class="body"><div class="contentLeft prTxt"><h1 class="pageHeading" id="GUID-6F40A921-83A9-5268-A9A6-80750CD5823D">Example
Showing the use of the SDP Codec API</h1><div>
<p>The following sections explain how to create an SDP description with the
required fields. </p>
<ul>
<li id="GUID-F95C20F4-0A32-588F-A5A4-25C8C0F1D687"><a name="GUID-F95C20F4-0A32-588F-A5A4-25C8C0F1D687"><!-- --></a><p> <a href="#GUID-5184D372-53E1-5872-9DC0-63E004232D6D">Creating an SDP description</a> </p> </li>
<li id="GUID-ADA89366-B0CD-5520-A6A1-392525042085"><a name="GUID-ADA89366-B0CD-5520-A6A1-392525042085"><!-- --></a><p> <a href="#GUID-CD67F58C-5059-50DA-B275-CC07EC5E93EF">Creating a CSdpDocument object</a> </p> </li>
<li id="GUID-ADF16F11-C606-55C8-9E3C-4BCC420342D7"><a name="GUID-ADF16F11-C606-55C8-9E3C-4BCC420342D7"><!-- --></a><p> <a href="#GUID-35A2A9E8-8AE4-55EA-9DE3-C6F056A3B497">Defining the session name field for the SDP description</a> </p> </li>
<li id="GUID-AAEAAB91-98EB-5A6C-AA18-DA850BED70EB"><a name="GUID-AAEAAB91-98EB-5A6C-AA18-DA850BED70EB"><!-- --></a><p> <a href="#GUID-6D04653E-711E-53B3-8DC6-9A35EDE98173">Creating an instance of the Origin field class</a> </p> </li>
<li id="GUID-EFFDBB7F-CF7A-593C-826A-480DBF6D13AB"><a name="GUID-EFFDBB7F-CF7A-593C-826A-480DBF6D13AB"><!-- --></a><p> <a href="#GUID-63EE5D34-4AD2-5FC5-8D4C-E4DDEBE4D546">Fetching the network type and the address type</a> </p> </li>
<li id="GUID-58CDD2CF-CCF2-52B2-8C0A-134508FC14EA"><a name="GUID-58CDD2CF-CCF2-52B2-8C0A-134508FC14EA"><!-- --></a><p> <a href="#GUID-4CE0F919-97DC-5A4B-81B1-44953792609A">Creating and setting the connection field into the sdpDocument</a> </p> </li>
<li id="GUID-B54A2924-3AAC-5E1B-9A0B-145A532E9306"><a name="GUID-B54A2924-3AAC-5E1B-9A0B-145A532E9306"><!-- --></a><p> <a href="#GUID-0C8C6767-7D0D-5211-88A1-E07FABFC2EDB">Defining the session part attribute and direction-attribute</a> </p> </li>
<li id="GUID-D35AFF85-8E2D-5352-BE58-E755F3FF7D53"><a name="GUID-D35AFF85-8E2D-5352-BE58-E755F3FF7D53"><!-- --></a><p> <a href="#GUID-7835F2BC-6D44-58D7-A662-72B636F31154">Creating the first media field</a> </p> </li>
<li id="GUID-86DD7BAC-9C2B-5A23-8B7B-8A1FE7047CC6"><a name="GUID-86DD7BAC-9C2B-5A23-8B7B-8A1FE7047CC6"><!-- --></a><p> <a href="#GUID-D991055C-4847-5A92-BA72-18917231C00E">Creating the second media field</a> </p> </li>
<li id="GUID-00D37100-7CB9-5A7A-874A-325B89E59A8F"><a name="GUID-00D37100-7CB9-5A7A-874A-325B89E59A8F"><!-- --></a><p> <a href="#GUID-F8B6AE3F-DD42-5318-9184-C7DE92B7068A">Assigning the media fields to the CSdpDocument object</a> </p> </li>
<li id="GUID-1785FB44-679F-5C03-8B5B-44A2F5B979D0"><a name="GUID-1785FB44-679F-5C03-8B5B-44A2F5B979D0"><!-- --></a><p> <a href="#GUID-8F23A065-184D-5725-86FC-AC5909B401BB">Deleting the sdpDocument and closing the SdpCodecStringPool</a> </p> </li>
</ul>
<div id="GUID-5184D372-53E1-5872-9DC0-63E004232D6D"><h3 class="section-title"> Creating an
SDP description</h3> <ol id="GUID-9274DB5E-2266-5CBC-94BE-A140D1AA5B8E">
<li id="GUID-1D695593-6D60-5FB6-9D2B-EAF58D9D1451"><a name="GUID-1D695593-6D60-5FB6-9D2B-EAF58D9D1451"><!-- --></a><p>Open the String Pool </p> </li>
<li id="GUID-DF565227-6809-578B-9C75-A5D06DF9DC02"><a name="GUID-DF565227-6809-578B-9C75-A5D06DF9DC02"><!-- --></a><p>Access the predefined
SDP constants in the string table </p> </li>
<li id="GUID-44F46943-DCBA-5E12-B68D-A19DBF6DBBF7"><a name="GUID-44F46943-DCBA-5E12-B68D-A19DBF6DBBF7"><!-- --></a><p>Close the String Pool
after you finish with the SDP description </p> </li>
</ol> <pre class="codeblock">SdpCodecStringPool::OpenL();
RStringPool pool = SdpCodecStringPool::StringPoolL();
</pre> </div>
<div id="GUID-CD67F58C-5059-50DA-B275-CC07EC5E93EF"><h3 class="section-title"> Creating a
CSdpDocument object</h3> <p>The following code snippet shows how to create
the CSdpDocument object. This includes all SDP fields in
the structural format: </p> <pre class="codeblock">CSdpDocument* sdpDocument = CSdpDocument::NewLC();</pre> </div>
<div id="GUID-35A2A9E8-8AE4-55EA-9DE3-C6F056A3B497"><h3 class="section-title">Defining the
session name field for the SDP description</h3> <p>The following code snippet
shows how to define the session name field for the SDP description: </p> <pre class="codeblock">sdpDocument-&gt;SetSessionNameL(_L8("SipSession"));</pre> </div>
<div id="GUID-6D04653E-711E-53B3-8DC6-9A35EDE98173"><h3 class="section-title">Creating an
instance of the Origin field class </h3> <p>The following code snippet
shows how to create an instance of the Origin field class and set into the
SDP description: </p> <pre class="codeblock">TInt64 sessionId( TUint( 2890844526 ) );
TInt64 sessionVersion( TUint( 2890842807 ) );
TInetAddr address;
const TUint32 KInetAddr = INET_ADDR(10,47,16,5);
address.SetAddress( KInetAddr );
CSdpOriginField* originfield =  CSdpOriginField::NewL(_L8("username"), sessionId, sessionversion, address);
sdpDocument-&gt;SetOriginField(originfield);
</pre> </div>
<div id="GUID-63EE5D34-4AD2-5FC5-8D4C-E4DDEBE4D546"><h3 class="section-title">Fetching the
network type and the address type</h3><p>The following code snippet shows
how to fetch the predefined network type and the address type for the connection
field from the String Pool:</p><pre class="codeblock">RStringF netType = pool.StringF( SdpCodecStringConstants::ENetType, SdpCodecStringConstants::Table );RStringF addressTypeIP4 = pool.StringF( SdpCodecStringConstants::EAddressTypeIP4, SdpCodecStringConstants::Table );
</pre> </div>
<div id="GUID-4CE0F919-97DC-5A4B-81B1-44953792609A"><h3 class="section-title">Creating
and setting the connection field into the sdpDocument</h3> <p>The following
code snippet shows how to create the connection field and set the SDP parameters
of the SIP message into the SDP description: </p> <pre class="codeblock">_LIT8( KAddress, "10.47.16.5" );
CSdpConnectionField* connectionfield = CSdpConnectionField::NewL( netType, addressTypeIP4, KAddress );
sdpDocument-&gt;SetConnectionField(connectionfield);
</pre> </div>
<div id="GUID-0C8C6767-7D0D-5211-88A1-E07FABFC2EDB"><h3 class="section-title">Defining the
session part attribute and direction-attribute</h3> <p>The following code
snippet shows how to define the session part attribute for the SDP description.
The direction-attribute is not one of the predefined attributes in the string
table, it must be defined dynamically to the String Pool. </p> <pre class="codeblock">_LIT8(KSDPAttributeDirectionBoth,"both");
RStringF modifier = pool.OpenFStringL(_L8("direction"));
CleanupClosePushL(modifier);
CSdpAttributeField* attrField = CSdpAttributeField::NewL(modifier, KSDPAttributeDirectionBoth);
User::LeaveIfError((sdpDocument-&gt;AttributeFields()).Append(attrField));
CleanupStack::PopAndDestroy();
</pre> </div>
<div id="GUID-7835F2BC-6D44-58D7-A662-72B636F31154"><h3 class="section-title"> Creating the
first media field</h3> <p>The following code snippet shows how to create
the first media field: </p> <pre class="codeblock">RStringF mediaVideo = pool.StringF( SdpCodecStringConstants::EMediaVideo, SdpCodecStringPool::StringTableL());
RStringF protocol = pool.StringF(SdpCodecStringConstants::EProtocolRtpAvp, SdpCodecStringPool::StringTableL());
CSdpMediaField* media1 = CSdpMediaField::NewLC(mediaVideo, 49152, protocol, _L8("96"));
</pre> <p>Add the sendonly attribute (“a=sendonly”) to the first media
field: </p> <pre class="codeblock">RStringF sendonlyAttr = iPool.StringF( SdpCodecStringConstants:: EAttributeSendonly, SdpCodecStringPool::StringTableL() );
CSdpAttributeField* attr1 = CSdpAttributeField::NewLC(sendonlyAttr, _L8(""));
User::LeaveIfError((media1-&gt;AttributeFields()).Append(attr1));
CleanupStack::Pop(); //attr1
</pre> <p>Add the rtpmap attribute (“a=rtpmap:96 H263-2000/90000”) to
the first media field and then add the rtpmap specific attribute (“a=ptime:15”): </p> <pre class="codeblock">_LIT8( KEncodingName, "H263-2000" );
_LIT8( KClockRate, "90000" );
_LIT8( KEncodingParam, "" );
TSdpRtpmapValue rtpmapValue( KEncodingName(), KClockRate(), KEncodingParam() );
HBufC8* rtpmapBuf = rtpmapValue.EncodeL();
CleanupStack::PushL(rtpmapBuf);
RStringF rtpmapStr = pool.StringF( SdpCodecStringConstants::EAttributeRtpmap, SdpCodecStringPool::StringTableL() );
CSdpFmtAttributeField* rtpmapAttribute = CSdpFmtAttributeField::NewLC(rtpmapStr, _L8("96"), *rtpmapBuf);
User::LeaveIfError(media1-&gt;FormatAttributeFields().Append (rtpmapAttribute));
CleanupStack::Pop(); // rtpmapAttribute
CleanupStack::PopAndDestroy(); // rtpmapBuf
// add a rtpmap specific attribute
RStringF ptimeAttrStr = iPool.StringF( SdpCodecStringConstants:: EAttributePtime, SdpCodecStringPool::StringTableL() );
CSdpAttributeField* ptimeAttr = CSdpAttributeField::NewLC(ptimeAttrStr, _L8("15"));
ptimeAttr-&gt;AssignTo(*(media1-&gt;FormatAttributeFields())[0]);
User::LeaveIfError(media1-&gt;AttributeFields().Append(ptimeAttr));
CleanupStack::Pop(); //ptimeAttr
</pre> </div>
<div id="GUID-D991055C-4847-5A92-BA72-18917231C00E"><h3 class="section-title">Creating the
second media field</h3> <p>The following code snippet shows how to create
the second media field: </p> <pre class="codeblock">RStringF mediaAudio = pool.StringF( SdpCodecStringConstants:: EMediaAudio, SdpCodecStringPool::StringTableL());
CSdpMediaField* media2 = CSdpMediaField::NewLC(mediaAudio, 57344, protocol, _L8("97"));
</pre> <p>Create the sendonly attribute for the second media field: </p> <pre class="codeblock">CSdpAttributeField* attr2 = CSdpAttributeField::NewLC(sendonlyAttr, 
_L8(""));
User::LeaveIfError((media2-&gt;AttributeFields()).Append(attr2));
CleanupStack::Pop();
</pre> <p>Create the rtpmap attribute (“a=rtpmap:97 AMR/8000”) for the
second media field: </p> <pre class="codeblock">_LIT8( KEncodingName1, "AMR" );
_LIT8( KClockRate1, "8000" );
TSdpRtpmapValue rtpmapValue1( KEncodingName1(), KClockRate1(), KEncodingParam() );
HBufC8* rtpmapBuf1 = rtpmapValue1.EncodeL();
CleanupStack::PushL(rtpmapBuf1);
CSdpFmtAttributeField* rtpmapAttribute1 = CSdpFmtAttributeField::NewLC(rtpmapStr, _L8("97"), *rtpmapBuf1);
User::LeaveIfError(media2-&gt;FormatAttributeFields().Append (rtpmapAttribute1));
CleanupStack::Pop(); // rtpmapAttribute1
CleanupStack::PopAndDestroy(); //rtpmapBuf1
</pre> </div>
<div id="GUID-F8B6AE3F-DD42-5318-9184-C7DE92B7068A"><h3 class="section-title">Assigning the
media fields to the CSdpDocument object </h3> <p>The following code snippet
shows how to assign the media fields to the CSdpDocument object
and then remove the buffers from the cleanup stack: </p> <pre class="codeblock">User::LeaveIfError(doc-&gt;MediaFields().Append(media1));
User::LeaveIfError(doc-&gt;MediaFields().Append(media2));
CleanupStack::Pop(); //media2
CleanupStack::Pop(); //media1
</pre> </div>
<div id="GUID-8F23A065-184D-5725-86FC-AC5909B401BB"><h3 class="section-title">Deleting the
sdpDocument and closing the SdpCodecStringPool</h3> <p>To close the String
Pool the CSdpDocument object must be removed and deleted
from the cleanup stack. The following code snippet shows how to remove and
delete the CSdpDocument object from the cleanup stack and
close the String Pool: </p> <pre class="codeblock">CleanupStack::PopAndDestroy(); //sdpDocument
SdpCodecStringPool::Close();
</pre> <p>The SDP description created in the preceding example has the
following fields: </p> <pre class="codeblock">v=0
o=username 2890844526 2890842807 IN IP4 10.47.16.5
s=SipSession
c=IN IP4 10.47.16.5
t=0 0
a=direction:both
m=video 49152 RTP/AVP 96
a=sendonly
a=rtpmap:96 H263-2000/90000
m=audio 57344 RTP/AVP 97
a=sendonly
a=rtpmap:97 AMR/8000
</pre> </div>
</div></div></div><div class="footer"><p class="metadata">Last updated October 15th, 2009</p><hr /><div class="copy">© Nokia 2012.</div></div></body>
<!-- Mirrored from devlib.symbian.slions.net/belle/GUID-6F40A921-83A9-5268-A9A6-80750CD5823D.html by HTTrack Website Copier/3.x [XR&CO'2014], Fri, 27 Mar 2020 04:06:08 GMT -->
</html>