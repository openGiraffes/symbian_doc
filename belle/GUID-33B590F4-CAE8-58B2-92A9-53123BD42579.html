
<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<!-- Mirrored from devlib.symbian.slions.net/belle/GUID-33B590F4-CAE8-58B2-92A9-53123BD42579.html by HTTrack Website Copier/3.x [XR&CO'2014], Fri, 27 Mar 2020 04:02:36 GMT -->
<head><meta http-equiv="Content-Type" content="text/html; charset=utf-8" /><meta name="copyright" content="(C) Copyright 2012" /><meta name="DC.rights.owner" content="(C) Copyright 2012" /><meta name="DC.Type" content="concept" /><meta name="DC.Title" content="SMS Tutorial" /><meta name="DC.Relation" scheme="URI" content="GUID-32E29020-1956-461A-B79A-1492E06049E7" /><meta name="DC.Relation" scheme="URI" content="GUID-1A43A45B-80AE-56A0-A94C-64BA75519C67" /><meta name="DC.Relation" scheme="URI" content="GUID-DA6BB8BB-DD92-57A7-AD1B-F9CFF8CD433F" /><meta name="DC.Relation" scheme="URI" content="GUID-33C7EEEB-88B8-5587-916D-2C5D122F6010" /><meta name="DC.Format" content="XHTML" /><meta name="DC.Identifier" content="GUID-33B590F4-CAE8-58B2-92A9-53123BD42579" /><meta name="DC.Language" content="en" /><title>SMS Tutorial </title><link href="css/s60/style.css" rel="stylesheet" type="text/css" /><link href="PLUGINS_ROOT/com.nokia.forum.library/css/category_cpp5.html" rel="stylesheet" type="text/css" /></head><body><div class="body"><div class="contentLeft prTxt"><h1 class="pageHeading" id="GUID-33B590F4-CAE8-58B2-92A9-53123BD42579">SMS Tutorial</h1><div>
<p>Short Messaging Service (SMS) provides short text messaging between
mobile phones. Messages can be written and read by phone users. This
tutorial demonstrates the end-to-end procedure for creating and sending
SMS messages. </p>
<div id="GUID-9272450F-E1BE-44AE-8308-F21DC5457B14"><h3 class="section-title">Required
background</h3> <p>Before you start, you must understand: </p> <ul>
<li id="GUID-784C3290-1D72-5F2F-83FE-E1E85F515B71"><a name="GUID-784C3290-1D72-5F2F-83FE-E1E85F515B71"><!-- --></a><p><a href="GUID-33C7EEEB-88B8-5587-916D-2C5D122F6010.html">SMS MTM</a> </p> </li>
<li id="GUID-72E82D46-00A0-5410-B05A-D8B6703B7132"><a name="GUID-72E82D46-00A0-5410-B05A-D8B6703B7132"><!-- --></a><p><a href="GUID-CADAABB4-C957-502E-BA4D-E9614C0D3878.html">Schedule Send</a> </p> </li>
<li id="GUID-CF3038DC-659A-5038-AC70-B6FC6BBF4E52"><a name="GUID-CF3038DC-659A-5038-AC70-B6FC6BBF4E52"><!-- --></a><p><a href="GUID-B394A824-8745-505E-8429-8B9B6D418387.html">Message Server and
Store</a> </p> </li>
<li id="GUID-66775375-1A93-522F-B72F-CE353A566CB5"><a name="GUID-66775375-1A93-522F-B72F-CE353A566CB5"><!-- --></a><p><a href="GUID-8B843382-D27A-5E36-8F60-304903F3AA41.html">Message Type Module</a> </p> </li>
</ul> </div>
<div id="GUID-3FF83A3C-EBCE-493F-899D-9C2951227E14"><h3 class="section-title">Introduction</h3> <p>The SMS MTM provides functionality for creating, storing and
sending an SMS message, replying to a received SMS message and forwarding
an existing SMS message. A reply to a received SMS message may include
the original message text, including any EMS components. Configurable
parameters can apply either at a global level or on an individual
message basis. See <a href="GUID-CBFDD753-BAE3-5C40-B947-EB8CDA11CD23.html">SMS concepts</a> for detailed information on how SMS functionality
is implemented in the Symbian platform. </p> <p>Global settings that
are applied to the SMS MTM are known as SMS service settings. Each
SMS message entry has its own individual group of settings known as
SMS message settings. See <a href="GUID-24414E32-94DC-5870-847B-A797C495F756.html">SMS Settings</a> for more information. </p> <p>This tutorial explains <a href="#GUID-21F18C1C-F081-5D6A-BD41-B349346AAFF4">how to create and send messages</a>. It also explains <a href="#GUID-CB828B5E-4517-538E-9F20-90AEC17C823A">how to handle incoming messages</a>. </p> </div>
<div id="GUID-1D6C45AE-8CFC-4C69-A77A-A6B5B4E6FFA9"><h3 class="section-title">Creating and sending messages</h3> <ol id="GUID-D5EBB762-72EE-5CFA-834D-597CC61FC76C">
<li id="GUID-3E213996-72AA-5860-A5E0-C7F80B2AF7A2"><a name="GUID-3E213996-72AA-5860-A5E0-C7F80B2AF7A2"><!-- --></a><p><a href="#GUID-AD21D94E-91FA-50D2-B32C-BE4103D97B9B">Get a client MTM object</a>. </p> </li>
<li id="GUID-3226C878-5EB0-5511-8CD1-31A966CF0618"><a name="GUID-3226C878-5EB0-5511-8CD1-31A966CF0618"><!-- --></a><p><a href="#GUID-89F63F2A-F868-553F-97AE-F5F207DA33CB">Create a message</a>. </p> </li>
<li id="GUID-3423C3F4-8CF2-50D7-A57B-BA089C78B171"><a name="GUID-3423C3F4-8CF2-50D7-A57B-BA089C78B171"><!-- --></a><p><a href="#GUID-53C7AD41-91B5-5143-B002-C2F8981B9855">Set the message body</a>. </p> </li>
<li id="GUID-77B95197-7981-5FB9-AD02-726EA90EDACC"><a name="GUID-77B95197-7981-5FB9-AD02-726EA90EDACC"><!-- --></a><p><a href="#GUID-766E0370-D4B6-55DE-AC30-699665324BD3">Set the message address</a>. </p> </li>
<li id="GUID-FE9BA0F1-F921-50B7-921B-A0AD5E67F4DF"><a name="GUID-FE9BA0F1-F921-50B7-921B-A0AD5E67F4DF"><!-- --></a><p><a href="#GUID-0BD23194-9ED1-5F9B-94B5-EC54678B738B">Set the additional message fields, if required</a>. </p> </li>
<li id="GUID-183E7CE5-2015-52EC-8D5F-F33E81A51F35"><a name="GUID-183E7CE5-2015-52EC-8D5F-F33E81A51F35"><!-- --></a><p><a href="#GUID-E698D0A6-D312-5759-A2EE-029871BA2076">Send the message</a>. </p> </li>
</ol><p><strong>Get a client MTM object</strong></p><p>The Messaging Framework
is based around a server program to which a connection (a session)
must be made before any operation on messaging can be done. The session
class is called <a href="GUID-C6E5F800-0637-419E-8FE5-1EBB40E725AA/GUID-2DA04D96-F0AD-3FDC-9E36-1C27D889AF4B.html#GUID-C6E5F800-0637-419E-8FE5-1EBB40E725AA/GUID-2DA04D96-F0AD-3FDC-9E36-1C27D889AF4B.html"><code class="apiname">CMsvSession</code></a>, and message client
applications typically create an instance of this class upon start-up.</p><pre class="codeblock">// Create message server sessioniMsvSession = CMsvSession::OpenSyncL(*this);</pre><p>The OpenSyncL() method takes a parameter of
type <a href="GUID-C6E5F800-0637-419E-8FE5-1EBB40E725AA/GUID-BDE23754-4536-3AF7-8549-3B953F51167C.html#GUID-C6E5F800-0637-419E-8FE5-1EBB40E725AA/GUID-BDE23754-4536-3AF7-8549-3B953F51167C.html"><code class="apiname">MMsvSessionObserver</code></a>. For this code to work,
the containing class must implement this observer interface. It enables
the server to call the client to inform it of significant events,
such as new MTMs being registered. </p> </div>
<div id="GUID-CB828B5E-4517-538E-9F20-90AEC17C823A"><h3 class="section-title">Handling
incoming messages </h3> <p>Messaging receives SMS messages through
a number of watcher components. When a message is received its contents
are read and a new entry for the message is created in the Message
Store (in the global inbox folder). Typically these messages are then
be read by the user through an SMS application, but other messaging
clients can receive notifications when a new message is created in
the store and can process the message if appropriate. </p> <p>To receive
such notifications, a class must implement the <a href="GUID-C6E5F800-0637-419E-8FE5-1EBB40E725AA/GUID-BDE23754-4536-3AF7-8549-3B953F51167C.html#GUID-C6E5F800-0637-419E-8FE5-1EBB40E725AA/GUID-BDE23754-4536-3AF7-8549-3B953F51167C.html"><code class="apiname">MMsvSessionObserver</code></a> session observer interface. The interface has just one function: </p> <pre class="codeblock">void HandleSessionEventL(TMsvSessionEvent aEvent, TAny* aArg1, TAny* aArg2, TAny* aArg3)=0;</pre> <p>When a new message is created in the store, the framework calls
this function with <code class="codeph">aEvent</code> set to <code class="codeph">EMsvEntriesCreated</code>, and <code class="codeph">aArg1</code> is set to a <code class="codeph">CMsvEntrySelection*</code> that specifies the IDs of the entries that have been created. The
following code snippet checks the event type and gets the entry ID
selection: </p> <pre class="codeblock">void CClientApp::HandleSessionEventL(TMsvSessionEvent aEvent, TAny* aArg1, TAny* , TAny* )
    {
    CMsvEntrySelection* entries = NULL;

    switch (aEvent)
        {
        case EMsvEntriesCreated:
            entries = static_cast&lt;CMsvEntrySelection*&gt;(aArg1);
            break;
        default:
            break;
        }</pre> <p>The observer receives notifications for all
types of entry, so it is necessary to read the message properties
to check that the entry is appropriate to process. </p> <p>The following
code snippet does the first stage of checking: </p> <ol id="GUID-75586A5B-9361-56CA-A18E-879FA38F6D3E">
<li id="GUID-B216D3CF-B462-547A-ABD6-A94696D8545D"><a name="GUID-B216D3CF-B462-547A-ABD6-A94696D8545D"><!-- --></a><p>Gets the index
entry for the message. Getting an index entry is quick compared to
getting the entire message. Therefore, it is recommended that you
perform the required checks on this first. </p> </li>
<li id="GUID-2B4F2DBA-E443-5F9A-9BD3-23F184E0E475"><a name="GUID-2B4F2DBA-E443-5F9A-9BD3-23F184E0E475"><!-- --></a><p>Tests if the
entry is an SMS message, by checking the index entry's <code class="codeph">iMtm</code> and <code class="codeph">iType</code> fields </p> </li>
<li id="GUID-3B839895-2DE9-5FD2-A566-23F857800F89"><a name="GUID-3B839895-2DE9-5FD2-A566-23F857800F89"><!-- --></a><p>Tests if it
is an incoming message, by checking that the entry is in the Inbox. </p> </li>
</ol> <pre class="codeblock">if (entries)
    {
    TInt count = entries-&gt;Count();

    // check each entry to see if we want to process it
    while (count--)
        {
        // get the index entry
        TMsvId serviceId;
        TMsvEntry entry;
        iMtm-&gt;Session().GetEntry((*entries)[count], serviceId, entry);
        // if the entry is an SMS message
        if (entry.iMtm == KUidMsgTypeSMS &amp;&amp; entry.iType == KUidMsvMessageEntry
            // and if it's an incoming message (as its in the inbox)
            &amp;&amp; entry.Parent() == KMsvGlobalInBoxIndexEntryId)</pre> <p>An application can now perform further checks, for example, for
particular message content. </p> <pre class="codeblock">//    sets the client MTM's context to the message 
             
iMtm-&gt;SwitchCurrentEntryL((*entries)[count]);
iMtm-&gt;LoadMessageL();
</pre> <p>If you determine that your application must process
the message, you can prevent the user from seeing the message in the
Inbox of the standard messaging application. To do this, you can set
the message entry's visible flag to false using <a href="GUID-C6E5F800-0637-419E-8FE5-1EBB40E725AA/GUID-5A23B804-2C06-3407-9D48-1BFB212D699F.html#GUID-05E571D2-785A-37AE-9162-DDED472F7B7B"><code class="apiname">TMsvEntry::SetVisible(EFalse)</code></a>. You must delete the message once its processing is complete. </p> </div>
</div></div></div><div class="footer"><p class="metadata">Last updated January 27th, 2012</p><hr /><div class="copy">© Nokia 2012.</div></div></body>
<!-- Mirrored from devlib.symbian.slions.net/belle/GUID-33B590F4-CAE8-58B2-92A9-53123BD42579.html by HTTrack Website Copier/3.x [XR&CO'2014], Fri, 27 Mar 2020 04:02:36 GMT -->
</html>