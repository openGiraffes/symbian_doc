
<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<!-- Mirrored from devlib.symbian.slions.net/belle/GUID-9312621A-C0FF-59E9-8969-739B9E2F8B4C.html by HTTrack Website Copier/3.x [XR&CO'2014], Fri, 27 Mar 2020 03:49:55 GMT -->
<head><meta http-equiv="Content-Type" content="text/html; charset=utf-8" /><meta name="copyright" content="(C) Copyright 2012" /><meta name="DC.rights.owner" content="(C) Copyright 2012" /><meta name="DC.Type" content="concept" /><meta name="DC.Title" content="Using Bluetooth BTComm" /><meta name="DC.Relation" scheme="URI" content="GUID-32E29020-1956-461A-B79A-1492E06049E7" /><meta name="DC.Relation" scheme="URI" content="GUID-227B6970-A536-470F-B5A1-A1871F65D7F3" /><meta name="DC.Relation" scheme="URI" content="GUID-071A1E59-FE77-5D4D-B4D1-E6ECDF68BB03" /><meta name="DC.Relation" scheme="URI" content="GUID-F5B774BD-8276-530D-B3B0-209F8E3BDBFB" /><meta name="DC.Relation" scheme="URI" content="GUID-1446CFB5-750F-51C8-8A30-46B103E26E88" /><meta name="DC.Format" content="XHTML" /><meta name="DC.Identifier" content="GUID-9312621A-C0FF-59E9-8969-739B9E2F8B4C" /><meta name="DC.Language" content="en" /><title>Using Bluetooth BTComm </title><link href="css/s60/style.css" rel="stylesheet" type="text/css" /><link href="PLUGINS_ROOT/com.nokia.forum.library/css/category_cpp5.html" rel="stylesheet" type="text/css" /></head><body><div class="body"><div class="contentLeft prTxt"><h1 class="pageHeading" id="GUID-9312621A-C0FF-59E9-8969-739B9E2F8B4C">Using Bluetooth BTComm</h1><div><div><h3 class="section-title">Purpose</h3> <p>This document shows you how to set up a BTComm serial port in exclusive mode. </p> </div> <div><h3 class="section-title">Opening a BTComm Connection</h3> <p>First you need to create some objects. </p> <pre class="codeblock">// Opening a simple BTCOMM connection.
// Create an RCommServ object.
RCommServ iCommServ;
// Create an RComm object.
RComm iComm;
// Required LITs
_LIT(KTxtBTCOMM,"BTCOMM");
_LIT(KTxtBTCommName,"BTCOMM::");</pre> <p>Connect to the serial comms server: </p> <pre class="codeblock">iCommServ.Connect();</pre> <p>Load the Bluetooth BTComm CSY module using <a href="GUID-C6E5F800-0637-419E-8FE5-1EBB40E725AA/GUID-6B3CA99B-ABF2-32EA-935D-23AE5AE2C306.html#GUID-F851835B-4585-3C3A-B257-ADAE04CD95AA"><code class="apiname">RCommServ::LoadCommModule()</code></a>. </p> <pre class="codeblock">iCommServ.LoadCommModule(KTxtBTCOMM);</pre> <p>Prepare the port name for the connection. </p> <pre class="codeblock">TBuf8&lt;15&gt; commname(KTxtBTCommName);
commname.AppendNum(0);</pre> <p>The <a href="GUID-C6E5F800-0637-419E-8FE5-1EBB40E725AA/GUID-445B19E5-E2EE-32E2-8D6C-C7D6A9B3C507.html#GUID-98CE4C7B-9896-32C8-9D54-4E17E65DD2A2"><code class="apiname">TDes8::AppendNum()</code></a> function above appends the decimal character '<code class="codeph">0</code>', representing the port for this example, onto the end of the '<code class="codeph">commname</code>' descriptor. The <a href="GUID-C6E5F800-0637-419E-8FE5-1EBB40E725AA/GUID-6B3CA99B-ABF2-32EA-935D-23AE5AE2C306.html#GUID-EB42477B-11C1-3A88-86C9-6E9A1BAE5790"><code class="apiname">RCommServ::GetPortInfo()</code></a> function is used to discover the port number if it is not known. </p> <p>Open and configure the BTComm serial port. </p> <pre class="codeblock">User::LeaveIfError(iComm.Open(iCommServ,commname,ECommExclusive));</pre> <p> <a href="GUID-C6E5F800-0637-419E-8FE5-1EBB40E725AA/GUID-3B4E8ED5-72F7-3E51-B188-3C1045526DDF.html#GUID-F2CBC6B8-0BE8-3361-8BDA-774BFB245BE6"><code class="apiname">RComm::Open()</code></a> uses three parameters for a Bluetooth connection, they are shown in the following table: </p> <div class="tablenoborder"><a name="GUID-4298E00C-4851-5107-8A0A-A20155B3B1DF"><!-- --></a><table cellpadding="4" cellspacing="0" summary="" id="GUID-4298E00C-4851-5107-8A0A-A20155B3B1DF" frame="border" border="1" rules="all"><thead align="left"><tr class="title "><th class="cellrowborder" valign="top" id="d0e55924">Parameter</th> <th class="cellrowborder" valign="top" id="d0e55927">Description</th> </tr> </thead> <tbody><tr class=""><td class="cellrowborder" valign="top" headers="d0e55924 "><p> <a href="GUID-C6E5F800-0637-419E-8FE5-1EBB40E725AA/GUID-6B3CA99B-ABF2-32EA-935D-23AE5AE2C306.html#GUID-C6E5F800-0637-419E-8FE5-1EBB40E725AA/GUID-6B3CA99B-ABF2-32EA-935D-23AE5AE2C306.html"><code class="apiname">RCommServ</code></a> &amp;aServer </p> </td> <td class="cellrowborder" valign="top" headers="d0e55927 "><p>The comms server session. </p> </td> </tr> <tr class="bg "><td class="cellrowborder" valign="top" headers="d0e55924 "><p>const TDesC &amp;aName </p> </td> <td class="cellrowborder" valign="top" headers="d0e55927 "><p>The name of the port. </p> </td> </tr> <tr class=""><td class="cellrowborder" valign="top" headers="d0e55924 "><p> TCommAccess aMode </p> </td> <td class="cellrowborder" valign="top" headers="d0e55927 "><p>The mode in which the port is opened. </p> </td> </tr> </tbody> </table></div> <p>The code above assumes your application is opening a BTComm port using the default BTComm CSY. </p> </div> <div><h3 class="section-title">Using the Bluetooth Serial port</h3> <p>The point of opening a port is to enable data transfer. RComm allows you to read and write data over the port. There are several kinds of read and write methods available. </p> <p><strong>Reading </strong> </p> <p> <a href="GUID-C6E5F800-0637-419E-8FE5-1EBB40E725AA/GUID-3B4E8ED5-72F7-3E51-B188-3C1045526DDF.html#GUID-B0B6BC5D-4BCD-3A74-9E1C-17BA58BB7B33"><code class="apiname">RComm::Read()</code></a> reads data from the serial port. There are several variants of the <code class="codeph">Read()</code> method. The standard read provides a <a href="GUID-C6E5F800-0637-419E-8FE5-1EBB40E725AA/GUID-E0B34F3E-D4C4-3232-B8B1-7DB35B454646.html#GUID-C6E5F800-0637-419E-8FE5-1EBB40E725AA/GUID-E0B34F3E-D4C4-3232-B8B1-7DB35B454646.html"><code class="apiname">TRequestStatus</code></a> and the <code class="codeph">TDes8</code> descriptor as a buffer. All reads from the serial device use 8-bit descriptors as data buffers. The number of bytes is set to the maximum length of the descriptor. A length can be provided as a parameter when a known length is required. In that case the number of bytes is set to <code class="codeph">aLength</code>. A timeout can be applied to data being read from the serial port using <a href="GUID-C6E5F800-0637-419E-8FE5-1EBB40E725AA/GUID-EEC5813B-4C9F-323B-BCD6-1BB1A08D0B8C.html#GUID-C6E5F800-0637-419E-8FE5-1EBB40E725AA/GUID-EEC5813B-4C9F-323B-BCD6-1BB1A08D0B8C.html"><code class="apiname">TTimeIntervalMicroSeconds32</code></a> <code class="codeph">aTimeOut</code>. The timeout read can either use the default maximum length of the descriptor or a specific aLength for the number of bytes in the buffer. </p> <p>The simplest variant of <code class="codeph">Read()</code> is shown here: </p> <pre class="codeblock">iComm.Read(iStatus, iBuffer);</pre> <p> <code class="codeph">iComm</code> is the instance of <code class="codeph">RComm</code> opened earlier. </p> <p> <a href="GUID-C6E5F800-0637-419E-8FE5-1EBB40E725AA/GUID-3B4E8ED5-72F7-3E51-B188-3C1045526DDF.html#GUID-D26D6D62-72F0-313C-B3D5-2CE28FDE9BED"><code class="apiname">RComm::ReadOneOrMore()</code></a> is similar to the standard <code class="codeph">Read()</code> method in that it reads any data in the buffer up to the maximum length of the descriptor. If the buffer is empty <code class="codeph">ReadOneOrMore()</code> waits until one or more byte arrives. </p> <p><strong>Writing </strong> </p> <p> <a href="GUID-C6E5F800-0637-419E-8FE5-1EBB40E725AA/GUID-3B4E8ED5-72F7-3E51-B188-3C1045526DDF.html#GUID-27B1F841-8478-33E0-A168-11DC468183C0"><code class="apiname">RComm::Write()</code></a> writes data to the serial port. There are several variants of <code class="codeph">Write()</code>. The standard write provides a <code class="codeph">TRequestStatus</code> and the <code class="codeph">TDes8</code> descriptor as a buffer. All writes from the serial device use 8-bit descriptors as data buffers. The number of bytes is set to the maximum length of the descriptor. A length can be provided as a parameter when a known length is required. In that case the number of bytes is set to <code class="codeph">aLength</code>. A timeout can be applied to data being written to the serial port using <a href="GUID-C6E5F800-0637-419E-8FE5-1EBB40E725AA/GUID-EEC5813B-4C9F-323B-BCD6-1BB1A08D0B8C.html#GUID-C6E5F800-0637-419E-8FE5-1EBB40E725AA/GUID-EEC5813B-4C9F-323B-BCD6-1BB1A08D0B8C.html"><code class="apiname">TTimeIntervalMicroSeconds32</code></a> <code class="codeph">aTimeOut</code>. The <code class="codeph">Write()</code> will terminate after the timeout if the data has not been sent. The timeout write can either use the default maximum length of the descriptor or a specific aLength for the number of bytes in the buffer. </p> <p>The simplest variant of <code class="codeph">Write()</code> is shown here: </p> <pre class="codeblock">iComm.Write(iStatus,iBuffer);</pre> <p><strong>Cancelling </strong> </p> <p>You can cancel a pending <code class="codeph">Read()</code> or <code class="codeph">Write()</code> using <code class="codeph">ReadCancel()</code> or <code class="codeph">WriteCancel()</code>. </p> <pre class="codeblock">iComm.ReadCancel();</pre> <p>The <code class="codeph">TRequestStatus</code> of the pending <code class="codeph">Read()</code>, <code class="codeph">ReadOneOrMore()</code> or <code class="codeph">Write()</code> will be set to <code class="codeph">KErrCancel</code>. </p> </div> <div><h3 class="section-title">Closing your Connection</h3> <p>Close the serial port using <a href="GUID-C6E5F800-0637-419E-8FE5-1EBB40E725AA/GUID-3B4E8ED5-72F7-3E51-B188-3C1045526DDF.html#GUID-5F3D449E-65E8-32E4-B316-247FC859D8D6"><code class="apiname">RComm::Close()</code></a>: </p> <pre class="codeblock">iComm.Close();</pre> <p>Closes the serial port. </p> </div> </div></div></div><div class="footer"><p class="metadata">Last updated October 9th, 2009</p><hr /><div class="copy">© Nokia 2012.</div></div></body>
<!-- Mirrored from devlib.symbian.slions.net/belle/GUID-9312621A-C0FF-59E9-8969-739B9E2F8B4C.html by HTTrack Website Copier/3.x [XR&CO'2014], Fri, 27 Mar 2020 03:49:55 GMT -->
</html>