
<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<!-- Mirrored from devlib.symbian.slions.net/s3/GUID-6DC34798-86CE-537D-B3B8-9A94FF77B283.html by HTTrack Website Copier/3.x [XR&CO'2014], Fri, 27 Mar 2020 06:13:30 GMT -->
<head><meta http-equiv="Content-Type" content="text/html; charset=utf-8" /><meta name="copyright" content="(C) Copyright 2011" /><meta name="DC.rights.owner" content="(C) Copyright 2011" /><meta name="DC.Type" content="concept" /><meta name="DC.Title" content="Image Encoding" /><meta name="DC.Relation" scheme="URI" content="GUID-88091838-03FC-550F-9A3D-DA70907EF955" /><meta name="DC.Relation" scheme="URI" content="GUID-3D9C4B45-EEA0-581C-A9E5-8B2535014930" /><meta name="DC.Relation" scheme="URI" content="GUID-B10B048F-37FF-53E7-92B9-83F8C197566A" /><meta name="DC.Relation" scheme="URI" content="GUID-A825B62E-B5F6-5FDD-B267-E47103D57FD8" /><meta name="DC.Relation" scheme="URI" content="GUID-32E29020-1956-461A-B79A-1492E06049E7" /><meta name="DC.Relation" scheme="URI" content="GUID-1DE5CDAD-8D71-5384-9E98-5665D5A4C792" /><meta name="DC.Relation" scheme="URI" content="GUID-3E341F9F-2635-589B-A59A-B999FE7DF9BE" /><meta name="DC.Relation" scheme="URI" content="GUID-7DB86BF1-0485-5CBA-9554-4C474B0EC1FB" /><meta name="DC.Relation" scheme="URI" content="GUID-A68D1F27-FE7E-503E-B5B6-7BD555B88558" /><meta name="DC.Relation" scheme="URI" content="GUID-786A8188-AB4D-5C65-8BEF-50E45FDBE9A5" /><meta name="DC.Format" content="XHTML" /><meta name="DC.Identifier" content="GUID-6DC34798-86CE-537D-B3B8-9A94FF77B283" /><meta name="DC.Language" content="en" /><title>Image Encoding </title><link href="css/s60/style.css" rel="stylesheet" type="text/css" /><link href="PLUGINS_ROOT/com.nokia.forum.library/css/category_design.html" rel="stylesheet" type="text/css" /></head><body><div class="body"><div class="contentLeft prTxt"><h1 class="pageHeading" id="GUID-6DC34798-86CE-537D-B3B8-9A94FF77B283">Image Encoding</h1><div><p>This document gives you more information about the Image Encoding functionality. </p> <div><h3 class="section-title">Purpose</h3> <p>The image encoding class CImageEncoder provides functions to save the following to files or descriptors: </p> <ul><li id="GUID-E0BCDD5B-933C-5B02-A2E3-775F95226E98"><a name="GUID-E0BCDD5B-933C-5B02-A2E3-775F95226E98"><!-- --></a><p>Images originating from the screen. </p> </li> <li id="GUID-61C02273-687B-5BF7-BF34-7BB90273DD0D"><a name="GUID-61C02273-687B-5BF7-BF34-7BB90273DD0D"><!-- --></a><p>Applications such as browsers and paint programs </p> </li> <li id="GUID-2499D229-BAE4-50DA-A2B3-9E6DDED375F5"><a name="GUID-2499D229-BAE4-50DA-A2B3-9E6DDED375F5"><!-- --></a><p>Photos from cameras or viewer applications </p> </li> </ul> <p><strong>Required Background</strong> </p> <p>Image Encoding features are provided through Imaging Frameworks and Imaging plugins. The standard formats supported by the encoder plugins are shown in the table in <a href="GUID-88091838-03FC-550F-9A3D-DA70907EF955.html">Imaging Frameworks Overview</a>. </p> <p><strong>Introduction</strong> </p> <p>The encoding process has been broken down into two stage process: </p> <ul><li id="GUID-74A226F0-F67C-56D3-BF10-9B9BA4729B58"><a name="GUID-74A226F0-F67C-56D3-BF10-9B9BA4729B58"><!-- --></a><p>Creation </p> </li> <li id="GUID-E80A69E3-D077-5C6D-82CA-303F82718A01"><a name="GUID-E80A69E3-D077-5C6D-82CA-303F82718A01"><!-- --></a><p>Conversion </p> </li> </ul> <p><strong>Setup and Configuration Requirements</strong> </p> <p>The <a href="GUID-251A35C1-CC66-4DE4-9EBE-964026E89E7F/GUID-737DA130-9A66-39E2-9E68-2E65F37E02C8.html#GUID-251A35C1-CC66-4DE4-9EBE-964026E89E7F/GUID-737DA130-9A66-39E2-9E68-2E65F37E02C8.html"><code class="apiname">CImageEncoder</code></a> classes use synchronous methods to open an image and asynchronous methods to perform conversions or transformations. The asynchronous operations use the standard system of taking a pointer to a <a href="GUID-251A35C1-CC66-4DE4-9EBE-964026E89E7F/GUID-E0B34F3E-D4C4-3232-B8B1-7DB35B454646.html#GUID-251A35C1-CC66-4DE4-9EBE-964026E89E7F/GUID-E0B34F3E-D4C4-3232-B8B1-7DB35B454646.html"><code class="apiname">TRequestStatus</code></a> object that is signalled on completion of the requested action. The assumption is that the client application or the calling DLL holds the <code class="codeph">TRequestStatus</code> values within active objects. The structure of the active objects is dependent on the code that uses Imaging Frameworks and its own requirements, particularly its internal architecture and how many images are opened simultaneously. </p> <p>In addition to the use of active objects in the interfacing, many of Imaging Frameworks internal functions make extensive use of them to provide asynchronous behaviour. As with any use of an active object it is necessary to have an active scheduler in the same thread as the application making use of the object. The encoder can also be created, so the plugin and framework runs in a separate thread. This is achieved by setting the <code class="codeph">EOptionAlwaysThread</code> option when constructing the encoder objects. By running the object in its own thread, the application is shielded from any latency that can occur during image conversion, or possibly due to a badly written plugin. </p> <p> <strong> Note:</strong> The encoder plugin formats do not support multiframe images or bitmap masks (transparent images). </p> </div> <div><h3 class="section-title">Using Image Encoding </h3> <p>The Following tasks are covered in this tutorial: </p> <ul><li id="GUID-D520A78B-63C6-57CD-BB28-40E7D88EE837"><a name="GUID-D520A78B-63C6-57CD-BB28-40E7D88EE837"><!-- --></a><p><a href="#GUID-DFE3CD4C-2787-5DEC-A0AC-871CEBD22B11">How to create the object during encoding</a> </p> </li> <li id="GUID-FE370FAC-ECB1-529F-B951-8FAAFCD60938"><a name="GUID-FE370FAC-ECB1-529F-B951-8FAAFCD60938"><!-- --></a><p><a href="#GUID-3CA67D41-A9F2-5D83-A0BC-61E1FDA4AA30">How to convert decoded data to encoded data</a> </p> </li> </ul> <p id="GUID-DFE3CD4C-2787-5DEC-A0AC-871CEBD22B11"><a name="GUID-DFE3CD4C-2787-5DEC-A0AC-871CEBD22B11"><!-- --></a><strong>Basic Procedure For Creation</strong> </p> <p>The high level steps to create the object during encoding are as follows: </p> <ol id="GUID-8FA73392-60BE-5D71-AB1B-B8C30EE95B1E"><li id="GUID-8B0FFDEE-614D-5BE8-BCD0-D208AB330FC2"><a name="GUID-8B0FFDEE-614D-5BE8-BCD0-D208AB330FC2"><!-- --></a><p>The creation of the encoder object is a synchronous operation performed using one of the following factory constructors: </p> <pre class="codeblock">static CImageEncoder* FileNewL(RFs&amp; aFs, const TDesC&amp; aDestinationFilename, const TDesC8&amp; aMIMEType, const TOptions aOptions = EOptionNone);

static CImageEncoder* FileNewL(RFs&amp; aFs, const TDesC&amp; aDestinationFilename, const TOptions aOptions = EOptionNone, const TUid aImageType = KNullUid, const TUid aImageSubType = KNullUid, const TUid aEncoderUid = KNullUid);

static CImageEncoder* DataNewL(HBufC8*&amp; aDestinationData, const TDesC8&amp; aMIMEType, const TOptions aOptions = EOptionNone);

static CImageEncoder* DataNewL(HBufC8*&amp; aDestinationData, const TOptions aOptions = EOptionNone, const TUid aImageType = KNullUid, const TUid aImageSubType = KNullUid, const TUid aEncoderUid = KNullUid);
</pre> </li> <li id="GUID-10936CCA-61DE-5983-9C4C-1E4143F8F74F"><a name="GUID-10936CCA-61DE-5983-9C4C-1E4143F8F74F"><!-- --></a><p>The <code class="codeph">FileNewL()</code> constructors are used to convert image data saved to a file. The two variants of the function enable you to set the imaging plugin to use either by specifying a MIME type, or by specifying an image type and sub-type and optional encoder UID. </p> </li> <li id="GUID-36BF55A5-A2CB-5C5D-BC3D-4269A019FCA7"><a name="GUID-36BF55A5-A2CB-5C5D-BC3D-4269A019FCA7"><!-- --></a><p>The <code class="codeph">DataNewL()</code> constructors are used to convert image data saved to a buffer. Rather than specifying the destination buffer itself, the <code class="codeph">DataNewL</code> functions require a <code class="codeph">HBufC8*</code> value that must be set to zero. On successful completion of the conversion the <code class="codeph">HBufC8*</code> contains a pointer to an internally generated buffer that contains the converted image data. </p> </li> <li id="GUID-E1B15CF8-1342-5FCA-B74B-A78850BDDDA5"><a name="GUID-E1B15CF8-1342-5FCA-B74B-A78850BDDDA5"><!-- --></a><p>The two variants of the <code class="codeph">DataNewL()</code> constructors enable you to specify the imaging plugin to use either by specifying a MIME type, an image type and sub-type, or by specifying the plugin ID itself. </p> </li> </ol> <p id="GUID-3CA67D41-A9F2-5D83-A0BC-61E1FDA4AA30"><a name="GUID-3CA67D41-A9F2-5D83-A0BC-61E1FDA4AA30"><!-- --></a><strong>Basic Procedure For Conversion</strong> </p> <p>The high level steps to convert decoded data to Encoded data are as follows: </p> <ol id="GUID-62B573C4-6279-5A32-9017-F038F0B940CD"><li id="GUID-A3DD37B7-04D8-5FED-ACC0-5DB963102D02"><a name="GUID-A3DD37B7-04D8-5FED-ACC0-5DB963102D02"><!-- --></a><p>Before converting the image data, the destination image format specific data can be set by using <a href="GUID-251A35C1-CC66-4DE4-9EBE-964026E89E7F/GUID-27B63129-ABD9-3B6C-882B-6F4501AF8E15.html#GUID-251A35C1-CC66-4DE4-9EBE-964026E89E7F/GUID-27B63129-ABD9-3B6C-882B-6F4501AF8E15.html"><code class="apiname">CFrameImageData</code></a>. However, the type of data that can be supplied is dependant on the Imaging plugin that is being used. </p> </li> <li id="GUID-4CA47591-EA85-5A6F-95C0-8C46CB727DB3"><a name="GUID-4CA47591-EA85-5A6F-95C0-8C46CB727DB3"><!-- --></a><p>The format specific data are <a href="GUID-251A35C1-CC66-4DE4-9EBE-964026E89E7F/GUID-9F5FFC62-2A6C-307A-8E34-1D9DE874A133.html#GUID-251A35C1-CC66-4DE4-9EBE-964026E89E7F/GUID-9F5FFC62-2A6C-307A-8E34-1D9DE874A133.html"><code class="apiname">TImageDataBlock</code></a> and <a href="GUID-251A35C1-CC66-4DE4-9EBE-964026E89E7F/GUID-7E326426-8AE4-3792-8B80-19D2A4B839F3.html#GUID-251A35C1-CC66-4DE4-9EBE-964026E89E7F/GUID-7E326426-8AE4-3792-8B80-19D2A4B839F3.html"><code class="apiname">TFrameDataBlock</code></a> derivatives provided by the Imaging plugin. These can be appended to <a href="GUID-251A35C1-CC66-4DE4-9EBE-964026E89E7F/GUID-27B63129-ABD9-3B6C-882B-6F4501AF8E15.html#GUID-251A35C1-CC66-4DE4-9EBE-964026E89E7F/GUID-27B63129-ABD9-3B6C-882B-6F4501AF8E15.html"><code class="apiname">CFrameImageData</code></a> using AppendImageData() and AppendFrameData() at which point <code class="codeph">CFrameImageData</code> takes ownership of the data. </p> </li> </ol> <p><strong>Example </strong> </p> <pre class="codeblock">TJpegImageData imageData = new (ELeave) TJpegImageData;

// Set some format specific data
imageData-&gt;iSampleScheme = TJpegImageData::EColor444;
imageData-&gt;iQualityFactor = 95;

iFrameImageData = CFrameImageData::NewL();

// frameData - ownership passed to iFrameImageData after AppendImageData
User::LeaveIfError(iFrameImageData-&gt;AppendImageData(imageData));

// Do the convert
iEncoder-&gt;Convert(iRequesStatus,iFrameBitmap,iFrameImageData);
</pre> </div> </div><h3>Related concepts</h3><ul><li><a href="GUID-88091838-03FC-550F-9A3D-DA70907EF955.html">Imaging Frameworks overview</a></li><li><a href="GUID-3D9C4B45-EEA0-581C-A9E5-8B2535014930.html">Image Conversion Overview</a></li><li><a href="GUID-B10B048F-37FF-53E7-92B9-83F8C197566A.html">Image Decoding Tutorial</a></li><li><a href="GUID-A825B62E-B5F6-5FDD-B267-E47103D57FD8.html"> Guide to Symbian supplied Codecs </a></li></ul></div></div><div class="footer"><p class="metadata">Last updated October 9th, 2009</p><hr /><div class="copy">© Nokia 2011.</div></div></body>
<!-- Mirrored from devlib.symbian.slions.net/s3/GUID-6DC34798-86CE-537D-B3B8-9A94FF77B283.html by HTTrack Website Copier/3.x [XR&CO'2014], Fri, 27 Mar 2020 06:13:30 GMT -->
</html>