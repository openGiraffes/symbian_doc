
<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<!-- Mirrored from devlib.symbian.slions.net/s3/GUID-CB568D14-1B0C-568F-B9CA-DDD15C53EEF3.html by HTTrack Website Copier/3.x [XR&CO'2014], Fri, 27 Mar 2020 06:19:46 GMT -->
<head><meta http-equiv="Content-Type" content="text/html; charset=utf-8" /><meta name="copyright" content="(C) Copyright 2011" /><meta name="DC.rights.owner" content="(C) Copyright 2011" /><meta name="DC.Type" content="concept" /><meta name="DC.Title" content="Writing a Parser Plug-in" /><meta name="DC.Relation" scheme="URI" content="GUID-32E29020-1956-461A-B79A-1492E06049E7" /><meta name="DC.Relation" scheme="URI" content="GUID-82AF5F49-EE25-54C7-AEE9-D1F41BD5190F" /><meta name="DC.Relation" scheme="URI" content="GUID-A25E730C-F34D-5464-BE78-650B3DEA4A88" /><meta name="DC.Relation" scheme="URI" content="GUID-AF28D930-6BD1-5DC5-9BE5-7512241E90CD" /><meta name="DC.Relation" scheme="URI" content="GUID-4A9255D1-42A4-57FA-A4B4-42C552964047" /><meta name="DC.Format" content="XHTML" /><meta name="DC.Identifier" content="GUID-CB568D14-1B0C-568F-B9CA-DDD15C53EEF3" /><meta name="DC.Language" content="en" /><title>Writing a Parser Plug-in </title><link href="css/s60/style.css" rel="stylesheet" type="text/css" /><link href="PLUGINS_ROOT/com.nokia.forum.library/css/category_design.html" rel="stylesheet" type="text/css" /></head><body><div class="body"><div class="contentLeft prTxt"><h1 class="pageHeading" id="GUID-CB568D14-1B0C-568F-B9CA-DDD15C53EEF3">Writing a Parser Plug-in</h1><div><p>This section describes how to write a parser plug-in. </p> <div><h3 class="section-title">Introduction</h3> <p>The Symbian XML framework supplies an XML parser plug-in which is based on <a href="http://expat.sourceforge.net/" target="_blank">Expat</a>. The framework provides plug-ins with standard features. However a user can customize a plug-in according to his requirement such as parsing only a part of a document or releasing a specific resource. </p> <p>The Symbian platform XML framework defines certain standard features which a parser may have, and while designing a parser, consider the features it provides. The following is a list of standard features provided by a parser: </p> <ul><li id="GUID-86B70B90-0CAA-53CE-9B81-1B22A9B83A89"><a name="GUID-86B70B90-0CAA-53CE-9B81-1B22A9B83A89"><!-- --></a><p>Report unrecognised tags, namespace, namespace prefix and mappings. </p> </li> <li id="GUID-20C1FD61-F800-57D0-A489-5C4243D661CA"><a name="GUID-20C1FD61-F800-57D0-A489-5C4243D661CA"><!-- --></a><p>Convert elements and attributes to lower case, that is, it is case-insensitive like an HTML parser. </p> </li> <li id="GUID-D67D42B2-0B50-5F2A-A41F-57D04FDEB610"><a name="GUID-D67D42B2-0B50-5F2A-A41F-57D04FDEB610"><!-- --></a><p>Describe the data in a specified encoding: the default is UTF-8. </p> </li> <li id="GUID-99EA2A0E-D83E-5E1A-8E81-B1005AEE67E8"><a name="GUID-99EA2A0E-D83E-5E1A-8E81-B1005AEE67E8"><!-- --></a><p>Accept XML 1.0 and XML 1.1. The default is to accept XML 1.0 only. </p> </li> </ul> <p>A user defined parser plug-in must implement the <a href="GUID-251A35C1-CC66-4DE4-9EBE-964026E89E7F/GUID-6F334B00-8026-3FA3-AE96-B0A511030B7B.html#GUID-251A35C1-CC66-4DE4-9EBE-964026E89E7F/GUID-6F334B00-8026-3FA3-AE96-B0A511030B7B.html"><code class="apiname">MParser</code></a> interface which has six pure virtual APIs. Three of them concern the parser features listed above. Two other methods perform the parsing; their purpose is to implement the parse functions of the CParser class discussed in <a href="GUID-E16070E5-379A-5818-81CC-B00059A40084.html">Choosing a Parser Plug-in</a> and one method is for releasing resources. The following is the list of APIs of <a href="GUID-251A35C1-CC66-4DE4-9EBE-964026E89E7F/GUID-6F334B00-8026-3FA3-AE96-B0A511030B7B.html#GUID-251A35C1-CC66-4DE4-9EBE-964026E89E7F/GUID-6F334B00-8026-3FA3-AE96-B0A511030B7B.html"><code class="apiname">MParser</code></a>: </p> <div class="tablenoborder"><a name="GUID-66D19903-DB61-5E37-B79E-65DD12F80A7C"><!-- --></a><table cellpadding="4" cellspacing="0" summary="" id="GUID-66D19903-DB61-5E37-B79E-65DD12F80A7C" frame="border" border="1" rules="all"><thead align="left"><tr class="title "><th class="cellrowborder" valign="top" id="d0e500012">Class</th> <th class="cellrowborder" valign="top" id="d0e500015">Description</th> </tr> </thead> <tbody><tr class=""><td class="cellrowborder" valign="top" headers="d0e500012 "><p> EnableFeature() </p> </td> <td class="cellrowborder" valign="top" headers="d0e500015 "><p>Enables the feature. </p> </td> </tr> <tr class="bg "><td class="cellrowborder" valign="top" headers="d0e500012 "><p> DisableFeature() </p> </td> <td class="cellrowborder" valign="top" headers="d0e500015 "><p>Disables the feature. </p> </td> </tr> <tr class=""><td class="cellrowborder" valign="top" headers="d0e500012 "><p> IsFeatureEnabled() </p> </td> <td class="cellrowborder" valign="top" headers="d0e500015 "><p>Checks if the feature is enabled. </p> </td> </tr> <tr class="bg "><td class="cellrowborder" valign="top" headers="d0e500012 "><p> ParseChunkL() </p> </td> <td class="cellrowborder" valign="top" headers="d0e500015 "><p>Parses part of a document. Implements CParser::ParseL(). </p> </td> </tr> <tr class=""><td class="cellrowborder" valign="top" headers="d0e500012 "><p> ParseLastChunkL() </p> </td> <td class="cellrowborder" valign="top" headers="d0e500015 "><p>Parses the last part of a document. Implements <code class="codeph">CParser::ParseEndL()</code>. </p> </td> </tr> <tr class="bg "><td class="cellrowborder" valign="top" headers="d0e500012 "><p> Release() </p> </td> <td class="cellrowborder" valign="top" headers="d0e500015 "><p>Must be called to release resources when the framework has finished using the parser implementation. </p> </td> </tr> </tbody> </table></div> <p>Some documents contain markups from more than one XML application, which means that the parser may encounter tags and attributes which look the same but belong to different namespaces. This is why the <a href="GUID-251A35C1-CC66-4DE4-9EBE-964026E89E7F/GUID-6F334B00-8026-3FA3-AE96-B0A511030B7B.html#GUID-251A35C1-CC66-4DE4-9EBE-964026E89E7F/GUID-6F334B00-8026-3FA3-AE96-B0A511030B7B.html"><code class="apiname">MParser</code></a> interface provides a feature for the reporting of namespaces. XML associates tags and attributes with namespaces by adding a prefix to them, and the prefixes are mapped to the URI where the namespace is defined. The class RTagInfo is provided to hold this information. It is initialised with three strings representing the URI, prefix and local name, and these information can be retrieved by Uri(), Prefix() and LocalName() respectively. If the application has to parse documents which combine multiple namespaces, then the implementation of <a href="GUID-251A35C1-CC66-4DE4-9EBE-964026E89E7F/GUID-6F334B00-8026-3FA3-AE96-B0A511030B7B.html#GUID-251A35C1-CC66-4DE4-9EBE-964026E89E7F/GUID-6F334B00-8026-3FA3-AE96-B0A511030B7B.html"><code class="apiname">MParser</code></a> must hold a parsed tag and attributes in an RTagInfo object. The content handler will then have sufficient information to react differently to tags in different namespaces. </p> <p>Some XML applications, notably WBXML, extend XML syntax by adding extension tokens to the markup language. The <a href="http://www.w3.org/TR/wbxml/" target="_blank">WBXML specification</a> defines nine global extension tokens but does not assign semantics to them. The meaning of extension tokens is specific to the document in which they are used, but they are typically used for compression to identify certain data which must be compressed in a specific way. For instance, extension tokens are sometimes used to identify data as being variables not constants, or as having a particular data type. To handle extension tokens, a parser plugin must implement the method WbxmlExtensionHandler::OnExtensionL() with three parameters aData, aToken, aErrorCode. The first parameter holds the actual data, the second specifies the global extension token and the third is the error code. </p> <p> </p> </div> <div><h3 class="section-title">Procedure</h3> <p>To write a parser plug-in, follow the steps given below: </p> <ol id="GUID-33F33876-0B72-528F-AAF5-3AC785AF7ED7"><li id="GUID-92AFD990-5EE3-5244-9DD7-38E3730A5352"><a name="GUID-92AFD990-5EE3-5244-9DD7-38E3730A5352"><!-- --></a><p>Encapsulate the data structures in <code class="codeph">TParserInitParams</code>. </p> <p>The main data structures required are contained in the TParserInitParams class, which is typically passed as a parameter to the constructor method of an <a href="GUID-251A35C1-CC66-4DE4-9EBE-964026E89E7F/GUID-6F334B00-8026-3FA3-AE96-B0A511030B7B.html#GUID-251A35C1-CC66-4DE4-9EBE-964026E89E7F/GUID-6F334B00-8026-3FA3-AE96-B0A511030B7B.html"><code class="apiname">MParser</code></a> implementation. TParserInitParams has the following member classes: </p> <div class="tablenoborder"><a name="GUID-342A5B66-015B-5490-BDDA-B5ED84068652"><!-- --></a><table cellpadding="4" cellspacing="0" summary="" id="GUID-342A5B66-015B-5490-BDDA-B5ED84068652" frame="border" border="1" rules="all"><thead align="left"><tr class="title "><th class="cellrowborder" valign="top" id="d0e500220">API</th> <th class="cellrowborder" valign="top" id="d0e500223">Description</th> </tr> </thead> <tbody><tr class=""><td class="cellrowborder" valign="top" headers="d0e500220 "><p> CCharSetConverter </p> </td> <td class="cellrowborder" valign="top" headers="d0e500223 "><p>Used to convert text to and from Unicode. </p> </td> </tr> <tr class="bg "><td class="cellrowborder" valign="top" headers="d0e500220 "><p> MContentHandler </p> </td> <td class="cellrowborder" valign="top" headers="d0e500223 "><p>Interface to the application which is writen to handle the output of the parser. It is discussed in Using Symbian XML Framework. </p> </td> </tr> <tr class=""><td class="cellrowborder" valign="top" headers="d0e500220 "><p> RStringDictionaryCollection </p> </td> <td class="cellrowborder" valign="top" headers="d0e500223 "><p>A collection of string dictionaries discussed in <a href="GUID-F4099885-55A0-5ACF-A73B-9C647B02B142.html">Customising a Parser</a>. A string dictionary is an implementation of the MStringDictionary interface which is used to tokenise XML input into tagged elements in accordance with the DTD associated with the document to be parsed. </p> </td> </tr> <tr class="bg "><td class="cellrowborder" valign="top" headers="d0e500220 "><p> RElementStack </p> </td> <td class="cellrowborder" valign="top" headers="d0e500223 "><p>An array structure used to stack elements in the order in which the parser encounters them. </p> </td> </tr> </tbody> </table></div> <pre class="codeblock">
MParser* CMyParser::NewL(TAny* aInitParams)
    {
     CMyParser* self = new( ELeave ) CMyParser( reinterpret_cast&lt;TParserInitParams*&gt;( aInitParams ) );
     return( static_cast&lt;MParser*&gt;( self ) );
    }
CMyParser::CMyParser( TParserInitParams* aInitParams )
:   iContentHandler( reinterpret_cast&lt;MContentHandler*&gt;( aInitParams-&gt;iContentHandler ) ),
    iStringDictionaryCollection( reinterpret_cast&lt;RStringDictionaryCollection*&gt;( aInitParams-&gt;iStringDictionaryCollection ) ),
    iCharSetConverter( reinterpret_cast&lt;CCharSetConverter*&gt;( aInitParams-&gt;iCharSetConverter ) ),
    iElementStack( reinterpret_cast&lt;RElementStack*&gt;( aInitParams-&gt;iElementStack ) )
    {
    }</pre> </li> <li id="GUID-1C9D73E8-1A14-51EF-9E41-03E6EFA3165B"><a name="GUID-1C9D73E8-1A14-51EF-9E41-03E6EFA3165B"><!-- --></a><p>Select XML parser features. </p> </li> <li id="GUID-B5493F5A-41CF-5A3A-806C-D7A56C26B981"><a name="GUID-B5493F5A-41CF-5A3A-806C-D7A56C26B981"><!-- --></a><p>Implement CMyParser derived from <code class="codeph">MParser</code>. </p> <pre class="codeblock">
class CMyParser : public MParser
    {
    static MParser* NewL(TAny* aInitParams);
    virtual ~CMyParser();
    
    public:
        /** Enable a feature. */
        TInt EnableFeature( TInt aParserFeature )
            { 
            // your code here to enable the specified feature
            }
       /** Disable a feature. */
       TInt DisableFeature( TInt aParserFeature )
            { 
            // your code here to disable the specified feature
            }
       /** See if a feature is enabled. */
       TBool IsFeatureEnabled( TInt aParserFeature ) const
            { 
            // your code here to check if the specified feature is enabled
            } 
       /** Parses a descriptor that contains part of a document. */
       void ParseChunkL( const TDesC8&amp; aChunk )
            { 
            // your code here
            } 
       /** Parses a descriptor that contains the last  part of a document. */
       void ParseLastChunkL( const TDesC8&amp; aFinalChunk )
            { 
            // your code here
            } 
       /** Interfaces don't have a destructor, so we have an explicit method instead. */
       void Release()
            { 
            // your code here 
            }
    };</pre> </li> <li id="GUID-B6B9ED7E-EFD0-5788-A0BE-6C8911FBF66E"><a name="GUID-B6B9ED7E-EFD0-5788-A0BE-6C8911FBF66E"><!-- --></a><p>Release resources using Release(). </p> <p>When a parse fails, the parser object must be destroyed. This means that the implementation of the <a href="GUID-251A35C1-CC66-4DE4-9EBE-964026E89E7F/GUID-6F334B00-8026-3FA3-AE96-B0A511030B7B.html#GUID-251A35C1-CC66-4DE4-9EBE-964026E89E7F/GUID-6F334B00-8026-3FA3-AE96-B0A511030B7B.html"><code class="apiname">MParser</code></a> and MContentHandler methods must contain calls to <a href="GUID-251A35C1-CC66-4DE4-9EBE-964026E89E7F/GUID-C197C9A7-EA05-3F24-9854-542E984C612D.html#GUID-96AFAC46-F3AD-392B-8A97-AFCBF2978CFB"><code class="apiname">User::LeaveIfError()</code></a> with an error code as parameter. Specific error codes are supplied for various cases as discussed in the <a href="GUID-5DACAB53-6D32-5250-9BC2-3E8597C3E2B2.html">Error Codes</a> section of this document. </p> </li> </ol> </div> </div></div></div><div class="footer"><p class="metadata">Last updated October 9th, 2009</p><hr /><div class="copy">© Nokia 2011.</div></div></body>
<!-- Mirrored from devlib.symbian.slions.net/s3/GUID-CB568D14-1B0C-568F-B9CA-DDD15C53EEF3.html by HTTrack Website Copier/3.x [XR&CO'2014], Fri, 27 Mar 2020 06:19:46 GMT -->
</html>