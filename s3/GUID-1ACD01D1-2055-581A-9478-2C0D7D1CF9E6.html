
<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<!-- Mirrored from devlib.symbian.slions.net/s3/GUID-1ACD01D1-2055-581A-9478-2C0D7D1CF9E6.html by HTTrack Website Copier/3.x [XR&CO'2014], Fri, 27 Mar 2020 06:02:00 GMT -->
<head><meta http-equiv="Content-Type" content="text/html; charset=utf-8" /><meta name="copyright" content="(C) Copyright 2011" /><meta name="DC.rights.owner" content="(C) Copyright 2011" /><meta name="DC.Type" content="concept" /><meta name="DC.Title" content="Use Cases for Writing Standard C++ Code" /><meta name="DC.Relation" scheme="URI" content="GUID-D6BEAF0D-844D-51F4-8DB7-FB1D60E17FE3" /><meta name="DC.Relation" scheme="URI" content="GUID-F7FEB759-E64D-5B6D-9017-C5E982E4FC16" /><meta name="DC.Relation" scheme="URI" content="GUID-2CCD1748-9EDE-5383-9941-A3051E06F3E2" /><meta name="DC.Relation" scheme="URI" content="GUID-E331B72B-84AF-558A-9B8F-73E5E50B58C7" /><meta name="DC.Relation" scheme="URI" content="GUID-AF2CE612-F12E-5A18-81A5-C303992D2D46" /><meta name="DC.Relation" scheme="URI" content="GUID-D32E52C9-F05C-5F1E-8B49-243D555C353C" /><meta name="DC.Relation" scheme="URI" content="GUID-5B3F5296-D6D0-5D25-8362-141DF5927E52" /><meta name="DC.Relation" scheme="URI" content="GUID-32E29020-1956-461A-B79A-1492E06049E7" /><meta name="DC.Relation" scheme="URI" content="GUID-5072BE46-B1B4-5C3A-BF55-BEA7443E7657" /><meta name="DC.Relation" scheme="URI" content="GUID-E2DE2C6F-E071-5E88-96F1-D71DDED84609" /><meta name="DC.Relation" scheme="URI" content="GUID-2C5B58F2-6BD2-5C2B-8E1B-CFB3D7EB6ED9" /><meta name="DC.Relation" scheme="URI" content="GUID-4492D5C1-C64E-5561-8A3F-8D887603B6FB" /><meta name="DC.Relation" scheme="URI" content="GUID-CDE8CD85-8467-5B36-A0AC-41D1D98151CA" /><meta name="DC.Format" content="XHTML" /><meta name="DC.Identifier" content="GUID-1ACD01D1-2055-581A-9478-2C0D7D1CF9E6" /><meta name="DC.Language" content="en" /><title>Use
Cases for Writing Standard C++ Code </title><link href="css/s60/style.css" rel="stylesheet" type="text/css" /><link href="PLUGINS_ROOT/com.nokia.forum.library/css/category_design.html" rel="stylesheet" type="text/css" /></head><body><div class="body"><div class="contentLeft prTxt"><h1 class="pageHeading" id="GUID-1ACD01D1-2055-581A-9478-2C0D7D1CF9E6">Use
Cases for Writing Standard C++ Code</h1><div>
<p>The following topics describe the use cases based on which you can write
Standard C++ code on the Symbian platform: </p>
<ul>
<li id="GUID-FE4675CC-A3B2-5487-8318-996810CED805"><a name="GUID-FE4675CC-A3B2-5487-8318-996810CED805"><!-- --></a><p><a href="#GUID-20DCAC0E-D335-55A7-ADDE-17245D591970">Standard C++ code using STL or Standard C</a> </p> </li>
<li id="GUID-6AE48560-9481-511F-9165-FA9F15E36D2F"><a name="GUID-6AE48560-9481-511F-9165-FA9F15E36D2F"><!-- --></a><p><a href="#GUID-4024FCCD-7A54-50EE-BCDD-72BC23A34CD8">Standard C++ code calling Symbian C++ functions</a> </p> </li>
<li id="GUID-84E464CC-B1D3-51FD-85B3-2984F042204E"><a name="GUID-84E464CC-B1D3-51FD-85B3-2984F042204E"><!-- --></a><p><a href="#GUID-B6F7FA56-D3DD-5638-A1E9-676B7C4354BD">Symbian C++ code calling Standard C++ functions</a> </p> </li>
</ul>
<div id="GUID-20DCAC0E-D335-55A7-ADDE-17245D591970"><h3 class="section-title"> Standard C++
code using STL or Standard C</h3> <p>You can write a pure Standard C++
application or library that does not use Symbian C++ directly. When you write
Standard C++ code using STL or Standard C ensure that you adhere to the following
guidelines: </p> <ol id="GUID-19F8A9FD-550E-5CEE-A481-24A82BC70DD0">
<li id="GUID-5107C1FB-E3B8-5680-8295-FD6860A76710"><a name="GUID-5107C1FB-E3B8-5680-8295-FD6860A76710"><!-- --></a><p>Use the <code class="codeph">STDCPP</code> keyword
in the <code>.mmp</code> file or you target type must be an <code class="codeph">STD</code> target
type. </p> </li>
<li id="GUID-1E1A166A-F7A9-5B6A-A7BC-F143FCDCACED"><a name="GUID-1E1A166A-F7A9-5B6A-A7BC-F143FCDCACED"><!-- --></a><p>Use only the Standard
C++ semantics of the global <code class="codeph">operator                 new</code>. </p> </li>
<li id="GUID-32B3C42A-9291-57C5-8030-F3966FC64AF4"><a name="GUID-32B3C42A-9291-57C5-8030-F3966FC64AF4"><!-- --></a><p>Your code must not depend
on One Definition Rule (ODR) across DLL boundaries. For more information,
see the <a href="GUID-AF2CE612-F12E-5A18-81A5-C303992D2D46.html#GUID-A85386B3-3E37-5303-8FBF-211551D5CB71">Use
of one definition rule</a> section. </p> </li>
</ol> <p> <strong>Notes:</strong> </p> <ul>
<li id="GUID-32BC5E8B-3C8C-59C5-A361-6184B0123563"><a name="GUID-32BC5E8B-3C8C-59C5-A361-6184B0123563"><!-- --></a><p>If these guidelines
are not followed, it can result in problems described in the <a href="GUID-AF2CE612-F12E-5A18-81A5-C303992D2D46.html">Possible
Problems</a> section. </p> </li>
<li id="GUID-F75F3E1A-195B-5326-8A7D-4667D43BEF0A"><a name="GUID-F75F3E1A-195B-5326-8A7D-4667D43BEF0A"><!-- --></a><p>Before you write a Standard
C++ library, see the <a href="GUID-C9D4D586-58BF-5676-A53F-9C3A51101430.html">Guidelines
for Writing Standard C++ Libraries</a> section. </p> </li>
</ul> </div>
<div id="GUID-4024FCCD-7A54-50EE-BCDD-72BC23A34CD8"><h3 class="section-title">Standard C++
code calling Symbian C++ functions</h3> <p>When you write Standard C++
code that calls Symbian C++ functions ensure that you adhere to the following
guidelines: </p> <ol id="GUID-FABDAF1D-3BBE-55CA-9F8B-9AE140A4B556">
<li id="GUID-6CC66050-575D-50FD-BF22-68BE09721B9D"><a name="GUID-6CC66050-575D-50FD-BF22-68BE09721B9D"><!-- --></a><p>Use the <code class="codeph">STDCPP</code> keyword
in the <code>.mmp</code> file or have an <code class="codeph">STD</code> target
type. </p> </li>
<li id="GUID-2C217279-A018-5F11-A4D9-F69CDBD84EEA"><a name="GUID-2C217279-A018-5F11-A4D9-F69CDBD84EEA"><!-- --></a><p>Use only the Standard
C++ semantics of the global <code class="codeph">operator                 new</code>. </p> </li>
<li id="GUID-13155A1C-7E78-5036-AFD8-C0458DCEBE9D"><a name="GUID-13155A1C-7E78-5036-AFD8-C0458DCEBE9D"><!-- --></a><p>Your code must not depend
on One Definition Rule (ODR) across DLL boundaries. For more information,
see the <a href="GUID-AF2CE612-F12E-5A18-81A5-C303992D2D46.html#GUID-A85386B3-3E37-5303-8FBF-211551D5CB71">Use
of one definition rule</a> section. </p> </li>
<li id="GUID-9A449F22-6905-54AF-B7AA-F07737368126"><a name="GUID-9A449F22-6905-54AF-B7AA-F07737368126"><!-- --></a><p>Use <a href="#GUID-A37EF5D8-67AD-5DC3-983C-A9E37A3E9D3C">barrier mechanisms</a> while calling leaving functions of Symbian C++.
Here barrier mechanisms are barriers for exception propagation in terms of
TRAPs. </p> </li>
</ol> <p> <strong>Note:</strong> Before you write a Standard C++ library, see the <a href="GUID-C9D4D586-58BF-5676-A53F-9C3A51101430.html">Guidelines for Writing Standard
C++ Libraries</a> section. </p> <p id="GUID-A37EF5D8-67AD-5DC3-983C-A9E37A3E9D3C"><a name="GUID-A37EF5D8-67AD-5DC3-983C-A9E37A3E9D3C"><!-- --></a><strong> Barrier
mechanisms for writing Standard C++ code</strong> </p> <p>Leaving functions of
Symbian C++ that are called from Standard C++ code must be called under a
TRAP as shown in the following code: </p> <pre class="codeblock">TRAPD (err, GetAnotherK1LC());</pre> <p>This enables a leaving function to have the items on the cleanup stack removed
that were added by this function itself (or any of its callees). Otherwise,
this can cause problems illustrated in the <a href="GUID-AF2CE612-F12E-5A18-81A5-C303992D2D46.html#GUID-6CE49D59-46BB-5145-B346-6FD3EA8BC011">Standard
C++ calling Symbian C++ functions</a> section. </p> <p> <strong>Note:</strong> For
more information about the leave-idiom on Symbian C++, see the <strong>Lifetimes
in Symbian</strong> topic under the <a href="GUID-1FFE4ED5-7B2E-58A0-9D08-A096F53F37AB.html">Object
lifetimes and cleanup</a> section. </p> <p>The error code <code class="codeph">err</code> can
then be translated to throw a corresponding Standard C++ exception using the <code class="codeph">TranslateSymErrorToCppException</code> utility
function. This function is declared in <code>stdcpp_support.h</code>. </p> <p>Alternatively,
you can also use the following utility macro: </p> <pre class="codeblock">TRANSLATE_SYM_CPP_LEAVES (CallSymbianOSCppL());</pre> <p>This macro calls the leaving function under a TRAP and if there is error,
it throws the corresponding Standard C++ exception. The following table illustrates
the mapping between an error and an exception: </p> <div class="tablenoborder"><a name="GUID-A037AA99-8D1B-595E-B36E-E6BCEB7C8E25"><!-- --></a><table cellpadding="4" cellspacing="0" summary="" id="GUID-A037AA99-8D1B-595E-B36E-E6BCEB7C8E25" frame="border" border="1" rules="all">
<thead align="left">
<tr class="title ">
<th class="cellrowborder" valign="top" id="d0e198686">Error</th>
<th class="cellrowborder" valign="top" id="d0e198689">Exception</th>
</tr>
</thead>
<tbody>
<tr class="">
<td class="cellrowborder" valign="top" headers="d0e198686 "><p> <code class="codeph">KErrNoMemory</code> </p> </td>
<td class="cellrowborder" valign="top" headers="d0e198689 "><p> <code class="codeph">std::bad_alloc</code> </p> </td>
</tr>
<tr class="bg ">
<td class="cellrowborder" valign="top" headers="d0e198686 "><p> <code class="codeph">KErrArgument</code> </p> </td>
<td class="cellrowborder" valign="top" headers="d0e198689 "><p> <code class="codeph">std::invalid_argument</code> </p> </td>
</tr>
<tr class="">
<td class="cellrowborder" valign="top" headers="d0e198686 "><p> <code class="codeph">KErrOverflow</code> </p> </td>
<td class="cellrowborder" valign="top" headers="d0e198689 "><p> <code class="codeph">std::overflow_error</code> </p> </td>
</tr>
<tr class="bg ">
<td class="cellrowborder" valign="top" headers="d0e198686 "><p> <code class="codeph">KErrUnderflow</code> </p> </td>
<td class="cellrowborder" valign="top" headers="d0e198689 "><p> <code class="codeph">std::underflow_error</code> </p> </td>
</tr>
<tr class="">
<td class="cellrowborder" valign="top" headers="d0e198686 "><p>Other errors </p> </td>
<td class="cellrowborder" valign="top" headers="d0e198689 "><p> <code class="codeph">Symbian_error</code> </p> </td>
</tr>
</tbody>
</table></div> </div>
<div id="GUID-B6F7FA56-D3DD-5638-A1E9-676B7C4354BD"><h3 class="section-title">Symbian C++
code calling Standard C++ functions</h3> <p>When you write Symbian C++
code that calls Standard C++ functions ensure that you adhere to the following
guidelines: </p> <ol id="GUID-B2C94D28-6AF6-565B-A575-0B950B9B46B1">
<li id="GUID-C0B7A2DE-9FF2-55E0-AB15-C90AAA76B997"><a name="GUID-C0B7A2DE-9FF2-55E0-AB15-C90AAA76B997"><!-- --></a><p>Use the Symbian C++
semantics of the global <code class="codeph">operator                 new</code>. </p> </li>
<li id="GUID-A89D2A48-2885-5E7C-81AB-DEA4E75A8034"><a name="GUID-A89D2A48-2885-5E7C-81AB-DEA4E75A8034"><!-- --></a><p>Use <a href="#GUID-0D05436A-6B25-5D48-A13F-D959762860D3">barrier mechanisms</a> while calling Standard C++ functions. Here, barrier
mechanisms are barriers for exception propagation in terms of catch handlers
or exception-specification (of a function) </p> </li>
</ol> <p id="GUID-0D05436A-6B25-5D48-A13F-D959762860D3"><a name="GUID-0D05436A-6B25-5D48-A13F-D959762860D3"><!-- --></a><strong> Barrier mechanisms
for writing Symbian C++ code</strong> </p> <p>A Standard C++ function that can
throw must be called using a catch-handler. You can use catch-handlers for
non-leaving functions as illustrated in the following code: </p> <pre class="codeblock">void SymbianCppFunction()
    {
    try
        {
        // This is calling a StdC++ function that may throw any exception.
        CppCallee(aK1, anotherK1);
        }
    catch (std::exception aException)
        {    
        // Catch all the standard C++ exceptions and translate them 
        // to an appropriate Symbian platform error code using the following 
        //utility function
        error = TranslateCppExceptionToSymError(aException);
        }
    catch (X aX)
        {
        // The barrier can look for any call site specific exceptions that it
        // knows about and wants to treat specially
        }
    catch (...)
        {
        // catch all 
        }
    }</pre> <p>You can use catch-handlers for leaving functions as illustrated
in the following code: </p> <pre class="codeblock">void SymbianCppFunctionL()
    {
    try
        {
        // This is calling a StdC++ function that may throw any exception.
        CppCallee(aK1, anotherK1);
        }
    catch (std::exception aException)
        {    
        // Catch all the standard C++ exceptions and translate them 
        // to an appropriate Symbian platform error code using the following 
        //utility function
         TInt error = TranslateCppExceptionToSymError(aException);
        User::Leave(error);
        }
    catch (X aX)
        {
        // The barrier can look for any call site specific exceptions that it
        // knows about and wants to treat specially
        TInt error;
        //set the error here
        User::Leave(error);
        }
    catch (...)
        {
        // catch all 
        TInt error;
        //set the error here
        User::Leave(error);
        }
    }</pre> </div>
</div><h3>Related concepts</h3><ul><li><a href="GUID-D6BEAF0D-844D-51F4-8DB7-FB1D60E17FE3.html">Copyright
Acknowledgments for Standard C++ (STLport)</a></li><li><a href="GUID-F7FEB759-E64D-5B6D-9017-C5E982E4FC16.html">Standard
C++ Library Overview</a></li><li><a href="GUID-2CCD1748-9EDE-5383-9941-A3051E06F3E2.html"> Standard
C++ Support on the Symbian Platform</a></li><li><a href="GUID-E331B72B-84AF-558A-9B8F-73E5E50B58C7.html">Building
a Standard C++ Application or Library</a></li><li><a href="GUID-AF2CE612-F12E-5A18-81A5-C303992D2D46.html">Possible
Problems</a></li><li><a href="GUID-D32E52C9-F05C-5F1E-8B49-243D555C353C.html">Known Issues</a></li><li><a href="GUID-5B3F5296-D6D0-5D25-8362-141DF5927E52.html">Troubleshooting</a></li></ul></div></div><div class="footer"><p class="metadata">Last updated January 28th, 2010</p><hr /><div class="copy">© Nokia 2011.</div></div></body>
<!-- Mirrored from devlib.symbian.slions.net/s3/GUID-1ACD01D1-2055-581A-9478-2C0D7D1CF9E6.html by HTTrack Website Copier/3.x [XR&CO'2014], Fri, 27 Mar 2020 06:02:00 GMT -->
</html>