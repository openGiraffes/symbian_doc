
<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<!-- Mirrored from devlib.symbian.slions.net/s3/GUID-B26A4743-F331-5AC3-A40A-28B14B785857.html by HTTrack Website Copier/3.x [XR&CO'2014], Fri, 27 Mar 2020 06:12:43 GMT -->
<head><meta http-equiv="Content-Type" content="text/html; charset=utf-8" /><meta name="copyright" content="(C) Copyright 2011" /><meta name="DC.rights.owner" content="(C) Copyright 2011" /><meta name="DC.Type" content="reference" /><meta name="DC.Title" content="SearchSortExample: enhanced search and sort for Message Store" /><meta name="abstract" content="This example demonstrates the enhanced search and sort API for message stores. This API was implemented in Symbian^3." /><meta name="description" content="This example demonstrates the enhanced search and sort API for message stores. This API was implemented in Symbian^3." /><meta name="DC.Relation" scheme="URI" content="GUID-32E29020-1956-461A-B79A-1492E06049E7" /><meta name="DC.Relation" scheme="URI" content="GUID-5DD1010C-1648-5086-BA80-BC25F3C7A2C4" /><meta name="DC.Relation" scheme="URI" content="GUID-C290FA5E-8E41-5D19-B8C1-F88491EE6388" /><meta name="DC.Relation" scheme="URI" content="GUID-B394A824-8745-505E-8429-8B9B6D418387" /><meta name="DC.Relation" scheme="URI" content="GUID-1DF2D6EC-C445-5A0C-80C4-9C46AAA6EE44" /><meta name="DC.Format" content="XHTML" /><meta name="DC.Identifier" content="GUID-B26A4743-F331-5AC3-A40A-28B14B785857" /><meta name="DC.Language" content="en" /><title>SearchSortExample: enhanced search and sort for Message Store </title><link href="css/s60/style.css" rel="stylesheet" type="text/css" /><link href="PLUGINS_ROOT/com.nokia.forum.library/css/category_design.html" rel="stylesheet" type="text/css" /></head><body><div class="body"><div class="contentLeft prTxt"><h1 class="pageHeading" id="GUID-B26A4743-F331-5AC3-A40A-28B14B785857">SearchSortExample: enhanced search and sort for Message Store</h1><div><p>This example demonstrates the enhanced search and sort
API for message stores. This API was implemented in Symbian^3. </p>
<div id="GUID-B702DCF4-5C83-4AE2-95F5-F09D7DC46255"><h3 class="section-title">Purpose</h3> <p>Prior to Symbian^3, the Message Store API had limited support
for selecting and sorting message records and fields. From Symbian^3,
the API implements more extensive search and sort options.</p> <p>This example demonstrates the new functionality by implementing the
following use cases: </p> <ul>
<li id="GUID-E9B88EDB-8DD1-5CC2-B6DD-CA8498FE1865"><a name="GUID-E9B88EDB-8DD1-5CC2-B6DD-CA8498FE1865"><!-- --></a><p>Display the
header information for all message entries. </p> </li>
<li id="GUID-5D07456E-DEDE-578D-961F-138E9DBD9470"><a name="GUID-5D07456E-DEDE-578D-961F-138E9DBD9470"><!-- --></a><p>Perform a simple
(single search criteria) non-iterative search-sort and display the
matching entries. This has the following options: </p> <ul>
<li id="GUID-73CAF478-2B69-5883-B7A1-4F8B20D884E8"><a name="GUID-73CAF478-2B69-5883-B7A1-4F8B20D884E8"><!-- --></a><p>case sensitivity
on / off, </p> </li>
<li id="GUID-D158CBA7-4947-589F-9C1E-FFB0E36A8CEF"><a name="GUID-D158CBA7-4947-589F-9C1E-FFB0E36A8CEF"><!-- --></a><p>whole word search
on / off. </p> </li>
</ul> </li>
<li id="GUID-F2FC91DD-8198-53BB-9C77-5DC30C071AE1"><a name="GUID-F2FC91DD-8198-53BB-9C77-5DC30C071AE1"><!-- --></a><p>Perform a combined
(more than one search criteria) non-iterative search-sort and display
the number of matching entries. This has the following options: </p> <ul>
<li id="GUID-25CDF7E6-9D22-58C8-8832-03B0723A7F6E"><a name="GUID-25CDF7E6-9D22-58C8-8832-03B0723A7F6E"><!-- --></a><p>case sensitivity
on / off, </p> </li>
<li id="GUID-35902CB3-B4AF-56D0-937A-A840B3F40CDA"><a name="GUID-35902CB3-B4AF-56D0-937A-A840B3F40CDA"><!-- --></a><p>whole word search
on / off. </p> </li>
</ul> </li>
<li id="GUID-54A5DEF1-21F3-5B24-85BA-71450C7E3D2D"><a name="GUID-54A5DEF1-21F3-5B24-85BA-71450C7E3D2D"><!-- --></a><p>Perform an iterative
search-sort (searches for entries one at a time) and display the number
of matching entries. </p> </li>
<li id="GUID-5412D0A2-2A38-5F34-AE9E-AE7940345DDC"><a name="GUID-5412D0A2-2A38-5F34-AE9E-AE7940345DDC"><!-- --></a><p>Perform a search-sort
using a query ID. The query ID is generated by a previous search-sort
operation. </p> </li>
</ul> <p>Before implementing these use cases, the example creates
a POP3/SMTP message store with five message entries. </p> </div>
<div id="GUID-4FBA245A-78AC-4584-8471-240D504C3ED0"><h3 class="section-title">Class
summary</h3><p>The example demonstrates the following classes and
enums:</p><ul>
<li><p>CMsvSearchSortOperation</p></li>
<li><p> CMsvSearchSortQuery</p></li>
<li><p> TMsvMessagePart</p></li>
<li><p> TMsvSearchSortResultType</p></li>
</ul></div>
<div id="GUID-9331568B-0BA3-5138-BDCC-65AC225A5328"><h3 class="section-title">Download</h3> <p>Click on the following link to download the example: <a href="guid-6013a680-57f9-415b-8851-c4fa63356636/zips/guid-dbb3813f-c947-4359-805e-eeada16f1dbb.zip" target="_blank">searchsortexample.zip</a></p><p>Click: <a href="guid-6013a680-57f9-415b-8851-c4fa63356636/guid-dbb3813f-c947-4359-805e-eeada16f1dbb.html#guid-6013a680-57f9-415b-8851-c4fa63356636/guid-dbb3813f-c947-4359-805e-eeada16f1dbb.html">browse</a> to view the example code. </p> </div>
<div id="GUID-F8B3E0E7-FB82-5266-AB40-C1149A782E83"><h3 class="section-title">Design and implementation</h3> <p><strong>Project Implementation</strong> </p> <p>The project implements the following classes: </p> <p> <strong>CKeyReader:</strong> Derived from <code class="codeph">CActive</code>. This reads
keypresses and calls the appropriate example function. </p> <p> <strong>CMessAsyncWaiter:</strong> Derived from <code class="codeph">CActive</code>. This
handles the <code class="codeph">CMsvSearchSortOperation::RequestL()</code> asynchronous
request. This <code class="codeph">RequestL()</code> function takes <code class="codeph">CMessAsyncWaiter::iStatus</code> as one of its parameters and then waits on the status. When the
search is complete the client is notified of the event's completion
by <code class="codeph">CMessAsyncWaiter::RunL()</code> being called, after which
the example prepares the buffer and displays the results. </p> <p> <strong>CSearchsortExample:</strong> Derived from <code class="codeph">CBase</code> and <code class="codeph">MMsvSessionObserver</code>. <code class="codeph">MMsvSessionObserver</code> is an interface for notification of events from a Message Server
session. </p> <p> <code class="codeph">CSearchsortExample</code> implements <code class="codeph">HandleSessionEventL()</code> to handle the two event types <code class="codeph">EMsvEntriesCreated</code> and <code class="codeph">EMsvServerReady</code>.
It also creates the SMTP message entries and carries out searching
and sorting. </p> <p><strong>Simple non-iterative search-sort</strong> </p> <p>The example starts by creating a message server session using <code class="codeph">CMsvSession</code>, which represents a channel of communication
between a client thread (client-side MTM, user interface MTM, or message
client application) and the Message Server thread. Then it creates
an instance of <code class="codeph">CMsvSearchSortOperation</code> to perform
the search-sort operation, and passes the session object into it. </p> <p>A search-sort query is created using CMsvSearchSortQuery::NewL() and is configured using various member functions of class CMsvSearchSortQuery for instance whether to search for
whole or partial words and the case sensitivity. </p> <p>The search
and sort options are added to the query using <code class="codeph">CMsvSearchSortQuery::AddSearchOptionL()</code> and <code class="codeph">CMsvSearchSortQuery::AddSortOptionL()</code>. </p> <p>The search-sort operation is started by calling CMsvSearchSortOperation::RequestL(), passing the query as a parameter. If no iterator parameter is specified,
the search defaults to non-iterative. </p> <p>An instance of the <code class="codeph">CMessAsyncWaiter</code> class is created for handling the asynchronous
search request. This object is waited on until the Message Server
completes the request. The results of the search are stored in an
array using CMsvSearchSortOperation::GetResultsL(). </p> <p>The result count is displayed by calling CMsvSearchSortOperation::GetResultCountL(). </p> <p>The query ID of the search is retrieved from the Message
server, for later use, using the CMsvSearchSortOperation::GetQueryId() function. </p> <p><strong>Simple iterative search-sort</strong> </p> <p>Iterative
search-sort follows the same steps as described above, except that
an iterator parameter is passed to the <code class="codeph">RequestL()</code> function. To retrieve the results, CMsvSearchSortOperation::GetNextResultL() is called in a <code class="codeph">while</code> loop to retrieve one entry
at a time. Iterative searching is useful when the client may not have
enough memory to store an array of results. </p> <p><strong>Combined search-sort</strong> </p> <p>A combined search-sort is done by adding additional search
options using <code class="codeph">CMsvSearchSortQuery::AddSearchOptionL()</code>. </p> <p><strong>Search-sort using a query ID</strong> </p> <p>A query ID
identifies a search-sort query. It is obtained by calling CMsvSearchSortOperation::GetQueryIdL() following the completion
of CMsvSearchSortOperation::RequestL(). In this
example, the query ID generated by the simple non-iterative search-sort
is used to repeat the same search-sort. The overloaded <code class="codeph">CMsvSearchSortOperation::RequestL()</code> function is used to initiate a search-sort operation with a query
ID. </p> <p>After the request completes, a list of index entry ID
objects (TMsvId or TMsvEntry depending on how the query was configured, using CMsvSearchSortQuery::SetResultType()) is retrieved using <code class="codeph">CMsvSearchSortOperation::GetResultsL()</code>. Finally the matching results are displayed in the console. </p> </div>
<div id="GUID-AE5E0880-9CAB-57E5-83CB-196D487935DE"><h3 class="section-title">Building
and configuring</h3> <p>To build the example: </p> <ul>
<li id="GUID-61C94258-567F-575E-A75C-29D2165FC2CA"><a name="GUID-61C94258-567F-575E-A75C-29D2165FC2CA"><!-- --></a><p>You can build
the example from your IDE or the command line. </p> <p>If you use
an IDE, import the <code>bld.inf</code> file of the example
into your IDE, and use the build command of the IDE. </p> <p>If you
use the command line, open a command prompt, and set the current directory
to the source code directory of the example. You can then build the
example with the SBSv1 build tools with the following commands: </p> <p><kbd class="userinput">bldmake bldfiles</kbd> </p> <p><kbd class="userinput">abld
build</kbd> </p> </li>
<li id="GUID-F470E492-C920-58E0-860C-5CCE24B0C7F4"><a name="GUID-F470E492-C920-58E0-860C-5CCE24B0C7F4"><!-- --></a><p>For the emulator,
the example builds an executable called <code>searchsortexample.exe</code> in the <code>epoc32\release\winscw\&lt;udeb                
or urel&gt;\</code> folder. </p> </li>
</ul> </div>
<div id="GUID-B72B706B-BB9F-5A0D-A36A-03135FE99E5C"><h3 class="section-title">Running
the example</h3> <p> <code>searchsortexample.exe</code> takes user input from the console. The menu for the current example
is as shown below: </p> <div class="figure" id="GUID-53020118-A1E3-56C3-AA81-9CED04533E27"><img src="GUID-656E2E4F-D7C5-5FDC-B1E6-DFA5970BB3F0_d0e366142_href.jpg" /></div> <p>The user input is handled by <code class="codeph">CKeyReader::RunL()</code>. </p> <p>For simple and combined non-iterative search-sort, the
user provides the following inputs: 1) the text in the "To" field
to search for, 2) whether case sensitivity is on of off, 3) whether
whole word searching is on or off. </p> <p>The input values are saved
in variables which are passed to the function <code class="codeph">CSearchsortExample::SearchSortRequestWithoutIteratorL()</code>, and the settings are made accordingly. </p> <p>For the combined
search-sort the 2nd and 3rd search options (size and subject) are
hard coded. The iterative search-sort searches by size, which is also
hard coded. </p> <p>To execute a search-sort using a query ID, CMsvSearchSortOperation::RequestL(CMsvSearchSortQuery *,TBool,TRequestStatus
&amp;,TInt) must first have been called because it generates
the query ID. So, either option 2 or 3 must have been called before
option 5. </p> </div>
<div id="GUID-23202235-0D1E-4D86-83E1-9EC7A315E682"><h3 class="section-title">See
also</h3><p><a href="GUID-32C1FC8B-F7D2-5275-BDF2-0D662551294C.html">Search-Sort Overview</a></p></div>
</div></div></div><div class="footer"><p class="metadata">Last updated July 8th, 2010</p><hr /><div class="copy">© Nokia 2011.</div></div></body>
<!-- Mirrored from devlib.symbian.slions.net/s3/GUID-B26A4743-F331-5AC3-A40A-28B14B785857.html by HTTrack Website Copier/3.x [XR&CO'2014], Fri, 27 Mar 2020 06:12:46 GMT -->
</html>