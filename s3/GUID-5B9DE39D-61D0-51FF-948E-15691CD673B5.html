
<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<!-- Mirrored from devlib.symbian.slions.net/s3/GUID-5B9DE39D-61D0-51FF-948E-15691CD673B5.html by HTTrack Website Copier/3.x [XR&CO'2014], Fri, 27 Mar 2020 06:08:21 GMT -->
<head><meta http-equiv="Content-Type" content="text/html; charset=utf-8" /><meta name="copyright" content="(C) Copyright 2011" /><meta name="DC.rights.owner" content="(C) Copyright 2011" /><meta name="DC.Type" content="concept" /><meta name="DC.Title" content="AdvancedClientServerExample: Using Client/Server APIs" /><meta name="abstract" content="This example application demonstrates the use of client/server APIs using a logical device driver (LDD) and a physical device driver (PDD)." /><meta name="description" content="This example application demonstrates the use of client/server APIs using a logical device driver (LDD) and a physical device driver (PDD)." /><meta name="DC.Relation" scheme="URI" content="GUID-3786D8E6-17A9-52E4-A8DF-CFCDC3039854" /><meta name="DC.Relation" scheme="URI" content="GUID-F78B7BF9-5FDD-4EF8-A921-71CCBB830A99" /><meta name="DC.Relation" scheme="URI" content="GUID-32E29020-1956-461A-B79A-1492E06049E7" /><meta name="DC.Relation" scheme="URI" content="GUID-E3D2A6ED-8192-563D-8966-DD96B3AF1783" /><meta name="DC.Relation" scheme="URI" content="GUID-0DF9E318-BE97-531E-AB39-A7B5E8787C87" /><meta name="DC.Relation" scheme="URI" content="GUID-A63025D1-7FD4-5120-8A1F-537D6B70103D" /><meta name="DC.Relation" scheme="URI" content="GUID-0D61EBFF-F513-5911-B234-09F36E5E3DC8" /><meta name="DC.Format" content="XHTML" /><meta name="DC.Identifier" content="GUID-5B9DE39D-61D0-51FF-948E-15691CD673B5" /><meta name="DC.Language" content="en" /><title>AdvancedClientServerExample: Using Client/Server APIs </title><link href="css/s60/style.css" rel="stylesheet" type="text/css" /><link href="PLUGINS_ROOT/com.nokia.forum.library/css/category_design.html" rel="stylesheet" type="text/css" /></head><body><div class="body"><div class="contentLeft prTxt"><h1 class="pageHeading" id="GUID-5B9DE39D-61D0-51FF-948E-15691CD673B5">AdvancedClientServerExample: Using Client/Server APIs</h1><div><p>This example application demonstrates the use of client/server
APIs using a logical device driver (LDD) and a physical device driver
(PDD).</p>
<div id="GUID-4A6D20D7-F28D-49AD-AF44-96FA26ED867A"><h3 class="section-title">Introduction</h3> <p> This example implements asynchronous as well as synchronous
client requests to the server. This example also demonstrates a client
and server running in separate processes and a client and server running
in the same process. </p> <p>This example demonstrates the following: </p> <ul>
<li id="GUID-D4A42C17-F34C-5745-85A2-8FCCEB7B2EEA"><a name="GUID-D4A42C17-F34C-5745-85A2-8FCCEB7B2EEA"><!-- --></a><p> <strong>a server
running its own process:</strong> This is referred to in this document
as the <em>process server</em>. The example also implements a DLL that
provides an API to allow clients to request services from the process
server. This client DLL is referred to as the <em>process client</em>. </p> </li>
<li id="GUID-FB3B8745-BF31-5D0F-81AD-E04F23DBA188"><a name="GUID-FB3B8745-BF31-5D0F-81AD-E04F23DBA188"><!-- --></a><p> <strong>a server
and client running in a single process:</strong> These are referred to
as the <em>thread server</em> and <em>thread client</em>. </p> </li>
<li id="GUID-7582867D-1D14-5ECC-85B9-59F4A4E9E1EE"><a name="GUID-7582867D-1D14-5ECC-85B9-59F4A4E9E1EE"><!-- --></a><p> <strong>a shut down
server:</strong> This terminates the process or thread server if it has
no clients connected to it for 50 seconds. </p> </li>
</ul> </div>
<div id="GUID-3A1715FE-3F34-44FB-826F-E441FD724D01"><h3 class="section-title">Download</h3><p><strong>Process Client and Server</strong></p><p>Click the following links
to download the example:</p><p><a href="guid-6013a680-57f9-415b-8851-c4fa63356636/zips/guid-76d97fc3-887f-495b-841a-3ae9de66dbf2.zip" target="_blank"> ProcessClient.zip</a></p><p><a href="guid-6013a680-57f9-415b-8851-c4fa63356636/zips/guid-4b308120-fd3c-484f-bc1c-36cd2b99cc4e.zip" target="_blank"> ProcessServer.zip</a></p><p>Click the following
links for additional files: </p><p><a href="guid-6013a680-57f9-415b-8851-c4fa63356636/zips/guid-d98c1ba5-ea6d-4c8b-a1fc-a0c1a175d36c.zip" target="_blank"> ProcessServerInc.zip</a></p><p><a href="guid-6013a680-57f9-415b-8851-c4fa63356636/zips/guid-f8dabf02-68a2-40d9-8667-84dfa6dfd2ba.zip" target="_blank"> Common.zip</a></p><p><a href="guid-6013a680-57f9-415b-8851-c4fa63356636/zips/guid-b5fa4b2f-acec-47e3-a0d7-f9187923e7b9.zip" target="_blank"> Driver.zip</a></p><p>Click the following links
to view the example: </p><p><a href="guid-6013a680-57f9-415b-8851-c4fa63356636/guid-76d97fc3-887f-495b-841a-3ae9de66dbf2.html#guid-6013a680-57f9-415b-8851-c4fa63356636/guid-76d97fc3-887f-495b-841a-3ae9de66dbf2.html"> browse ProcessClient </a></p><p><a href="guid-6013a680-57f9-415b-8851-c4fa63356636/guid-4b308120-fd3c-484f-bc1c-36cd2b99cc4e.html#guid-6013a680-57f9-415b-8851-c4fa63356636/guid-4b308120-fd3c-484f-bc1c-36cd2b99cc4e.html"> browse ProcessServer </a> </p><p>Click the following
links to view additional files: </p><p><a href="guid-6013a680-57f9-415b-8851-c4fa63356636/guid-d98c1ba5-ea6d-4c8b-a1fc-a0c1a175d36c.html#guid-6013a680-57f9-415b-8851-c4fa63356636/guid-d98c1ba5-ea6d-4c8b-a1fc-a0c1a175d36c.html"> browse ProcessServerInc </a></p><p><a href="guid-6013a680-57f9-415b-8851-c4fa63356636/guid-f8dabf02-68a2-40d9-8667-84dfa6dfd2ba.html#guid-6013a680-57f9-415b-8851-c4fa63356636/guid-f8dabf02-68a2-40d9-8667-84dfa6dfd2ba.html"> browse Common </a></p><p><a href="guid-6013a680-57f9-415b-8851-c4fa63356636/guid-b5fa4b2f-acec-47e3-a0d7-f9187923e7b9.html#guid-6013a680-57f9-415b-8851-c4fa63356636/guid-b5fa4b2f-acec-47e3-a0d7-f9187923e7b9.html"> browse Driver </a></p><p><strong>Thread Client and Server</strong></p><p>Click the following links to download the example:</p><p><a href="guid-6013a680-57f9-415b-8851-c4fa63356636/zips/guid-fc40328d-eede-4c14-86f3-3691c3db13b7.zip" target="_blank"> ThreadClient.zip </a></p><p><a href="guid-6013a680-57f9-415b-8851-c4fa63356636/zips/guid-81f8a0e6-2a4c-48b2-afeb-b385b4cdbb56.zip" target="_blank"> ThreadServer.zip </a></p><p>Click the following
links to download additional files:</p><p><a href="guid-6013a680-57f9-415b-8851-c4fa63356636/zips/guid-e61faf57-e35c-4951-ac16-d55954810ba1.zip" target="_blank">ThreadServerInc.zip</a></p><p><a href="guid-6013a680-57f9-415b-8851-c4fa63356636/zips/guid-b5fa4b2f-acec-47e3-a0d7-f9187923e7b9.zip" target="_blank"> Driver.zip</a></p><p><a href="guid-6013a680-57f9-415b-8851-c4fa63356636/zips/guid-98e2a1ec-8beb-4a7c-a731-309d28afe815.zip" target="_blank"> CommonInc.zip</a></p><p><a href="guid-6013a680-57f9-415b-8851-c4fa63356636/zips/guid-f8dabf02-68a2-40d9-8667-84dfa6dfd2ba.zip" target="_blank"> Common.zip</a></p><p>Click the following links
to view the example: </p><p><a href="guid-6013a680-57f9-415b-8851-c4fa63356636/guid-fc40328d-eede-4c14-86f3-3691c3db13b7.html#guid-6013a680-57f9-415b-8851-c4fa63356636/guid-fc40328d-eede-4c14-86f3-3691c3db13b7.html">browse ThreadClient</a></p><p><a href="guid-6013a680-57f9-415b-8851-c4fa63356636/guid-81f8a0e6-2a4c-48b2-afeb-b385b4cdbb56.html#guid-6013a680-57f9-415b-8851-c4fa63356636/guid-81f8a0e6-2a4c-48b2-afeb-b385b4cdbb56.html">browse ThreadServer</a></p><p>Click the following
links to view additional files</p><p><a href="guid-6013a680-57f9-415b-8851-c4fa63356636/guid-e61faf57-e35c-4951-ac16-d55954810ba1.html#guid-6013a680-57f9-415b-8851-c4fa63356636/guid-e61faf57-e35c-4951-ac16-d55954810ba1.html"> browse ThreadServerInc </a></p><p><a href="guid-6013a680-57f9-415b-8851-c4fa63356636/guid-b5fa4b2f-acec-47e3-a0d7-f9187923e7b9.html#guid-6013a680-57f9-415b-8851-c4fa63356636/guid-b5fa4b2f-acec-47e3-a0d7-f9187923e7b9.html"> browse Driver</a></p><p><a href="guid-6013a680-57f9-415b-8851-c4fa63356636/guid-98e2a1ec-8beb-4a7c-a731-309d28afe815.html#guid-6013a680-57f9-415b-8851-c4fa63356636/guid-98e2a1ec-8beb-4a7c-a731-309d28afe815.html"> browse CommonInc</a></p><p><a href="guid-6013a680-57f9-415b-8851-c4fa63356636/guid-f8dabf02-68a2-40d9-8667-84dfa6dfd2ba.html#guid-6013a680-57f9-415b-8851-c4fa63356636/guid-f8dabf02-68a2-40d9-8667-84dfa6dfd2ba.html"> browse Common</a></p><p></p> </div>
<div id="GUID-FE0D7810-DBE0-51BC-B0CF-31A6EF605072"><h3 class="section-title">Directories</h3> <p><strong>common</strong> </p> <p>This directory contains code that is common
to the process and thread servers. It implements the shut down server
which checks the number of connected clients to the thread or process
server. If this number is zero, then after a time delay, the thread/process
server is terminated. The server is not terminated in the following
cases: </p> <ul>
<li id="GUID-F896C125-5ADA-5514-944C-DD24DA81CD41"><a name="GUID-F896C125-5ADA-5514-944C-DD24DA81CD41"><!-- --></a><p>if the client
tries to connect within the duration of the timer, then the shut down
operation is cancelled and the server handles the client's request
to connect. </p> </li>
<li id="GUID-1A5D651C-50ED-5602-8274-7A73335904D2"><a name="GUID-1A5D651C-50ED-5602-8274-7A73335904D2"><!-- --></a><p>if the client
tries to connect after the timer has expired but before the server
shut down process has begun, then the process or thread server is
stopped and restarted to handle the client's request to connect. </p> </li>
</ul> <p><strong>driver</strong> </p> <p>Device drivers are DLLs that allow
code to communicate with hardware. For more information about device
drivers, see the Device Driver Guide. </p> <p id="GUID-A8A82766-6132-5C2B-A98F-52C016D21D68"><a name="GUID-A8A82766-6132-5C2B-A98F-52C016D21D68"><!-- --></a><strong>ProcessClient</strong> </p> <p>This directory implements a client DLL that starts the process
server and creates a session with it. The client DLL provides an API
to allow clients to request the server to load and unload the device
driver. </p> <p id="GUID-52EF8BCD-FAD7-5DB8-9D93-2C6D76F0822A"><a name="GUID-52EF8BCD-FAD7-5DB8-9D93-2C6D76F0822A"><!-- --></a><strong>ProcessServer</strong> </p> <p>This directory implements the process server
class <code class="codeph">CProcessServer</code>, which is derived from <a href="GUID-251A35C1-CC66-4DE4-9EBE-964026E89E7F/GUID-8E316AC4-4676-301A-9A23-659E83AA1D1C.html#GUID-251A35C1-CC66-4DE4-9EBE-964026E89E7F/GUID-8E316AC4-4676-301A-9A23-659E83AA1D1C.html"><code class="apiname">CServer2</code></a>. It handles client requests to interact with the
device drivers. It can have multiple clients connected at the same
time. The device driver, server and client all have the <code class="codeph">MultimediaDD</code> capability. Note that this is for demonstration purposes rather
than because the code uses any Multimedia APIs. The session class <code class="codeph">CProcessServerSession</code> implements a simple message queue
to hold asynchronous requests. </p> <p id="GUID-49CB48EE-8614-5595-BD22-4C9E3BCC6495"><a name="GUID-49CB48EE-8614-5595-BD22-4C9E3BCC6495"><!-- --></a><strong>ThreadClient</strong> </p> <p>This directory implements a client DLL that starts the thread
server and creates a session within it. The client DLL provides an
API to allow clients to request the server to load and unload the
device driver. </p> <p id="GUID-7B61D8F8-E3D4-53E3-AC3D-AF0FD4E3E6A7"><a name="GUID-7B61D8F8-E3D4-53E3-AC3D-AF0FD4E3E6A7"><!-- --></a><strong>ThreadServer</strong> </p> <p>This directory implements the thread
server class <code class="codeph">CThreadServer</code>, which is derived from <a href="GUID-251A35C1-CC66-4DE4-9EBE-964026E89E7F/GUID-8E316AC4-4676-301A-9A23-659E83AA1D1C.html#GUID-251A35C1-CC66-4DE4-9EBE-964026E89E7F/GUID-8E316AC4-4676-301A-9A23-659E83AA1D1C.html"><code class="apiname">CServer2</code></a>. An instance of the thread server runs in the
same process as the client. The thread server handles client requests
to interact with the device drivers. It can have multiple clients
connected at the same time. The session class <code class="codeph">CThreadServerSession</code> implements a simple message queue to hold asynchronous requests. </p> <p><strong>test</strong> </p> <p>This example directory contains a comprehensive
test suite to test the process client and server and the thread client
and server. </p> </div>
<div id="GUID-44822F1F-BC2C-4B6E-AA86-367A02310F08"><h3 class="section-title">Class
summary</h3><p> <a href="GUID-251A35C1-CC66-4DE4-9EBE-964026E89E7F/GUID-8E316AC4-4676-301A-9A23-659E83AA1D1C.html#GUID-251A35C1-CC66-4DE4-9EBE-964026E89E7F/GUID-8E316AC4-4676-301A-9A23-659E83AA1D1C.html"><code class="apiname">CServer2 </code></a><a href="GUID-251A35C1-CC66-4DE4-9EBE-964026E89E7F/GUID-D5A30C75-E22C-34E8-913B-7D2CA6AD5C51.html#GUID-251A35C1-CC66-4DE4-9EBE-964026E89E7F/GUID-D5A30C75-E22C-34E8-913B-7D2CA6AD5C51.html"><code class="apiname">CSession2 </code></a> <a href="GUID-251A35C1-CC66-4DE4-9EBE-964026E89E7F/GUID-6D8A458C-9A39-3000-A3BC-060A2A3663E6.html#GUID-251A35C1-CC66-4DE4-9EBE-964026E89E7F/GUID-6D8A458C-9A39-3000-A3BC-060A2A3663E6.html"><code class="apiname">RSessionBase </code></a> <a href="GUID-251A35C1-CC66-4DE4-9EBE-964026E89E7F/GUID-D7D422D3-65E5-378B-8F52-6485BC5603A0.html#GUID-251A35C1-CC66-4DE4-9EBE-964026E89E7F/GUID-D7D422D3-65E5-378B-8F52-6485BC5603A0.html"><code class="apiname">RMessage2</code></a> <a href="GUID-251A35C1-CC66-4DE4-9EBE-964026E89E7F/GUID-78E0DEDD-C020-3174-AD0A-E4C18C4C9213.html#GUID-251A35C1-CC66-4DE4-9EBE-964026E89E7F/GUID-78E0DEDD-C020-3174-AD0A-E4C18C4C9213.html"><code class="apiname">RMessagePtr2 </code></a> <a href="GUID-251A35C1-CC66-4DE4-9EBE-964026E89E7F/GUID-9DD1EA2B-DC59-315C-8E9C-CE6D9461B695.html#GUID-251A35C1-CC66-4DE4-9EBE-964026E89E7F/GUID-9DD1EA2B-DC59-315C-8E9C-CE6D9461B695.html"><code class="apiname">RProcess </code></a> <a href="GUID-251A35C1-CC66-4DE4-9EBE-964026E89E7F/GUID-B0E661BC-4058-3256-B9C3-5A4FD52F6DE5.html#GUID-251A35C1-CC66-4DE4-9EBE-964026E89E7F/GUID-B0E661BC-4058-3256-B9C3-5A4FD52F6DE5.html"><code class="apiname">RThread </code></a> <a href="GUID-251A35C1-CC66-4DE4-9EBE-964026E89E7F/GUID-6FBFA078-8253-3E24-B1F8-5F75E86C3066.html#GUID-251A35C1-CC66-4DE4-9EBE-964026E89E7F/GUID-6FBFA078-8253-3E24-B1F8-5F75E86C3066.html"><code class="apiname">RBusLogicalChannel </code></a> DLogicalDevice DLogicalChannel  DPhysicalDevice </p></div>
<div id="GUID-E1571EF9-7E34-400C-A372-BB3D449E4081"><h3 class="section-title">Build</h3> <p>Build the development and test code using the <code class="codeph">abld build</code> command from <code>AdvancedClientServerExample\group</code>. </p> <p>The <code class="codeph">AdvancedClientServerExample</code> builds
the following binaries in the standard location (<code>\epoc32\release\winscw\&lt;build_variant&gt;</code> for CodeWarrior): </p> <ul>
<li id="GUID-A78174BF-DBF9-5ED6-944F-FD8216B94567"><a name="GUID-A78174BF-DBF9-5ED6-944F-FD8216B94567"><!-- --></a><p><strong><code>driver1_ldd.ldd</code>.</strong> </p> </li>
<li id="GUID-797DE4E5-10AE-5E9C-B040-94FAA639DAE3"><a name="GUID-797DE4E5-10AE-5E9C-B040-94FAA639DAE3"><!-- --></a><p> <strong><code>driver1_pdd.pdd</code>.</strong> </p> </li>
<li id="GUID-FB3FC150-AF7F-5FA8-84ED-1A51886BBDF3"><a name="GUID-FB3FC150-AF7F-5FA8-84ED-1A51886BBDF3"><!-- --></a><p> <strong><code>processclient.dll</code>,<code>threadclient.dll</code> and <code>threadserver.dll</code>. </strong>,\</p> </li>
<li id="GUID-1082E792-70D0-5656-AA39-696C42D09209"><a name="GUID-1082E792-70D0-5656-AA39-696C42D09209"><!-- --></a><p><strong><code>processserver.exe</code>, <code>Te_ProcessClientServerTestSuite.exe</code> and <code>Te_ThreadClientServerTestSuite.exe</code>.</strong> </p> </li>
</ul> <p>After launching the <strong><code>Te_ProcessClientServerTestSuite.exe</code></strong> or <strong><code>Te_ThreadClientServerTestSuite.exe</code></strong> executable, depending on the emulator you are using, you may
have to navigate away from the <strong>application launcher/shell</strong> screen
to view the console. </p> </div>
<div id="GUID-B233D2DE-D64F-422B-AB6E-E695B78450BA"><h3 class="section-title">Running
tests</h3> <p>To run the tests, perform the following steps: </p><ul>
<li><p>From the command prompt, change directory to <code>epoc32\release\winscw\udeb</code>.</p></li>
<li><p>Run the following command:</p> <p><kbd class="userinput">epoc</kbd> </p></li>
<li><p>On the emulator, go to <code class="codeph">eshell</code>. </p></li>
<li><p>Run the following commands: </p><p><kbd class="userinput">testexecute c:\testdata\scripts\te_processclientservertestsuite.script</kbd> </p><p><kbd class="userinput">testexecute c:\testdata\scripts\te_threadclientservertestsuite.script</kbd> </p><p> <strong>Note:</strong> Test results are stored in the <code>epoc32\winscw\c\logs\testexecute</code> directory: </p></li>
<li id="GUID-42BC1D4A-6605-5BCF-BD74-BB153DA2E9BE"><a name="GUID-42BC1D4A-6605-5BCF-BD74-BB153DA2E9BE"><!-- --></a><p> <strong> Process
server tests:</strong> Refer to the <code>te_processclientservertestsuite.htm</code> file. </p> </li>
<li id="GUID-AB747CEC-9E1F-5F1C-9682-A2A4F877396D"><a name="GUID-AB747CEC-9E1F-5F1C-9682-A2A4F877396D"><!-- --></a><p> <strong>Thread server
tests:</strong> Refer to the <code>te_threadclientservertestsuite.htm</code> file. </p> </li>
</ul> </div>
</div><h3>Related concepts</h3><ul><li><a href="GUID-3786D8E6-17A9-52E4-A8DF-CFCDC3039854.html">Inter
Process Communication</a></li></ul><h3>Related information</h3><ul><li> Device
Driver Guide</li></ul></div></div><div class="footer"><p class="metadata">Last updated January 11th, 2011</p><hr /><div class="copy">© Nokia 2011.</div></div></body>
<!-- Mirrored from devlib.symbian.slions.net/s3/GUID-5B9DE39D-61D0-51FF-948E-15691CD673B5.html by HTTrack Website Copier/3.x [XR&CO'2014], Fri, 27 Mar 2020 06:08:32 GMT -->
</html>